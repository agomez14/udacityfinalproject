/*!CK:1815198656!*//*1437692192,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["D9V15"]); }

__d("HVideoPlayerMixin",["EventListener","VideoPlayerLoggerEvents"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=-1;function j(l,event){var m=event.timeStamp;if(m){var n=m.toString().length-Date.now().toString().length;if(n!==0)m=Math.round(m/Math.pow(10,n));l.time_ms=m;}else l.time_ms=Date.now();return l;}var k={initLogger:function(l,m){var n=this.getSubscriptions();this._loggedEvents={};this._logFunction=l;this._useEventTime=m;var o=this.getVideoElement();this._lastStartTimePosition=i;this._muted=o.muted;this._pausedPosition=i;this._seeking=false;this._seekSourceTimePosition=i;this._volume=o.volume;this._lastPlayedTime=i;if(o.readyState>=o.HAVE_FUTURE_DATA){this._logReadyToPlay();}else n.addSubscriptions(g.listen(o,'canplay',this._logReadyToPlay.bind(this)));n.addSubscriptions(g.listen(o,'pause',this._onPause.bind(this)),g.listen(o,'playing',this._onPlay.bind(this)),g.listen(o,'seeked',this._onSeeked.bind(this)),g.listen(o,'seeking',this._onSeeking.bind(this)),g.listen(o,'timeupdate',this._onTimeUpdate.bind(this)),g.listen(o,'volumechange',this._onVolumeChange.bind(this)));},_logOnce:function(event,l){if(this._loggedEvents[event])return;this._logEvent(event,l);},_logEvent:function(event,l){this._loggedEvents[event]=true;var m=l?l:{};m.video_id=this.getVideoID();if(!m.hasOwnProperty('video_time_position'))m.video_time_position=this.getVideoElement().currentTime.toFixed(2);if(!m.time_ms)m.time_ms=Date.now();m.time=Math.round(m.time_ms/1000);if(this.getAdClientToken){var n=this.getAdClientToken();if(n)m.ad_client_token=n;}this._logFunction(event,m);},_logReadyToPlay:function(){this._logOnce(h.READY_TO_PLAY);},_onPause:function(l){var m=this.getVideoElement(),event=m.ended?h.FINISHED_PLAYING:h.PAUSED,n=this._lastPlayedTime,o=l.lastPauseReason;if(event===h.FINISHED_PLAYING){n=Math.max(n,m.duration);}else if(this.preventPauseLoggingInMixin===true){return;}else if(this.preventPauseLoggingInMixin===false)o=o||'unloaded';this._logEvent(event,this._amendEventTime({video_last_start_time_position:this._lastStartTimePosition===i?this._lastPlayedTime:this._lastStartTimePosition,video_time_position:n,debug_reason:o},l));this._lastStartTimePosition=i;},addWatchTimeData:function(l){if(this._lastStartTimePosition!=i&&this._lastPlayedTime!=i){l.video_last_start_time_position=this._lastStartTimePosition;l.video_time_position=this._lastPlayedTime;this._lastStartTimePosition=i;}return l;},getLastPlayReason:function(){return null;},getVideoPlayReason:function(){return null;},_onPlay:function(l){var m=this.getLastPlayReason(),event=this._loggedEvents[h.STARTED_PLAYING]?h.UNPAUSED:h.STARTED_PLAYING,n={debug_reason:m,video_play_reason:this.getVideoPlayReason()};this._logEvent(event,this._amendEventTime(n,l));this._lastStartTimePosition=this.getVideoElement().currentTime.toFixed(2);this._lastPlayedTime=this.getVideoElement().currentTime.toFixed(2);},_onSeeked:function(l){var m={video_seek_source_time_position:this._seekSourceTimePosition};if(this._lastStartTimePosition!==i){m.video_last_start_time_position=this._lastStartTimePosition;}else m.video_last_start_time_position=this._seekSourceTimePosition;this._logEvent(h.SCRUBBED,this._amendEventTime(m,l));var n=this.getVideoElement();if(n.paused){this._lastStartTimePosition=i;}else this._lastStartTimePosition=n.currentTime;this._seekSourceTimePosition=i;this._seeking=false;},_onSeeking:function(){if(!this._seeking){this._seekSourceTimePosition=this.getVideoElement().currentTime.toFixed(2);this._seeking=true;}},_onTimeUpdate:function(){var l=this.getVideoElement();if(!l.paused)this._lastPlayedTime=l.currentTime.toFixed(2);},_onVolumeChange:function(l){var m=this.getVideoElement(),n={},event=null;if(m.muted!==this._muted&&m.volume===this._volume&&m.volume>0){event=m.muted?h.MUTED:h.UNMUTED;}else{event=m.volume>this._volume?h.VOLUME_INCREASE:h.VOLUME_DECREASE;n.current_volume=Math.round(m.volume*100);}this._logEvent(event,this._amendEventTime(n,l));this._muted=m.muted;this._volume=m.volume;},_amendEventTime:function(l,event){if(this._useEventTime)return j(l,event);return l;}};e.exports=k;},null);