/*!CK:2079196592!*//*1437501253,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Ian7W"]); }

__d("PUWErrorCodes",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={BAD_JPEG:9901,WORKER_TERMINATED:9902,UNKNOWN_RESIZE_ERROR:9903,WORKER_ABORT:9904};},null);
__d("DataViewPolyfill",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';function g(h,i,j){if(i===(void 0)){this.$DataViewPolyfill0=new Uint8Array(h);}else if(j===(void 0)){this.$DataViewPolyfill0=new Uint8Array(h,i);}else this.$DataViewPolyfill0=new Uint8Array(h,i,j);this.byteLength=this.$DataViewPolyfill0.byteLength;}g.prototype.getUint8=function(h){if(h>=this.$DataViewPolyfill0.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this.$DataViewPolyfill0[h];};g.prototype.getUint16=function(h,i){var j=this.getUint8(h),k=this.getUint8(h+1);return i?(k*256)+j:(j*256)+k;};g.prototype.getUint32=function(h,i){var j=this.getUint8(h),k=this.getUint8(h+1),l=this.getUint8(h+2),m=this.getUint8(h+3);return i?(((m*256+l)*256+k)*256)+j:(((j*256+k)*256+l)*256)+m;};g.isSupported=function(){return !!a.Uint8Array;};e.exports=g;},null);
__d("Emscripten",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={isSupported:function(){return (typeof Int32Array!=='undefined'&&typeof Float64Array!=='undefined'&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set);}};},null);
__d("PooledWebWorker",["WebWorker"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";g.call(this,m);this.$PooledWebWorker0=l;this.$PooledWebWorker1=k;}j.prototype.getIndex=function(){"use strict";return this.$PooledWebWorker0;};j.prototype.getPool=function(){"use strict";return this.$PooledWebWorker1;};e.exports=j;},null);
__d("WebWorkerPool",["PooledWebWorker","emptyFunction"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();i.isSupported=function(){"use strict";return g.isSupported();};function i(j,k){"use strict";this.$WebWorkerPool0=[];for(var l=0;l<k;l++)this.$WebWorkerPool0.push(new g(this,l,j).setErrorHandler(this.$WebWorkerPool1).setMessageHandler(this.$WebWorkerPool2).execute());this.$WebWorkerPool3=0;}i.prototype.setMessageHandler=function(j){"use strict";this.$WebWorkerPool4=j||h;return this;};i.prototype.setAllowCrossPageTransition=function(j){"use strict";this.$WebWorkerPool0.forEach(function(k){return k.setAllowCrossPageTransition(j);});return this;};i.prototype.setErrorHandler=function(j){"use strict";this.$WebWorkerPool5=j||h;return this;};i.prototype.postMessage=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);var m=this.getWorker();m.postMessage.apply(m,j);return m;};i.prototype.$WebWorkerPool2=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);j.unshift(this);this.getPool().$WebWorkerPool4.apply(this.getPool(),j);};i.prototype.$WebWorkerPool1=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);j.unshift(this);return this.getPool().$WebWorkerPool5.apply(this.getPool(),j);};i.prototype.getWorker=function(){"use strict";var j=this.$WebWorkerPool0[this.$WebWorkerPool3];this.$WebWorkerPool3=(this.$WebWorkerPool3+1)%this.$WebWorkerPool0.length;return j;};e.exports=i;},null);
__d("JpegResizer",["Emscripten","JpegResizerConfig","JpegResizeWorkerResource","WebWorker","WebWorkerPool","PUWErrorCodes"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=null;n.isSupported=function(){"use strict";return k.isSupported()&&g.isSupported()&&!h.isGKBlacklisted;};n.getSingleton=function(o){"use strict";if(!m)m=new n(o||n.DEFAULT_POOL_SIZE).setAllowCrossPageTransition(true);return m;};n.prepareResource=function(o){"use strict";j.prepareResource(i,o);};function n(o){"use strict";o=o||n.DEFAULT_POOL_SIZE;j.prepareResource(i);this.$JpegResizer0=(new k(i,o)).setErrorHandler(this.$JpegResizer1.bind(this)).setMessageHandler(this.$JpegResizer2.bind(this));this.$JpegResizer3={};this.$JpegResizer4=n.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer5=n.DEFAULT_RESIZE_WIDTH;}n.prototype.setHighQuality=function(o){"use strict";if(o){this.$JpegResizer4=n.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer5=n.DEFAULT_RESIZE_WIDTH;}else{this.$JpegResizer4=n.LOW_QUALITY_RESIZE_HEIGHT;this.$JpegResizer5=n.LOW_QUALITY_RESIZE_WIDTH;}return this;};n.prototype.setAllowCrossPageTransition=function(o){"use strict";this.$JpegResizer0.setAllowCrossPageTransition(o);return this;};n.prototype.resizeBlob=function(o,p,q){"use strict";var r=this.$JpegResizer0.getWorker();if(r.isCurrentState('terminated')){var s=new Error('Worker terminated');s.code=l.WORKER_TERMINATED;p(s);return this;}var t=r.postMessage({blob:o,height:this.$JpegResizer4,width:this.$JpegResizer5}).getIndex();this.$JpegResizer6(t).unshift({done:p,progress:q});return this;};n.prototype.$JpegResizer6=function(o){"use strict";if(!this.$JpegResizer3.hasOwnProperty(o))this.$JpegResizer3[o]=[];return this.$JpegResizer3[o];};n.prototype.$JpegResizer1=function(o,p){"use strict";o.terminate();var q=this.$JpegResizer6(o.getIndex());this.$JpegResizer7(p);q.forEach(function(r){return r.done(p);});q.length=0;};n.prototype.$JpegResizer2=function(o,p){"use strict";if(p.error)this.$JpegResizer7(p.error);if(p.done){this.$JpegResizer6(o.getIndex()).pop().done(p.error,p.blob,p.skipped);}else{var q=this.$JpegResizer6(o.getIndex()),r=q[q.length-1].progress;if(r)r({written:p.written,total:p.total});}};n.prototype.$JpegResizer7=function(o){"use strict";var p=o.message;if(p.indexOf('Not a JPEG file')!==-1){o.code=l.BAD_JPEG;}else if(p.indexOf('abort()')!==-1){o.code=l.WORKER_ABORT;}else o.code=l.UNKNOWN_RESIZE_ERROR;};n.DEFAULT_POOL_SIZE=3;n.DEFAULT_RESIZE_HEIGHT=2048;n.DEFAULT_RESIZE_WIDTH=2048;n.LOW_QUALITY_RESIZE_HEIGHT=960;n.LOW_QUALITY_RESIZE_WIDTH=960;e.exports=n;},null);
__d("FBRTCSoundController",["RTCConfig","Sound"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=[g.ringtone_mp3_url,g.ringtone_ogg_url],j={playIncomingRingtone:function(k,l,m){var n=['incoming_ringtone',k.toString(),l.toString()].join('_');h.play(i,n,m);},stopIncomingRingtone:function(){h.stop(i);}};e.exports=j;},null);
__d("XBrowserNotSupportedDialogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/browser_not_supported\/",{user_id:{type:"Int"},warning:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d("FBRTCUnsupportedBrowserMessage",["AsyncDialog","AsyncRequest","XBrowserNotSupportedDialogController","FBRTCSoundController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={_dialog:null,warnForOutgoingCall:function(l){var m=i.getURIBuilder().setBool('warning',true).getURI();this._presentDialog(m,l);},showForOutgoingCall:function(){var l=i.getURIBuilder().getURI();this._presentDialog(l);},showForIncomingCall:function(l,m){j.playIncomingRingtone(l,m,false);var n=i.getURIBuilder().setInt('user_id',m).getURI();this._presentDialog(n);},dismiss:function(){if(this._dialog)this._dialog.hide();},_presentDialog:function(l,m){if(this._dialog)return;var n=new h(l);g.send(n,function(o){this._dialog=o;o.subscribe('hide',function(){this._dialog=null;if(m)m();}.bind(this));}.bind(this));}};e.exports=k;},null);
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;},null);
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","AsyncRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","JpegResizer","MercuryAttachmentType","MercuryConstants","PhotosMimeType","PhotosUploadID","SubscriptionsHandler","URI","arrayContains","csx","getImageSize","getObjectValues","invariant","isEmpty","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){b.__markCompiled&&b.__markCompiled();'use strict';function da(){return 'upload_'+t.getNewID();}var ea=ca(g);for(var fa in ea)if(ea.hasOwnProperty(fa))ha[fa]=ea[fa];var ga=ea===null?null:ea.prototype;ha.prototype=Object.create(ga);ha.prototype.constructor=ha;ha.__superConstructor__=ea;function ha(ia,ja,ka){ea.call(this);this.$ChatAutoSendPhotoUploader0=ka;this.$ChatAutoSendPhotoUploader1=ja;this.$ChatAutoSendPhotoUploader2=new u();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5=false;this.$ChatAutoSendPhotoUploader6=ia.getAttribute('action');this.$ChatAutoSendPhotoUploader7=new l(ia,[o,m]);this.$ChatAutoSendPhotoUploader7.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader7.setUploadInParallel(true);var la=j.find(ia,"._4q60"),ma=j.find(la,"._4q61");this.$ChatAutoSendPhotoUploader8=new n(la,ma,ja);this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.$ChatAutoSendPhotoUploader7.subscribe('submit',this.$ChatAutoSendPhotoUploader9.bind(this)),this.$ChatAutoSendPhotoUploader7.subscribe('success',this.$ChatAutoSendPhotoUploadera.bind(this)),this.$ChatAutoSendPhotoUploader7.subscribe('failure',this.$ChatAutoSendPhotoUploaderb.bind(this)),this.$ChatAutoSendPhotoUploader7.subscribe('progress',this.$ChatAutoSendPhotoUploaderc.bind(this)),k.listen(ma,'click',function(){if(this.$ChatAutoSendPhotoUploaderd===(void 0))this.$ChatAutoSendPhotoUploadere();if(this.$ChatAutoSendPhotoUploaderd)if(p.prepareResource)p.prepareResource();this.inform('open');}.bind(this)));}ha.prototype.$ChatAutoSendPhotoUploadere=function(){this.$ChatAutoSendPhotoUploaderd=p.isSupported();if(this.$ChatAutoSendPhotoUploaderd)this.$ChatAutoSendPhotoUploader7.setPreprocessHandler(this.$ChatAutoSendPhotoUploaderf.bind(this));};ha.prototype.isUploading=function(){return !ba(this.$ChatAutoSendPhotoUploader3);};ha.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader2.release();this.$ChatAutoSendPhotoUploader7.destroy();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};};ha.prototype.$ChatAutoSendPhotoUploaderg=function(ia,ja){var ka=this.$ChatAutoSendPhotoUploaderh(ia);if(ja){ka.preview_width=ja.width;ka.preview_height=ja.height;}return ka;};ha.prototype.$ChatAutoSendPhotoUploaderh=function(ia){var ja={upload_id:ia,on_progress:function(ka){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('progress',ka));}.bind(this),on_resizing_progress:function(ka){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('resize_progress',ka));}.bind(this),on_success:function(ka){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('success',ka));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploaderi.bind(this),attach_type:q.PHOTO,preview_uploading:true};return ja;};ha.prototype.$ChatAutoSendPhotoUploaderf=function(ia,ja){var ka=ia.getFile();if(!s(ka.type).isJpeg())return ja(ia);p.getSingleton().resizeBlob(ka,function(la,ma,na){if(ma)ia.setFile(ma);ja(ia);},this.$ChatAutoSendPhotoUploaderj.bind(this,ia));};ha.prototype.$ChatAutoSendPhotoUploader9=function(){var ia=da();this.$ChatAutoSendPhotoUploaderk(ia,this.$ChatAutoSendPhotoUploader1.files);};ha.prototype.$ChatAutoSendPhotoUploaderk=function(ia,ja){for(var ka=0;ka<ja.length;ka++){var la=ja[ka];if(la.size>r.AttachmentMaxSize){this.inform('file-upload-error');return;}}var ma={};if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&ja&&ja.length===1){this.$ChatAutoSendPhotoUploader3[ia]=ia;ma[ia]=ja[0];var na=new FileReader();na.onload=function(){this.inform('submit',{upload_id:ia,preview_attachments:[this.$ChatAutoSendPhotoUploaderg(ia,y(na.result))]});}.bind(this);na.onerror=function(){this.inform('submit',{upload_id:ia,preview_attachments:[this.$ChatAutoSendPhotoUploaderh(ia)]});}.bind(this);if(ja[0].size){na.readAsArrayBuffer(ja[0]);}else{var oa=Object.assign({},this.$ChatAutoSendPhotoUploaderg(ia,ja[0].source),{preview_url:ja[0].preview_url});this.inform('submit',{upload_id:ia,preview_attachments:[oa]});}}else{var pa=[];if(!ja){this.$ChatAutoSendPhotoUploader3[ia]=ia;this.$ChatAutoSendPhotoUploader0.value=ia;pa.push(this.$ChatAutoSendPhotoUploaderh(ia));}else for(var qa=0;qa<ja.length;++qa){var ra=da();ma[ra]=ja[qa];this.$ChatAutoSendPhotoUploader3[ra]=ia;pa.push(this.$ChatAutoSendPhotoUploaderh(ra));}this.inform('submit',{upload_id:ia,preview_attachments:pa});}if(Object.keys(ma).length>0)this.$ChatAutoSendPhotoUploader7.setFiles(ma);};ha.prototype.$ChatAutoSendPhotoUploadera=function(event,ia){var ja=this.$ChatAutoSendPhotoUploaderl(ia);if(this.$ChatAutoSendPhotoUploader3[ja]){var ka=this.$ChatAutoSendPhotoUploader3[ja];delete this.$ChatAutoSendPhotoUploader3[ja];var la=ia.response.getPayload();if(!this.$ChatAutoSendPhotoUploader4[ka])this.$ChatAutoSendPhotoUploader4[ka]=[];this.$ChatAutoSendPhotoUploader4[ka].push({id:ja,audio_id:la.metadata[0].audio_id,image_id:la.metadata[0].image_id,file_id:la.metadata[0].file_id,gif_id:la.metadata[0].gif_id});this.inform('success',{upload_id:ja});if(!this.$ChatAutoSendPhotoUploaderm(ka))this.$ChatAutoSendPhotoUploadern(ka);this.$ChatAutoSendPhotoUploader8.clear();this.$ChatAutoSendPhotoUploader1=this.$ChatAutoSendPhotoUploader8.getInput();}};ha.prototype.$ChatAutoSendPhotoUploadern=function(ia){aa(!this.$ChatAutoSendPhotoUploaderm(ia));this.$ChatAutoSendPhotoUploader4[ia].sort(function(ja,ka){return ja.id<ka.id?-1:1;});this.inform('all-uploads-completed',{upload_id:ia,audio_ids:this.$ChatAutoSendPhotoUploader4[ia].map(function(ja){return ja.audio_id;}),image_ids:this.$ChatAutoSendPhotoUploader4[ia].map(function(ja){return ja.image_id;}),file_ids:this.$ChatAutoSendPhotoUploader4[ia].map(function(ja){return ja.file_id;}),gif_ids:this.$ChatAutoSendPhotoUploader4[ia].map(function(ja){return ja.gif_id;})});delete this.$ChatAutoSendPhotoUploader4[ia];};ha.prototype.$ChatAutoSendPhotoUploaderc=function(event,ia){this.inform('progress',{upload_id:ia.upload.getName(),event:ia.event});};ha.prototype.$ChatAutoSendPhotoUploaderj=function(ia,event){this.inform('resize_progress',{upload_id:ia.getName(),event:event});};ha.prototype.$ChatAutoSendPhotoUploaderm=function(ia){return w(z(this.$ChatAutoSendPhotoUploader3),ia);};ha.prototype.$ChatAutoSendPhotoUploaderb=function(event,ia){var ja=this.$ChatAutoSendPhotoUploaderl(ia);this.$ChatAutoSendPhotoUploadero(ja,'last-upload-failed');this.$ChatAutoSendPhotoUploader8.clear();this.$ChatAutoSendPhotoUploader1=this.$ChatAutoSendPhotoUploader8.getInput();return false;};ha.prototype.$ChatAutoSendPhotoUploaderi=function(ia){this.$ChatAutoSendPhotoUploadero(ia,'last-upload-canceled');};ha.prototype.$ChatAutoSendPhotoUploadero=function(ia,ja){if(!this.$ChatAutoSendPhotoUploader3[ia])return;var ka=this.$ChatAutoSendPhotoUploader3[ia];delete this.$ChatAutoSendPhotoUploader3[ia];if(!this.$ChatAutoSendPhotoUploaderm(ka))if(this.$ChatAutoSendPhotoUploader4[ka]){this.$ChatAutoSendPhotoUploadern(ka);}else this.inform(ja,{upload_id:ka});};ha.prototype.$ChatAutoSendPhotoUploaderl=function(ia){if(ia.upload){return ia.upload.getName();}else return ia.response.getPayload().uploadID;};ha.prototype.uploadFile=function(ia){var ja=da(),ka={};ka[ja]=ia;var la=new h(this.$ChatAutoSendPhotoUploader6).setAllowCrossOrigin(true).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader5).setRelativeTo(this.$ChatAutoSendPhotoUploader7.getRoot()).setFiles(ka);this.$ChatAutoSendPhotoUploader2.addSubscriptions(la.subscribe('success',function(event,ma){this.$ChatAutoSendPhotoUploadera(event,{upload:ma,response:ma.getResponse()});}.bind(this)),la.subscribe('failure',this.$ChatAutoSendPhotoUploaderb.bind(this)));la.send();this.$ChatAutoSendPhotoUploaderk(ja,[ia]);};ha.prototype.uploadURL=function(ia){var ja=da(),ka=new i().setURI(new v(this.$ChatAutoSendPhotoUploader6).getPath()).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader5).setData(Object.assign({},ia,{attach_id:ja})).setHandler(function(la){this.$ChatAutoSendPhotoUploadera(null,{response:la});}.bind(this));ka.send();this.$ChatAutoSendPhotoUploaderk(ja,[ia]);};ha.prototype.setAllowCrossPage=function(ia){this.$ChatAutoSendPhotoUploader5=ia;this.$ChatAutoSendPhotoUploader7.setAllowCrossPageTransition(ia);};e.exports=ha;},null);