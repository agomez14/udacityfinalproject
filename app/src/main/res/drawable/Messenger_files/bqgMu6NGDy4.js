/*!CK:3972435017!*//*1437497600,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["X2Xrt"]); }

__d("SpotlightViewerLoggingEvents",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"};},null);
__d("SpotlightViewerAutoResize",["Event","SubscriptionsHandler","invariant"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this.$SpotlightViewerAutoResize0=k;i(typeof this.$SpotlightViewerAutoResize0.onResize==='function');}j.prototype.enable=function(){"use strict";this.$SpotlightViewerAutoResize1=new h();this.$SpotlightViewerAutoResize1.addSubscriptions(g.listen(window,'resize',this.$SpotlightViewerAutoResize0.onResize));};j.prototype.disable=function(){"use strict";this.$SpotlightViewerAutoResize1.release();delete this.$SpotlightViewerAutoResize1;};e.exports=j;},null);
__d("SpotlightViewerBehaviorsMixin",["BehaviorsMixin"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={componentWillMount:function(){this.behaviors&&this.enableBehaviors(this.behaviors);},componentWillUnmount:function(){this.destroyBehaviors();}};Object.assign(h,g);e.exports=h;},null);
__d("PhotoLogger",["Event","BanzaiScuba","SpotlightViewerLoggingEvents","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){"use strict";this.$PhotoLogger0=l;this.$PhotoLogger1={};}k.prototype.log=function(l){"use strict";if(!this.$PhotoLogger1[l]){this.$PhotoLogger2(l);this.$PhotoLogger1[l]=true;}};k.prototype.$PhotoLogger2=function(l){"use strict";this.$PhotoLogger3(i.LOADING,{uri:l});var m=new j(),n=new Image();m.addSubscriptions(g.listen(n,'load',function(){this.$PhotoLogger3(i.LOADED,{uri:l});m.release();}.bind(this)),g.listen(n,'error',function(){this.$PhotoLogger3(i.ERROR,{uri:l});m.release();}.bind(this)),g.listen(n,'abort',function(){this.$PhotoLogger3(i.ABORT,{uri:l});m.release();}.bind(this)));n.src=l;};k.prototype.logEvent=function(l){"use strict";this.$PhotoLogger3(l);};k.prototype.$PhotoLogger3=function(l,m){"use strict";var n=new h('photos_client_loading',null,{addBrowserFields:true});n.addNormal('event',l);n.addNormal('viewer',this.$PhotoLogger0);for(var o in m)n.addNormal(o,m[o]);n.post();};e.exports=k;},null);
__d("PhotoViewState",["ArbiterMixin","PhotoStore","PhotoUtils","SpotlightViewerLoggingEvents","mixin"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=k(g);for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(p,q,r,s,t){"use strict";l.call(this);this._viewer=p;this._setID=q;this._updateCallback=s;this._position=r||0;this._preloaded={};this._reverse=t;}o.prototype._fetchCallback=function(p){"use strict";if(!this._viewer.isOpen())return;this._preload(p);this._log(j.DATA_FETCH_COMPLETE);};o.prototype._preload=function(p){"use strict";i.preload(this._viewer,p,function(q){this._preloaded[i.getFBIDFromData(q)]=true;}.bind(this));};o.prototype._preloadPhotosInRange=function(p,q){"use strict";var r=[];for(var s=p;s<=q;++s){var t=h.getByIndexImmediate(this._setID,s);if(t&&!this._isPreloaded(t))r.push(t);}this._preload(r);};o.prototype._isPreloaded=function(p){"use strict";return this._preloaded[i.getFBIDFromData(p)];};o.prototype.getPosition=function(){"use strict";return this._position;};o.prototype.isValidMovement=function(p){"use strict";if(!h.hasBeenCreated(this._setID))return false;if(h.hasLooped(this._setID))return true;var q=this._position+p,r=h.getAvailableRange(this._setID),s=r.offset+r.length-1;return q>=r.offset-1&&q<=s+1;};o.prototype.getRelativeMovement=function(p){"use strict";return h.getIndexForID(this._setID,p)-this._position;};o.prototype.moveCursor=function(p){"use strict";if(!this.isValidMovement(p))return false;this._position+=p;return true;};o.prototype._page=function(p){"use strict";if(!this.moveCursor(p))return;this._log(j.PAGE_BEGIN);var q=h.getByIndexImmediate(this._setID,this._position);if(!q){this.inform('photo_fetch');this._log(j.PHOTO_FETCH);}else if(!this._isPreloaded(q))this._preload([q]);h.getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(p>0,o.BUFFER_SIZE);this._log(j.PAGE_COMPLETE);};o.prototype.loadMoreForwardIfNecessary=function(p){"use strict";var q=h.getAvailableRange(this._setID),r=q.offset+q.length-1,s=this._position+p;if(s>r&&!h.hasLooped(this._setID)){var t=h.getCursorByIndexImmediate(this._setID,r);h.fetchForward(this._setID,t,p,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,s);};o.prototype.loadMoreBackwardIfNecessary=function(p){"use strict";var q=h.getAvailableRange(this._setID),r=this._position-p;if(r<q.offset&&!h.hasLooped(this._setID)){var s=h.getCursorByIndexImmediate(this._setID,q.offset);h.fetchBackward(this._setID,s,p,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(r,this._position-1);};o.prototype._loadMoreIfNecessary=function(p,q){"use strict";if(p){this.loadMoreForwardIfNecessary(q);}else this.loadMoreBackwardIfNecessary(q);};o.prototype.displayFirst=function(){"use strict";if(!this._viewer.isOpen())return;h.setPreFetchCallback(this._setID,function(){this._log(j.DATA_FETCH_BEGIN);}.bind(this));var p=function(q){if(!this._isPreloaded(q))this._preload([q]);this._updateCallback(q);}.bind(this);h.getByIndex(this._setID,this._position,p);if(this._reverse){this.loadMoreBackwardIfNecessary(o.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(o.BUFFER_SIZE);};o.prototype.backward=function(){"use strict";this._page(this._reverse?1:-1);};o.prototype.forward=function(){"use strict";this._page(this._reverse?-1:1);};o.prototype._log=function(p){"use strict";this._viewer.log(p);};Object.assign(o,{BUFFER_SIZE:4});e.exports=o;},null);
__d("SpotlightViewerImage",["React","cx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=g.createClass({displayName:"SpotlightViewerImage",render:function(){return (g.createElement("img",{className:"_4-od",src:this.props.src,style:{width:this.props.dimensions.x,height:this.props.dimensions.y}}));}});e.exports=i;},null);
__d("SpotlightViewerCoreMixin",["PhotoLogger","PhotoStore","PhotoUtils","PhotoViewState","React","SpotlightViewerImage","SpotlightViewerLoggingEvents"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n={_displayFirstPhoto:function(){h.executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function(){var o;if(!this.props.clearcache)o=h.getIndexForID(this.props.setid,this.props.photoid);if(o===(void 0)){h.clearSetCache(this.props.setid);o=0;}return o;},__displayPhoto:function(){var o=this._getInitialPosition();this.viewState=new j(this,this.props.setid,o,this._updatePhoto,this.props.reverse);this.inform('open');this._displayFirstPhoto();},componentWillMount:function(){this._logger=new g(this.getViewerID());this.log(m.OPEN_BEGIN);this.__displayPhoto();},componentDidMount:function(){this._enableSubscriptions&&this._enableSubscriptions();this.log(m.OPEN_COMPLETE);},isOpen:function(){return this.state.open;},close:function(){if(!this.isOpen())return;this.log(m.CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(m.CLOSE_COMPLETE);});},componentWillUnmount:function(){this.viewState=null;},_onClickViewport:function(o){o?this.viewState.forward():this.viewState.backward();},_getMedia:function(o,p){return (k.createElement(l,{ref:"image",src:o.uri,dimensions:p.imageDimensions}));},_getCurrentFBID:function(){return i.getFBIDFromData(this.state.photoData);},_updatePhoto:function(o){this.log(m.PHOTO_CHANGE_BEGIN);this.setState({photoData:o},function(){this.inform('photo_change',this.state.photoData);this.log(m.PHOTO_CHANGE_COMPLETE);});},getLogger:function(){return this._logger;},log:function(o){this._logger&&this._logger.logEvent(o);}};e.exports=n;},null);
__d("SpotlightViewerStageResizer",["Event","SubscriptionsHandler","Vector"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=520;function k(l,m){"use strict";this._subscriptionsHandler=new h();this._subscriptionsHandler.addSubscriptions(g.listen(window,'resize',this._resetStageDimensions.bind(this)));this._dimensions=l;this._minHeight=m.minHeight||j;this._minWidth=m.minWidth||j;this._resetStageDimensions();}k.prototype.destroy=function(){"use strict";this._dimensions=null;this._subscriptionsHandler.release();};k.prototype._resetStageDimensions=function(){"use strict";this._currentStageDimensions=new i(this._minWidth,this._minHeight);};k.prototype.getImageAndStageDimensions=function(l){"use strict";var m=this._dimensions.getBestFitDimensionsFromPhoto(l,this._dimensions.getMaxStageDimensions()),n=this._dimensions.getStageDimensions(m);this._currentStageDimensions=new i(Math.max(n.x,this._minWidth,this._currentStageDimensions.x),Math.max(n.y,this._minHeight,this._currentStageDimensions.y));var o=this._dimensions.getImageDimensionsForStage(m,this._currentStageDimensions);return {stageDimensions:this._currentStageDimensions,imageDimensions:o};};k.prototype.getCurrentStageDimensions=function(){"use strict";return this._currentStageDimensions;};e.exports=k;},null);
__d("SpotlightViewerDimensionMixin",["SpotlightViewerStageResizer","PhotoViewerDimensions"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={getInitialState:function(){this._dimensions=new h({verticalPadding:this.props.verticalPadding,horizontalPadding:this.props.horizontalPadding});this._resizer=new g(this._dimensions,{minHeight:this.props.minHeight,minWidth:this.props.minWidth});return {maxStageDimensions:this._dimensions.getMaxStageDimensions()};},componentWillUnmount:function(){this._resizer&&this._resizer.destroy();this._resizer=null;this._dimensions&&this._dimensions.destroy();this._dimensions=null;},getMedia:function(){if(this.state.photoData){var j=this._resizer.getImageAndStageDimensions(this.state.photoData),k=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);return this._getMedia(k,j);}else return null;},getDimensions:function(){return this._dimensions;},getStageDimensions:function(){if(this.state.photoData){return this._resizer.getImageAndStageDimensions(this.state.photoData).stageDimensions;}else return this._dimensions.getMaxStageDimensions();},getImageDimensions:function(){if(!this.state.photoData)return null;return this._resizer.getImageAndStageDimensions(this.state.photoData).imageDimensions;},onResize:function(){this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});}};e.exports=i;},null);
__d("SpotlightViewerPagers",["LeftRight.react","Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i.createClass({displayName:"SpotlightViewerPagers",render:function(){return (i.createElement(g,null,i.createElement(h,{className:"_4-oa _4-ob _50-m"}),i.createElement(h,{className:"_4-oa _4-oc _50-m"})));}});e.exports=k;},null);
__d("SpotlightViewerPageWithKeys",["KeyEventController","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(j){"use strict";this.$SpotlightViewerPageWithKeys0=j;}i.prototype.enable=function(){"use strict";this.$SpotlightViewerPageWithKeys1=new h();this.$SpotlightViewerPageWithKeys1.addSubscriptions(g.registerKey('LEFT',function(){this.$SpotlightViewerPageWithKeys0.viewState.backward();return false;}.bind(this)),g.registerKey('RIGHT',function(){this.$SpotlightViewerPageWithKeys0.viewState.forward();return false;}.bind(this)));};i.prototype.disable=function(){"use strict";this.$SpotlightViewerPageWithKeys1.release();delete this.$SpotlightViewerPageWithKeys1;};e.exports=i;},null);
__d("SpotlightViewerThumbnailMixin",["PhotoStore","Vector"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={_getInitialPhotoData:function(){var j=g.getIndexForID(this.props.setid,this.props.photoid),k=g.getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=h.deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};e.exports=i;},null);
__d("XMessagingPhotoDownloadController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/mercury\/attachments\/photo\/",{photo_id:{type:"String",required:true}});},null);
__d("SpotlightMessagesViewer",["ArbiterMixin","MercuryConfig","MessagingForwardAttachmentDialog.react","MessagingForwardingButtonNUX.react","PageTransitionsRegistrar","React","ReactLayeredComponentMixin","SpotlightViewer","SpotlightViewerAutoResize","SpotlightViewerBehaviorsMixin","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","SpotlightViewerClose","SpotlightViewerCoreMixin","SpotlightViewerDimensionMixin","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerThumbnailMixin","SpotlightViewport","SubscriptionsHandler","XMessagingPhotoDownloadController","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){b.__markCompiled&&b.__markCompiled();var da=l.createClass({displayName:"SpotlightMessagesViewer",mixins:[g,m,p,u,y,v],behaviors:[x,o],componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},getViewerID:function(){return this.props.setid;},getInitialState:function(){this._subscriptions=new aa();return {photoData:this._getInitialPhotoData(),open:true,showForward:false};},_enableSubscriptions:function(){this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',function(){return this.setState({photoData:null});}.bind(this)));},_showForwardDialog:function(){this.setState({showForward:true});},_hideForwardDialog:function(){this.setState({showForward:false});},renderLayers:function(){if(!h.ForwardingEnabled||this.props.disableForward)return {};var ea=(ca._("Forward in separate messages"));return {forwardDialog:(l.createElement(i,{attachmentID:String(this.state.photoData.id),onClose:this._hideForwardDialog,shown:this.state.showForward,title:ea})),forwardButtonNUX:(l.createElement(j,{contextRef:function(){return this.refs.forwardButton;}.bind(this)},ca._("Send this image to other people in separate messages.")))};},render:function(){var ea=this.getMedia(),fa=this.props.snapToPhoto?this.getImageDimensions():this.getStageDimensions(),ga=this.props.useloadingindicator&&!this.state.photoData;k.registerCompletionCallback(function(){if(this.state.open)this.close();return true;}.bind(this));return (l.createElement(n,{rootClassName:this.props.rootClassName,open:this.state.open,onHide:this.close},l.createElement(z,{active:true,onClick:this._onClickViewport,stageDimensions:fa,media:ea,showLoadingIndicator:ga},l.createElement(t,{onClick:this.close}),this.props.disablepaging?null:l.createElement(w,null),this._renderBottomBar())));},_renderBottomBar:function(){var ea;if(h.ForwardingEnabled&&!this.props.disableForward)ea=(l.createElement(s,{onClick:this._showForwardDialog,ref:"forwardButton"},ca._("Forward")));var fa=ba.getURIBuilder().setString('photo_id',String(this.state.photoData.id)).getURI();return (l.createElement(q,null,l.createElement(r,null),l.createElement(r,null,ea,l.createElement(s,{rel:"async",ajaxify:fa},ca._("Download")))));}});e.exports=da;},null);