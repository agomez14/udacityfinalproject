/*!CK:715769071!*//*1436754025,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/aCUp"]); }

__d("P2PSendMoneyButtonImpl.react",["CurrentEnvironment","ImmutableObject","P2PAbstractSendMoneyButton.react","P2PActions","P2PErrorDialog.react","P2PGroupSendDialog.react","P2PGroupSendReceiptDialog.react","P2PPasswordProtectionNUXDialog.react","P2PPasswordProtectionStatusTypes","P2PSendMoneyDialog.react","P2PSendMoneySuccessDialog.react","P2PTransferParam","P2PTransferStore","P2PTransferRiskResult","P2PUnderManualReviewDialog.react","P2PUserEligibilityStore","P2PVerificationFlowHelper","React","ReactLayeredComponentMixin","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();'use strict';var ba=x,ca=ba.PropTypes,da=x.createClass({displayName:"P2PSendMoneyButtonImpl",mixins:[y],propTypes:{amount:ca.string,groupSendReceiptDetails:ca.object,groupThreadFBID:ca.string,isNewEmptyLocalThread:ca.bool,isGroupChat:ca.bool,onTrigger:ca.func,participants:ca.arrayOf(ca.object).isRequired,sendMoneyDialogShown:ca.bool,threadID:ca.string,threadFBID:ca.string},getDefaultProps:function(){return {amount:'',groupThreadFBID:'',onTrigger:z,sendMoneyDialogShown:false};},getInitialState:function(){return {participants:this.props.participants};},componentDidMount:function(){this.userEligibilityStoreSub=v.addListener('change',this.onUserEligibilityChange);this.setEligibilityState();},componentWillUnmount:function(){if(this.userEligibilityStoreSub){this.userEligibilityStoreSub.remove();this.userEligibilityStoreSub=null;}},componentWillReceiveProps:function(ea){if(ea.participants.length!==this.props.participants.length||ea.threadID!==this.props.threadID)this.setState({participants:ea.participants},function(){this.setEligibilityState();}.bind(this));},setEligibilityState:function(){var ea,fa,ga=this.state.participants;if(!ga.length)return;ea=ga.map(function(ia){return ia.userID;});fa=v.getEligibilityByUserIDs(ea);for(var ha=0;ha<ga.length;ha++)ga[ha]=h.set(ga[ha],{p2p_eligible:fa[ga[ha].userID]});this.setState({participants:ga});},onUserEligibilityChange:function(){this.setEligibilityState();},canShowSendMoneyDialog:function(){if(!this.state.participants.length)return false;if(this.getRecipient()&&!this.isRecipientEligible())return false;return true;},originalCreateTransactionResponse:null,_onButtonClick:function(){this.canShowSendMoneyDialog()&&this.showSendMoneyDialog();},hideSendMoneyDialog:function(){j.chatSendViewClosed({threadID:this.props.threadID});},showSendMoneyDialog:function(){j.chatSendViewOpened({threadID:this.props.threadID});},_handleDialogToggle:function(ea){if(!ea){this.hideSendMoneyDialog();}else this.showSendMoneyDialog();},handleOnSendSuccess:function(ea){this.hideSendMoneyDialog();var fa=ea[r.RISK_RESULT];this.originalCreateTransactionResponse=ea;if(fa===t.REQUIRE_VERIFICATION){w.startVerificationFlow(ea.id,true,this.handlePostSendSteps);}else if(fa===t.UNDER_MANUAL_REVIEW){this.showUnderManualReviewDialog();}else this.handlePostSendSteps();},handlePostSendSteps:function(){var ea=this.originalCreateTransactionResponse,fa=ea.passwordProtection===o.NOT_SET;if(ea.isFirstSend){this._passwordNUXPending=fa;this.showSendSuccessDialog();}else if(fa){this.showPasswordProtectionDialog();}else j.hideDialog();this.originalCreateTransactionResponse=null;this.props.onTrigger();},handleConfirmationOKClick:function(){if(this._passwordNUXPending){this._passwordNUXPending=false;this.showPasswordProtectionDialog();}else j.hideDialog();},handleSendError:function(ea){this.showErrorDialog(ea);},getMoneyButtonNode:function(){return x.findDOMNode(this.refs.p2pSendMoneyButton);},getRecipient:function(){if(!this.props.isGroupChat)return this.state.participants[0];return null;},isRecipientEligible:function(){var ea=this.getRecipient();if(!ea)return false;return !!(ea.p2p_eligible||s.hasReceivedFromSender(ea.userID));},showErrorDialog:function(ea){var fa=aa._("Problem Sending Money");j.showDialog(k,{error:ea,onOKClick:j.hideDialog,title:fa});},showPasswordProtectionDialog:function(){j.showDialog(n,{onComplete:j.hideDialog});},showSendSuccessDialog:function(){j.showDialog(q,{onClose:this.handleConfirmationOKClick});},showUnderManualReviewDialog:function(){j.showDialog(u,{onClose:this.handlePostSendSteps});},renderLayers:function(){var ea={},fa='USD',ga='$';if(this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown)if(this.props.groupSendReceiptDetails&&this.props.threadFBID){ea.groupSendReceiptDetailsDialog=x.createElement(m,{context:this.getMoneyButtonNode(),currency:fa,groupSendReceiptDetails:this.props.groupSendReceiptDetails,onToggle:this._handleDialogToggle,threadFBID:this.props.threadFBID,threadID:this.props.threadID});}else if(this.props.isGroupChat&&this.props.threadFBID){ea.groupSendMoneyDialog=x.createElement(l,{amount:this.props.amount,context:this.getMoneyButtonNode(),currency:fa,onToggle:this._handleDialogToggle,participants:this.state.participants,threadFBID:this.props.threadFBID});}else ea.sendMoneyDialog=x.createElement(p,{amount:this.props.amount,context:this.getMoneyButtonNode(),currency:fa,currencySymbol:ga,groupThreadFBID:this.props.groupThreadFBID,onToggle:this._handleDialogToggle,onError:this.handleSendError,onSendSuccess:this.handleOnSendSuccess,receiver:this.getRecipient(),ref:'send_money_dialog'});return ea;},render:function(){var ea=this.getRecipient();if(this.props.isNewEmptyLocalThread&&this.state.participants.length>1)return null;return (x.createElement(i,{isDialogOpen:this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown,isDisabled:!!(ea&&!this.isRecipientEligible()),isMessenger:!!g.messengerdotcom,onClick:this._onButtonClick,recipientName:ea&&ea.short_name,ref:"p2pSendMoneyButton"}));}});e.exports=da;},null);