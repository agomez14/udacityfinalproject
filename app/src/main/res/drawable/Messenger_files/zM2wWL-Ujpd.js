/*!CK:2204422750!*//*1438019482,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["SWu4g"]); }

__d("FBRTCCallConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={FBRTCCallConnectionType:{MISSED_CALL:4,CONNECTED_CALL:5},FBRTCCallType:{VOICE_CALL:1,VIDEO_CALL:2}};},null);
__d("ScreenSharingWebDriverIDs",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SHARE_SCREEN_BUTTON:"shareScreenButton",INSTALL_EXT_DIALOG:"install_extension_dialog"};},null);
__d("StarsInput.react",["React","TooltipLink.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g,l=k.PropTypes,m=g.createClass({displayName:"StarsInput",propTypes:{allowMultipleSubmissions:l.bool,large:l.bool,onClick:l.func.isRequired,starLabels:l.array},getDefaultProps:function(){return {allowMultipleSubmissions:false,large:false,starLabels:[j._("Poor"),j._("Fair"),j._("Good"),j._("Very Good"),j._("Excellent")]};},getInitialState:function(){return {starRating:0,starsShown:0,canUpdate:true};},_getStarRating:function(n){return parseInt(n.split('.').pop(),10)+1;},onMouseEnter:function(event){if(this.state.canUpdate)this.setState({starsShown:this._getStarRating(event.dispatchMarker)});},onMouseLeave:function(event){if(this.state.canUpdate){var n=this.state.starRating;this.setState({starsShown:n});}},onClick:function(event){if(this.state.canUpdate){var n=this._getStarRating(event.dispatchMarker);this.setState({starRating:n,starsShown:n,canUpdate:this.props.allowMultipleSubmissions});this.props.onClick(n);}},getStars:function(){var n=this.props.starLabels.length,o=[];for(var p=0;p<n;p++)o.push(g.createElement(h,{className:(("mls")+(' '+"_22mm")+(this.props.large?' '+"_1vr2":'')+(p>=this.state.starsShown?' '+"_22mn":'')+(p<this.state.starsShown?' '+"_22mo":'')+(!this.state.canUpdate?' '+"_1g87":'')),tooltip:this.props.starLabels[p],onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick,position:"above",alignH:"center"}));return o;},render:function(){return (g.createElement("div",null,this.getStars()));}});e.exports=m;},null);
__d("AbstractPopoverButton.react",["React","URI","cloneWithProps","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=g,m=l.PropTypes,n=g.createClass({displayName:"AbstractPopoverButton",propTypes:{config:m.object.isRequired,haschevron:m.bool,maxwidth:m.number},getDefaultProps:function(){return {haschevron:true};},render:function(){var o=this.props.config,p={},q=o.defaultMaxWidth;if(typeof this.props.maxwidth!=='undefined')q=this.props.maxwidth;var r=null;if(q){var s=this.props.haschevron?q-o.chevronWidth:q;if(this.props.label)r={maxWidth:s+'px'};p.style=Object.assign({},p.style,{maxWidth:q+'px'});}p.image=null;var t=null;if(this.props.image&&this.props.label){t=i(this.props.image,{className:"_3-8_"});}else if(this.props.image)t=this.props.image;if(t||this.props.label)p.label=g.createElement("span",{className:"_55pe",style:r},t,this.props.label);if(this.props.haschevron)p.imageRight=o.chevron;p.className=k(o.button.props.className,"_2agf");p.href=new h('#');return i(o.button,p);}});e.exports=n;},null);
__d("ReactSelectorUtils",["React"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={processMenuItems:function(i,j){var k,l=g.Children.map(i,function(m){if(m){var n=m.props.value===j;m=g.cloneElement(m,{selected:n});if(n)k=m;return m;}});return {items:l,selectedItem:k};},processMultiMenuItems:function(i,j){var k=[],l=i;if(j)l=g.Children.map(i,function(m){if(m){var n=j.some(function(o){return o===m.props.value;});m=g.cloneElement(m,{selected:n});if(n)k.push(m);return m;}});return {items:l,selectedItems:k};}};e.exports=h;},null);
__d("PopoverMenuContextMinWidth",["CSS","Style","cx","shield"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){"use strict";this._popoverMenu=l;this._popover=l.getPopover();}k.prototype.enable=function(){"use strict";this._setMenuSubscription=this._popoverMenu.subscribe('setMenu',j(this._onSetMenu,this));};k.prototype.disable=function(){"use strict";this._setMenuSubscription.unsubscribe();this._setMenuSubscription=null;if(this._showSubscription){this._showSubscription.unsubscribe();this._showSubscription=null;}if(this._menuSubscription){this._menuSubscription.unsubscribe();this._menuSubscription=null;}};k.prototype._onSetMenu=function(){"use strict";this._menu=this._popoverMenu.getMenu();this._showSubscription=this._popover.subscribe('show',j(this._updateWidth,this));var l=this._updateWidth.bind(this);this._menuSubscription=this._menu.subscribe(['change','resize'],function(){setTimeout(l,0);});this._updateWidth();};k.prototype._updateWidth=function(){"use strict";var l=this._menu.getRoot(),m=this._popoverMenu.getTriggerElem(),n=m.offsetWidth;h.set(l,'min-width',n+'px');g.conditionClass(l,"_575s",n>=l.offsetWidth);};Object.assign(k.prototype,{_setMenuSubscription:null,_showSubscription:null,_menuSubscription:null});e.exports=k;},null);
__d("PopoverMenuOverlappingBorder",["CSS","DOM","Style","cx","shield"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(m){"use strict";this._popoverMenu=m;this._popover=m.getPopover();this._triggerElem=m.getTriggerElem();}l.prototype.enable=function(){"use strict";this._setMenuSubscription=this._popoverMenu.subscribe('setMenu',k(this._onSetMenu,this));};l.prototype.disable=function(){"use strict";this._popoverMenu.unsubscribe(this._setMenuSubscription);this._setMenuSubscription=null;this._removeBorderSubscriptions();this._removeShortBorder();};l.prototype._onSetMenu=function(){"use strict";this._removeBorderSubscriptions();this._menu=this._popoverMenu.getMenu();this._renderShortBorder(this._menu.getRoot());this._showSubscription=this._popover.subscribe('show',k(this._updateBorder,this));var m=this._updateBorder.bind(this);this._menuSubscription=this._menu.subscribe(['change','resize'],function(){setTimeout(m,0);});this._updateBorder();};l.prototype._updateBorder=function(){"use strict";var m=this._menu.getRoot(),n=this._triggerElem.offsetWidth,o=Math.max(m.offsetWidth-n,0);i.set(this._shortBorder,'width',o+'px');};l.prototype._renderShortBorder=function(m){"use strict";this._shortBorder=h.create('div',{className:"_54hx"});h.appendContent(m,this._shortBorder);g.addClass(m,"_54hy");};l.prototype._removeShortBorder=function(){"use strict";if(this._shortBorder){h.remove(this._shortBorder);this._shortBorder=null;g.removeClass(this._popoverMenu.getMenu().getRoot(),"_54hy");}};l.prototype._removeBorderSubscriptions=function(){"use strict";if(this._showSubscription){this._popover.unsubscribe(this._showSubscription);this._showSubscription=null;}if(this._menuSubscription){this._menu.unsubscribe(this._menuSubscription);this._menuSubscription=null;}};Object.assign(l.prototype,{_shortBorder:null,_setMenuSubscription:null,_showSubscription:null,_menuSubscription:null});e.exports=l;},null);
__d("intlList",["React","fbt","invariant","keyMirror"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=function(m,n){n=n||k.CONJUNCTIONS.AND;var o=m.length;if(o===0){return '';}else if(o===1)return m[0];var p=m[o-1],q=m[0];for(var r=1;r<o-1;++r)q=h._("{previous items}, {following items}",[h.param("previous items",q),h.param("following items",m[r])]);return l(q,p,n);};function l(m,n,o){switch(o){case k.CONJUNCTIONS.AND:return (h._("{list of items} and {last item}",[h.param("list of items",m),h.param("last item",n)]));case k.CONJUNCTIONS.OR:return (h._("{list of items} or {last item}",[h.param("list of items",m),h.param("last item",n)]));case k.CONJUNCTIONS.NONE:return (h._("{list of items}, {last item}",[h.param("list of items",m),h.param("last item",n)]));default:i(false);}}k.CONJUNCTIONS=j({AND:null,NONE:null,OR:null});e.exports=k;},null);
__d("AbstractSelector.react",["InlineBlock.react","React","PopoverMenu.react","ReactSelectorUtils","ContextualLayerAutoFlip","PopoverMenuContextMinWidth","PopoverMenuOverlappingBorder","cloneWithProps","cx","invariant","joinClasses","intlList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=h,t=s.PropTypes;function u(w,x,y){if(w[x]==null)return;var z=Array.isArray(w[x]);if(w.multiple){if(!z)return new Error('You are trying to set a single value for `'+x+'` '+'but the menu has `multiple` set to true, so it should be an '+'array of values.');}else if(z)return new Error('You are trying to set an array of values for `'+x+'` '+'but the menu has `multiple` set to false, so it should be a '+'single value.');}var v=h.createClass({displayName:"AbstractSelector",propTypes:{config:t.object.isRequired,alignh:t.oneOf(['left','center','right']),name:t.string,overlappingborder:t.bool,onChange:t.func,disabled:t.bool,maxheight:t.number,multiple:t.bool,defaultLabel:t.string,defaultValue:u,value:u,initialValue:u},getInitialState:function(){return {value:(this.props.value!=null?this.props.value:this.props.defaultValue!=null?this.props.defaultValue:this.props.initialValue)};},setMenuValue:function(w){p(this.refs&&this.refs.popover);this._internalChange=true;this.refs.popover.getMenu().setValue(w);this._internalChange=false;},onChange:function(w,x){if(this._internalChange)return;if(this.props.value==null){var y=null;if(this.props.multiple){y=x.map(function(z){return z.value;});}else y=x.value;this.setState({value:y});}else this.setMenuValue(this.props.value);if(this.props.onChange)this.props.onChange(x);},componentWillReceiveProps:function(w){if(w.value!=null){this.setState({value:w.value});}else if(this.props.multiple!==w.multiple)this.setState({value:w.multiple?[this.state.value]:this.state.value[0]});},render:function(){var w=this.props.config,x=!this.props.multiple?j.processMenuItems(this.props.children,this.state.value):j.processMultiMenuItems(this.props.children,this.state.value),y=n(w.menu,{children:x.items,className:q("_575t",w.menu.props.className),maxheight:this.props.maxheight,onChange:this.onChange}),z='',aa=null;if(!this.props.multiple){var ba=x.selectedItem;z=ba.props.label||ba.props.children;if(ba.props.icon)aa=n(ba.props.icon,{});}else{var ca=x.selectedItems;if(!ca.length){z=this.props.defaultLabel;}else z=r(ca.map(function(ka){return ka.props.children;}),r.CONJUNCTIONS.NONE);}var da={label:z,disabled:this.props.disabled};if(aa)da.image=aa;var ea=n(w.button,da),fa=[k];if(w.layerBehaviors)fa=fa.concat(w.layerBehaviors);var ga=[l];if(this.props.overlappingborder)ga.push(m);var ha=null;if(this.props.multiple){var ia=this.props.name+'[]',ja;if(this.state.value)ja=this.state.value.map(function(ka){return (h.createElement("input",{key:ka,type:"hidden",name:ia,value:ka}));});ha=h.createElement("div",null,ja);}else ha=h.createElement("input",{type:"hidden",name:this.props.name,value:this.state.value});return (h.createElement(g,h.__spread({},this.props,{alignv:"middle",name:null}),h.createElement(i,{ref:"popover",menu:y,alignh:this.props.alignh,layerBehaviors:fa,behaviors:ga,disabled:this.props.disabled},ea),ha));},showMenu:function(){p(this.isMounted());this.refs.popover.showPopover();},hideMenu:function(){p(this.isMounted());this.refs.popover.hidePopover();}});e.exports=v;},null);
__d("XUIOverlayButton.react",["AbstractButton.react","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=h.createClass({displayName:"XUIOverlayButton",render:function(){var l="_51tl selected";return (h.createElement(g,h.__spread({},this.props,{className:j(this.props.className,l)})));}});e.exports=k;},null);
__d("HasLayerContextMixin",["React"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={getContextNode:function(){var i=this.props.context;if(this.props.contextRef){var j=this.props.contextRef();i=j&&g.findDOMNode(j);}return i;}};e.exports=h;},null);
__d("ContextualDialogXUITheme",["cx"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={wrapperClassName:"_53ii",arrowDimensions:{offset:12,length:16}};e.exports=h;},null);
__d("XUIContextualDialogBody.react",["React"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=g.createClass({displayName:"XUIContextualDialogBody",render:function(){return (g.createElement("div",{className:this.props.className},this.props.children));}});e.exports=h;},null);
__d("XUIContextualDialogFooter.react",["React","XUIOverlayFooter.react","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g.createClass({displayName:"XUIContextualDialogFooter",render:function(){return (g.createElement(h,{className:"_572u"},this.props.children));}});e.exports=j;},null);
__d("XUIContextualDialogTitle.react",["React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g,k=j.PropTypes,l=g.createClass({displayName:"XUIContextualDialogTitle",propTypes:{use:k.oneOf(['primary','secondary'])},getDefaultProps:function(){return {use:'primary'};},render:function(){var m=this.props.use,n=i((("_47lu")+(m==='primary'?' '+"_47lv":'')+(m==='secondary'?' '+"_47mc":'')),this.props.className);return (g.createElement("h3",{className:n},this.props.children));}});e.exports=l;},null);
__d("XUIContextualDialog.react",["HasLayerContextMixin","ContextualDialogXUITheme","React","ReactAbstractContextualDialog","ReactLayer","XUIContextualDialogBody.react","XUIContextualDialogFooter.react","XUIContextualDialogTitle.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=i,q=p.PropTypes,r=k.createClass(j.createSpec({displayName:'ReactXUIContextualDialog',theme:h})),s=i.createClass({displayName:"XUIContextualDialog",mixins:[g],propTypes:{position:q.oneOf(['above','below','left','right']),alignment:q.oneOf(['left','center','right']),offsetX:q.number,offsetY:q.number,width:q.number,autoFocus:q.bool,arrowBehavior:q.func,behaviors:q.object,shown:q.bool,context:q.object,contextRef:q.func,hoverContext:q.object,hoverContextRef:q.func,hoverShowDelay:q.number,hoverHideDelay:q.number,hideOnEscape:q.bool,onToggle:q.func,hasActionableContext:q.bool},getDefaultProps:function(){return {hasActionableContext:false,hideOnEscape:true};},_getDialogBody:function(){return this._getChildOfType(l);},_getDialogTitle:function(){return this._getChildOfType(n);},_getDialogFooter:function(){return this._getChildOfType(m);},_getChildOfType:function(t){var u=null;i.Children.forEach(this.props.children,function(v){if(!u&&v.type===t)u=v;});return u;},updatePosition:function(){var t=this.refs.dialog;if(t)t.layer.updatePosition();},render:function(){var t=this.props.children,u=this._getDialogBody();if(u)t=i.createElement("div",{className:"_53iv"},this._getDialogTitle(),u);return (i.createElement(r,i.__spread({},this.props,{ref:"dialog",context:this.getContextNode()}),t,u?this._getDialogFooter():null));}});s.WIDTH={NORMAL:312,WIDE:400};e.exports=s;},null);
__d("XUIDialogButton.react",["React","XUIButton.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g,l=k.PropTypes,m=g.createClass({displayName:"XUIDialogButton",propTypes:{action:l.oneOf(['cancel','confirm','button'])},render:function(){var n=this.props.action,o=((n=='confirm'?"layerConfirm":'')+(n=='cancel'?' '+"layerCancel":'')+(n=='button'?' '+"layerButton":'')),p=this.props.href;if(n=='cancel'){p='#';}else if(n=='button')p=p||'#';return (g.createElement(h,g.__spread({},this.props,{className:j(this.props.className,o),href:p})));}});e.exports=m;},null);
__d("XUIDialogCancelButton.react",["React","XUIDialogButton.react","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g.createClass({displayName:"XUIDialogCancelButton",render:function(){return (g.createElement(h,g.__spread({},this.props,{action:"cancel",label:i._("Cancel")})));}});e.exports=j;},null);
__d("XUIDialogSaveButton.react",["React","XUIDialogButton.react","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g.createClass({displayName:"XUIDialogSaveButton",render:function(){return (g.createElement(h,g.__spread({},this.props,{action:"confirm",label:i._("Save")})));}});e.exports=j;},null);
__d("XUIPopoverButton.react",["AbstractPopoverButton.react","Image.react","React","XUIButton.react","cx","ix","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=i,o=n.PropTypes,p=i.createClass({displayName:"ReactXUIPopoverButton",propTypes:{haschevron:o.bool,maxwidth:o.number},statics:{getButtonSize:function(q){return q.size||'medium';}},render:function(){var q=p.getButtonSize(this.props),r="_55pi";if(this.props.theme==='dark')r=m(r,(("_5vto")+(q==='small'?' '+"_55_o":'')+(q==='medium'?' '+"_55_p":'')+(q==='large'?' '+"_55_q":'')+(q==='xlarge'?' '+"_55_r":'')+(q==='xxlarge'?' '+"_55_s":'')));var s=this.props.chevron;if(!s){var t=this.props.theme==='dark'||this.props.use==='confirm'||this.props.use==='special'?l('/images/ui/x/button/dark/chevron.png'):l('/images/ui/x/button/normal/chevron.png');s=i.createElement(h,{src:t});}var u={button:i.createElement(j,i.__spread({},this.props,{className:m(this.props.className,r),size:q})),chevron:s,chevronWidth:14,defaultMaxWidth:this.props.maxwidth||200};return (i.createElement(g,{config:u,haschevron:this.props.haschevron,image:this.props.image,label:this.props.label,maxwidth:this.props.maxwidth}));}});e.exports=p;},null);
__d("ContextualLayerPositionClassOnContext",["CSS","cx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(k){"use strict";this._layer=k;}i.prototype.enable=function(){"use strict";this._subscription=this._layer.subscribe('reposition',this._updateClassName.bind(this));if(this._layer.isShown())this._updateClassName();};i.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;if(this._prevClassName){g.removeClass(this._layer.getContext(),this._prevClassName);this._prevClassName=null;}};i.prototype._updateClassName=function(k,l){"use strict";var m=this._layer.getContext(),n=j(l);if(this._prevClassName){if(this._prevClassName===n)return;g.removeClass(m,this._prevClassName);}g.addClass(m,n);this._prevClassName=n;};function j(k){var l=k.getAlignment(),m=k.getPosition();if(m==='below'){if(l==='left'){return "_nk";}else if(l==='right'){return "_nl";}else return "_nm";}else if(m==='above'){if(l==='left'){return "_nn";}else if(l==='right'){return "_no";}else return "_np";}else if(m==='left'){return "_nq";}else return "_nr";}Object.assign(i.prototype,{_subscription:null,_prevClassName:null});e.exports=i;},null);
__d("XUISelectorButton.react",["React","XUIPopoverButton.react","invariant"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g.createClass({displayName:"XUISelectorButton",render:function(){i(!this.props.theme);return (g.createElement(h,g.__spread({},this.props,{theme:"dark"})));}});e.exports=j;},null);
__d("XUISelector.react",["AbstractSelector.react","ContextualLayerPositionClassOnContext","React","ReactChildren","ReactXUIMenu","XUISelectorButton.react","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=k.SelectableMenu,o=k.SelectableItem,p=i,q=p.PropTypes,r=i.createClass({displayName:"ReactXUISelector",propTypes:{layerBehaviors:q.array,maxheight:q.number,multiple:q.bool,disabled:q.bool,haschevron:q.bool,maxwidth:q.number,size:q.oneOf(['small','medium','large','xlarge','xxlarge']),suppressed:q.bool,use:q.oneOf(['default','special','confirm'])},statics:{getButtonSize:function(s){return s.size||'medium';}},getDefaultProps:function(){return {haschevron:true,layerBehaviors:[],multiple:false};},render:function(){var s,t=[];j.forEach(this.props.children,function(v){if(v)t.push(v);});if(t[0]&&t[0].type===l){s=t[0];t=t.slice(1);}else s=i.createElement(l,{haschevron:this.props.haschevron,disabled:this.props.disabled,use:this.props.use,size:this.props.size,suppressed:this.props.suppressed,maxwidth:this.props.maxwidth});var u={button:s,menu:i.createElement(n,{maxheight:this.props.maxheight,multiple:this.props.multiple}),layerBehaviors:this.props.layerBehaviors.concat([h])};return (i.createElement(g,i.__spread({},this.props,{ref:"abstractSelector",config:u}),t));},showMenu:function(){m(this.isMounted());this.refs.abstractSelector.showMenu();},hideMenu:function(){m(this.isMounted());this.refs.abstractSelector.hideMenu();}});r.Option=o;e.exports=r;},null);
/**
 * @generated SignedSource<<623c7cbcff19956af736c3d064fc689d>>
 *
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 *
 * Copyright (C) 2010 by Johannes Baagoe <baagoe@baagoe.org>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @providesModule Alea
 * @preserve-header
 */__d("Alea",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){var i=4022871197,j=function(k){k=k.toString();for(var l=0;l<k.length;l++){i+=k.charCodeAt(l);var m=.02519603282416938*i;i=m>>>0;m-=i;m*=i;i=m>>>0;m-=i;i+=m*4294967296;}return (i>>>0)*2.3283064365386963e-10;};j.version='Mash 0.9';return j;}function h(){return (function(i){var j=0,k=0,l=0,m=1;if(i.length===0)i=[new Date()];var n=new g();j=n(' ');k=n(' ');l=n(' ');for(var o=0;o<i.length;o++){j-=n(i[o]);if(j<0)j+=1;k-=n(i[o]);if(k<0)k+=1;l-=n(i[o]);if(l<0)l+=1;}n=null;var p=function(){var q=2091639*j+m*2.3283064365386963e-10;j=k;k=l;l=q-(m=q|0);return l;};p.version='Alea 0.9';p.args=i;return p;}(Array.prototype.slice.call(arguments)));}e.exports=h;},null);
__d("BanzaiScribe",["Banzai"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(j){return {log:function(k,l,m){var n=[l];if(m!=null)n.push(m);g.post('scribe:'+k,n,j);}};}var i=h({});i.create=h;e.exports=i;},null);
__d("XVideoCallAdminMessageController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/admin_msg\/",{});},null);
__d("FBRTCAdminMessage",["FBRTCCallConstants","FBRTCLogger","FBRTCUtils","XVideoCallAdminMessageController","emptyFunction","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o){"use strict";this.$FBRTCAdminMessage0=n;this.$FBRTCAdminMessage1=o;this.$FBRTCAdminMessage2=Date.now();this.$FBRTCAdminMessage3=null;this.$FBRTCAdminMessage4=null;}m.prototype.onCallConnected=function(){"use strict";if(!this.$FBRTCAdminMessage3)this.$FBRTCAdminMessage3=l();};m.prototype.onCallEnded=function(){"use strict";if(!this.$FBRTCAdminMessage4)this.$FBRTCAdminMessage4=l();};m.prototype.submit=function(n){"use strict";if(!this.$FBRTCAdminMessage4)this.onCallEnded();var o=0,p=g.FBRTCCallConnectionType.MISSED_CALL;if(this.$FBRTCAdminMessage3){o=Math.ceil(this.$FBRTCAdminMessage4-this.$FBRTCAdminMessage3);p=g.FBRTCCallConnectionType.CONNECTED_CALL;}this.$FBRTCAdminMessage5({peer_id:this.$FBRTCAdminMessage0,call_id:this.$FBRTCAdminMessage1,start_time:this.$FBRTCAdminMessage2,call_duration:o,message_type:p,call_category:n});};m.prototype.$FBRTCAdminMessage5=function(n){"use strict";var o=j.getURIBuilder().getURI();i.sendServerRequest(o,k,this.$FBRTCAdminMessage6.bind(this,n.peer_id,n.call_id),false,null,n);};m.prototype.$FBRTCAdminMessage6=function(n,o,p){"use strict";var q;if(p){q='Fail to log admin message, error '+p.error;}else q='Server timed out on logging admin message';h.getInstance().logError(n,o,q);};e.exports=m;},null);
__d("FBRTCPCConfig",["FBRTCVersionDetection"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h="stun:stun.fbsbx.com:3478",i=function(k,l,m){if(g.isChrome()&&g.webrtcVersion()>=34){var n={urls:k};if(l&&m){n.username=l;n.credential=m;}return [n];}var o=[];for(var p=0;p<k.length;p++)if(l&&m){o.push({url:k[p],username:l,credential:m});}else o.push({url:k[p]});return o;},j={setTurnCredentials:function(k){this.turnIP=k.ip;this.udpPort=k.udp_port;this.tcpPort=k.tcp_port;this.sslPort=k.ssl_tcp_port;this.turnUsername=k.username;this.turnPassword=k.password;},getConfig:function(){var k=i([h]).concat(i(this._turnUrls(),this.turnUsername,this.turnPassword));return {iceServers:k};},getConstraints:function(){return {mandatory:{},optional:[{DtlsSrtpKeyAgreement:'true'}]};},_turnUrls:function(){if(g.isFirefox()&&g.webrtcVersion()<27){return [("turn:"+this.turnIP+":"+this.udpPort)];}else return [("turn:"+this.turnIP+":"+this.udpPort+"?transport=udp"),("turn:"+this.turnIP+":"+this.tcpPort+"?transport=tcp"),("turn:"+this.turnIP+":"+this.sslPort+"?transport=tcp")];}};e.exports=j;},null);
__d("FBRTCSdpUtils",["UserAgent"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h='m=video 0',i=function(l){return l.match(/^a=rtpmap:(\d+)\s/)[1];},j=function(l,m,n){var o=i(l[m]),p=l[n].split('RTP/SAVPF'),q=p[1].split(/\s+/),r=q.indexOf(o);q.splice(r,1);p[1]=q.join(' ');l[n]=p.join('RTP/SAVPF');l.splice(m,1);},k={addIceOptionToSdp:function(l,m){"use strict";var n="a=ice-options:",o=l.indexOf(n);if(o>=0){var p=l.indexOf("\r",o);return [l.slice(0,p)," ",m,l.slice(p)].join('');}var q=n+m,r=l.split("\r\n"),s=false,t=-1;for(var u=0;u<r.length;u++){var v=r[u].slice(0,2);if(v=="s="){s=true;continue;}if(s&&v=="a="){t=u;break;}}if(t>=0){r.splice(t,0,q);return r.join("\r\n");}return [l,q,"\r\n"].join('');},preferIsac:function(l){var m=l.split("\r\n"),n=-1,o=-1,p=-1;for(var q=0;q<m.length;q++){var r=m[q];if(r.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))n=q;if(p===-1&&n>-1&&r.match(/^a=rtpmap:/))p=q;if(r.match(/^a=rtpmap:\d+\s+ISAC\/16000/))o=q;}if(n===-1||o===-1||p===-1)return m.join("\r\n");var s=m[o];j(m,o,n);m.splice(p,0,s);m[n]=m[n].replace('RTP/SAVPF','RTP/SAVPF '+i(s));return m.join("\r\n");},disableVideo:function(l){var m=/m=video\s+\S+/;l=l.replace(m,h);if(g.isBrowser('Firefox <= 37'))l=this._makeDisabledVideoReceiveOnly(l);return l;},_makeDisabledVideoReceiveOnly:function(l){if(l.indexOf(h)>-1){var m=l.split(h);m[1]=m[1].replace(/send(recv|only)/,'recvonly');l=m.join(h);}return l;},fixMobileIceSdp:function(l){l=l.replace(/^a=/,'');l=l.split(/\s+username\s+.+password.+/)[0];var m=l.match(/\s+relay\s+|\s+srflx\s+/),n=l.match(/raddr.+rport.+/);if(m&&!n){m=m[0];var o=l.split(m),p=o[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),q,r;if(p){q=p[1];r=p[2];o[1]=o[1].replace(p[0],'');}else{p=o[0].split(/\s+/);q=p[4];r=p[5];}l=(""+o[0]+m+"raddr "+q+" rport "+r+" "+o[1]);}return l;},removeFEC:function(l){var m=l.split('\r\n'),n,o;for(var p=0;p<m.length;p++){if(m[p].match(/^a=rtpmap:\d+\s+red\//))n=p;if(m[p].match(/^m=video/))o=p;}if(n&&o)j(m,n,o);return m.join('\r\n');},isVideoSupported:function(l){return (l&&l.indexOf('m=video')>-1&&l.indexOf(h)===-1);},setDtlsRole:function(l,m){if(!l.match(/setup:(active|passive|actpass)/)){return l.replace(/(a=fingerprint:.+)/g,("$1\r\na=setup:"+m));}else return l.replace(/setup:actpass/g,("setup:"+m));},setVideoBitrateConstraint:function(l){var m=720;if(l.match(/^b=AS:/m))return l;l=l.replace(/^a=mid:video\r\n/m,("a=mid:video\r\nb=AS:"+m+"\r\n"));return l;},removeSdparta:function(l){var m=l.split('\r\n'),n='audio',o=false,p=-1;for(var q=0;q<m.length;q++){var r=m[q];if(r.indexOf('m=audio')===0)n='audio';if(r.indexOf('m=video')===0){o=true;n='video';}if(r.indexOf('a=mid:sdparta_')===0)m[q]=("a=mid:"+n);if(r.indexOf('a=group:BUNDLE sdparta_')===0)p=q;}if(p>-1)if(o){m[p]='a=group:BUNDLE audio video';}else m[p]='a=group:BUNDLE audio';return m.join('\r\n');}};e.exports=k;},null);
__d("FBRTCStatsHelpers",["FBRTCLogger"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=function(j){if(j==='host'||j==='local')return 'local';if(j==='serverreflexive')return 'srflx';if(j==='peerreflexive')return 'prflx';if(j==='relayed'||j==='relay')return 'relay';return 'unknown';},i={connectionType:function(j,k,l,m){return ['l:',h(j),'-',k,';','r:',h(l),'-',m].join('');},logReport:function(j){var k=g.getInstance(),l=['connectionType','audioCodec','videoCodec','audioRtt','videoRtt','audioPacketsLost','videoPacketsLost','audioBytesSent','videoBytesSent','audioPacketsSent','videoPacketsSent'];for(var m=0;m<l.length;m++){var n=j[l[m]].call(j);k.logToConsole(l[m]+' => '+n);}}};e.exports=i;},null);
__d("FBRTCMozStatsReport",["Map","FBRTCLogger","FBRTCStatsHelpers"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(){"use strict";this.$FBRTCMozStatsReport0=null;this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.candidates=new g();this.candidatePairs=new g();this.$FBRTCMozStatsReport4=h.getInstance();}j.prototype.parseReport=function(k){"use strict";k.forEach(function(l){switch(l.type){case 'inboundrtp':if(!l.remoteId)break;var m={inbound:l,outbound:k[l.remoteId]};if(l.isRemote){if(m.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport1=m;}else this.$FBRTCMozStatsReport0=m;}else if(m.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport3=m;}else this.$FBRTCMozStatsReport2=m;break;case 'outboundrtp':break;case 'candidatepair':if(l.state==='succeeded')this.candidatePairs.set(l.id,l);break;case 'localcandidate':this.candidates.set(l.id,l);break;case 'remotecandidate':this.candidates.set(l.id,l);break;default:this.$FBRTCMozStatsReport4.logToConsole('unrecognized webrtc stats type '+l.type);break;}}.bind(this));};j.prototype.isConnected=function(){"use strict";return !!this.$FBRTCMozStatsReport0;};j.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.inbound.mozRtt;};j.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt;};j.prototype.audioCodec=function(){"use strict";return 'opus';};j.prototype.videoCodec=function(){"use strict";return 'VP8';};j.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.inbound.packetsLost;};j.prototype.setVideoPacketsLost=function(k){"use strict";};j.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost;};j.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.outbound.bytesSent;};j.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent;};j.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.outbound.packetsSent;};j.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent;};j.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.framerateMean;};j.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return 30;};j.prototype.connectionType=function(){"use strict";var k='unknown',l='unknown',m='unknown',n='unknown';this.candidatePairs.forEach(function(o){var p=this.candidates.get(o.localCandidateId),q=this.candidates.get(o.remoteCandidateId);k=p.transport;m=q.transport;l=p.candidateType;n=q.candidateType;}.bind(this));return i.connectionType(l,k,n,m);};e.exports=j;},null);
__d("FBRTCChromeStatsReport",["FBRTCStatsHelpers"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=function(j,k){return parseInt(j.stat(k),10);};function i(){"use strict";this.$FBRTCChromeStatsReport0=[];this.$FBRTCChromeStatsReport1=null;this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;}i.prototype.parseReport=function(j){"use strict";j.result().forEach(function(k){if(k.type==="googCandidatePair"&&k.stat('googActiveConnection')==='true')this.$FBRTCChromeStatsReport0.push(k);if(this.$FBRTCChromeStatsReport6(k))this.$FBRTCChromeStatsReport1=k;if(this.$FBRTCChromeStatsReport7(k))this.$FBRTCChromeStatsReport2=k;if(this.$FBRTCChromeStatsReport8(k))this.$FBRTCChromeStatsReport3=k;if(this.$FBRTCChromeStatsReport9(k))this.$FBRTCChromeStatsReport4=k;if(k.type==='VideoBwe')this.$FBRTCChromeStatsReport5=k;}.bind(this));};i.prototype.isConnected=function(){"use strict";return true;};i.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'googRtt');};i.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googRtt');};i.prototype.audioCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 'unknown';return this.$FBRTCChromeStatsReport1.stat('googCodecName');};i.prototype.videoCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 'unknown';return this.$FBRTCChromeStatsReport2.stat('googCodecName');};i.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'packetsLost');};i.prototype.setVideoPacketsLost=function(j){"use strict";this.$FBRTCChromeStatsReporta=j;};i.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;if(this.$FBRTCChromeStatsReporta)return this.$FBRTCChromeStatsReporta;return h(this.$FBRTCChromeStatsReport2,'packetsLost');};i.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'bytesSent');};i.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'bytesSent');};i.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'packetsSent');};i.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'packetsSent');};i.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googFrameRateSent');};i.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googFrameRateInput');};i.prototype.connectionType=function(){"use strict";var j='unknown',k='unknown',l='unknown';for(var m=0;m<this.$FBRTCChromeStatsReport0.length;m++){var n=this.$FBRTCChromeStatsReport0[m];k=n.stat('googLocalCandidateType');l=n.stat('googRemoteCandidateType');j=n.stat('googTransportType');}return g.connectionType(k,j,l,j);};i.prototype.$FBRTCChromeStatsReport6=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('audioInputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport7=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('googFrameHeightInput')>-1;};i.prototype.$FBRTCChromeStatsReport8=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('audioOutputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport9=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('googFrameHeightReceived')>-1;};e.exports=i;},null);
__d("FBRTCStatsReportFactory",["FBRTCMozStatsReport","FBRTCChromeStatsReport","FBRTCLogger","FBRTCVersionDetection"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=function(n,o){n.getStats(null,function(p){var q=new g();q.parseReport(p);o(q);},function(){i.getInstance().logToConsole('Firefox stats collection failed');});},l=function(n,o){n.getStats(function(p){var q=new h();q.parseReport(p);o(q);});},m={getStats:function(n,o){if(j.isFirefox())k(n,o);if(j.isChrome())l(n,o);}};e.exports=m;},null);
__d("Queue",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={};function h(i){"use strict";this._opts=Object.assign({interval:0,processor:null},i);this._queue=[];this._stopped=true;}h.prototype._dispatch=function(i){"use strict";if(this._stopped||this._queue.length===0)return;if(!this._opts.processor){this._stopped=true;throw new Error('No processor available');}if(this._opts.interval){this._opts.processor.call(this,this._queue.shift());this._timeout=setTimeout(this._dispatch.bind(this),this._opts.interval);}else while(this._queue.length)this._opts.processor.call(this,this._queue.shift());};h.prototype.enqueue=function(i){"use strict";if(this._opts.processor&&!this._stopped){this._opts.processor.call(this,i);}else this._queue.push(i);return this;};h.prototype.start=function(i){"use strict";if(i)this._opts.processor=i;this._stopped=false;this._dispatch();return this;};h.prototype.isStarted=function(){"use strict";return !this._stopped;};h.prototype.dispatch=function(){"use strict";this._dispatch(true);};h.prototype.stop=function(i){"use strict";this._stopped=true;if(i)clearTimeout(this._timeout);return this;};h.prototype.merge=function(i,j){"use strict";this._queue[j?'unshift':'push'].apply(this._queue,i._queue);i._queue=[];this._dispatch();return this;};h.prototype.getLength=function(){"use strict";return this._queue.length;};h.get=function(i,j){"use strict";var k;if(i in g){k=g[i];}else k=g[i]=new h(j);return k;};h.exists=function(i){"use strict";return i in g;};h.remove=function(i){"use strict";return delete g[i];};e.exports=h;},null);
__d("FBRTCCallConnection",["FBRTCConfig","FBRTCLogger","FBRTCPCConfig","FBRTCSdpUtils","FBRTCStatsReportFactory","Queue","UserAgent","invariant","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=300000,q=12000,r=10000,s='data';function t(){"use strict";this.$FBRTCCallConnection0=h.getInstance();this.$FBRTCCallConnection1();this.$FBRTCCallConnection2=null;this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=new l({interval:1,processor:this.$FBRTCCallConnection5.bind(this)});this.$FBRTCCallConnection6=null;this.$FBRTCCallConnection7=null;this.$FBRTCCallConnection8=false;this.$FBRTCCallConnection9=0;this.$FBRTCCallConnectiona=[];this.$FBRTCCallConnectionb=false;this.$FBRTCCallConnectionc='passive';this.$FBRTCCallConnectiond=true;}t.prototype.init=function(u){"use strict";this.$FBRTCCallConnection0.logToConsole('Creating a new peer connection with: '+JSON.stringify(i.getConfig())+', '+JSON.stringify(i.getConstraints()));this.$FBRTCCallConnectione=u;};t.prototype.setStream=function(u){"use strict";this.$FBRTCCallConnectione=u;};t.prototype.addScreenStream=function(u){"use strict";if(u&&u.getStream()){this.$FBRTCCallConnection0.logToConsole('Screen stream added');this.$FBRTCCallConnectionf=u;}else this.$FBRTCCallConnection0.logToConsole('Trying to add invalid stream');};t.prototype.removeScreenStream=function(u){"use strict";if(u&&u.getStream()){this.$FBRTCCallConnection0.logToConsole('Screen stream removed');this.$FBRTCCallConnection2.removeStream(u.getStream());}else this.$FBRTCCallConnection0.logToConsole('Trying to remove invalid stream');this.$FBRTCCallConnectionf=null;};t.prototype.setPeerSupportsVideo=function(u){"use strict";this.$FBRTCCallConnectiond=u;};t.prototype.$FBRTCCallConnectiong=function(u,v){"use strict";this.$FBRTCCallConnectionh(null);u.onaddstream=null;u.onremovestream=null;u.onicecandidate=null;u.oniceconnectionstatechange=null;this.$FBRTCCallConnectiona=[];var w=v?5000:1;setTimeout(function(){if(u.iceConnectionState!=='closed')u.close();},w);};t.prototype.$FBRTCCallConnectioni=function(){"use strict";if(this.$FBRTCCallConnection2)this.$FBRTCCallConnectiong(this.$FBRTCCallConnection2,true);var u=new this.nativePeerConnection(i.getConfig(),i.getConstraints());this.$FBRTCCallConnectionc='passive';u.onaddstream=this.$FBRTCCallConnectionj.bind(this);u.onremovestream=this.$FBRTCCallConnectionk.bind(this);u.onicecandidate=this.$FBRTCCallConnectionl.bind(this);u.oniceconnectionstatechange=this.$FBRTCCallConnectionm.bind(this);u.addStream(this.$FBRTCCallConnectione.getStream());return u;};t.prototype.$FBRTCCallConnectionh=function(u){"use strict";this.$FBRTCCallConnection4.stop(true);if(this.isDataChannelOpen())this.$FBRTCCallConnection3.close();this.$FBRTCCallConnection3=u;if(!u)return;this.$FBRTCCallConnection3.onopen=this.$FBRTCCallConnectionn.bind(this);this.$FBRTCCallConnection3.onclose=this.$FBRTCCallConnectiono.bind(this);this.$FBRTCCallConnection3.onerror=this.$FBRTCCallConnectionp.bind(this);this.$FBRTCCallConnection3.onmessage=this.$FBRTCCallConnectionq.bind(this);};t.prototype.$FBRTCCallConnectionn=function(event){"use strict";this.$FBRTCCallConnection4.start();this.emit('data_opened',event);};t.prototype.$FBRTCCallConnectiono=function(event){"use strict";this.$FBRTCCallConnectionh(null);this.emit('data_closed',event);};t.prototype.$FBRTCCallConnectionp=function(event){"use strict";this.$FBRTCCallConnectionh(null);this.emit('data_error',event);};t.prototype.$FBRTCCallConnectionq=function(event){"use strict";this.emit('data_message',JSON.parse(event.data).msg);};t.prototype.isDataChannelOpen=function(){"use strict";return (!!this.$FBRTCCallConnection3&&this.$FBRTCCallConnection3.readyState==='open');};t.prototype.sendData=function(u){"use strict";this.$FBRTCCallConnection4.enqueue(JSON.stringify({msg:u}));};t.prototype.$FBRTCCallConnection5=function(u){"use strict";if(!this.isDataChannelOpen()){n(false);return;}this.$FBRTCCallConnection3.send(u);};t.prototype.createOffer=function(){"use strict";this.$FBRTCCallConnection2=this.$FBRTCCallConnectioni();if(g.shouldCreateDataChannel())this.$FBRTCCallConnectionh(this.$FBRTCCallConnection2.createDataChannel(s));this.$FBRTCCallConnectionr('offer');this.$FBRTCCallConnectionc='active';};t.prototype.createSdpUpdate=function(){"use strict";var u=this.$FBRTCCallConnection2.getLocalStreams();for(var v=0;v<u.length;v++)this.$FBRTCCallConnection2.removeStream(u[v]);this.$FBRTCCallConnection2.addStream(this.$FBRTCCallConnectione.getStream());if(this.$FBRTCCallConnectionf)this.$FBRTCCallConnection2.addStream(this.$FBRTCCallConnectionf.getStream());this.$FBRTCCallConnectionr('sdp_update');};t.prototype.$FBRTCCallConnectionr=function(u){"use strict";this.$FBRTCCallConnectionb=true;this.$FBRTCCallConnection2.createOffer(this.$FBRTCCallConnections.bind(this,u),this.$FBRTCCallConnectiont.bind(this,'CreateOfferFailed'),this.$FBRTCCallConnectionu());};t.prototype.$FBRTCCallConnectionu=function(){"use strict";if(m.isBrowser('Chrome <= 37')||m.isBrowser('Opera <= 25'))return {mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:this.$FBRTCCallConnectiond}};return {offerToReceiveAudio:true,offerToReceiveVideo:this.$FBRTCCallConnectiond};};t.prototype.end=function(){"use strict";this.$FBRTCCallConnection0.logToConsole('Ending connection...');if(this.$FBRTCCallConnection2){this.emit('isEnding');this.$FBRTCCallConnectiong(this.$FBRTCCallConnection2,false);this.$FBRTCCallConnection2=null;}};t.prototype.onReceivedOfferSDP=function(u){"use strict";this.$FBRTCCallConnection2=this.$FBRTCCallConnectioni();if(g.shouldCreateDataChannel())this.$FBRTCCallConnection2.ondatachannel=function(event){this.$FBRTCCallConnectionh(event.channel);}.bind(this);var v=new this.nativeSessionDescription({type:'offer',sdp:u});this.$FBRTCCallConnection2.setRemoteDescription(v,this.$FBRTCCallConnectionv.bind(this,v),this.$FBRTCCallConnectiont.bind(this,'SetRemoteOfferFailed'));};t.prototype.onReceivedAnswerSDP=function(u){"use strict";var v=new this.nativeSessionDescription({type:'answer',sdp:u});this.$FBRTCCallConnection2.setRemoteDescription(v,this.$FBRTCCallConnectionv.bind(this,v),this.$FBRTCCallConnectiont.bind(this,'SetRemoteAnswerFailed'));};t.prototype.onReceivedSdpUpdate=function(u){"use strict";if(this.$FBRTCCallConnectionb)setTimeout(function(){this.onReceivedSdpUpdate(u);}.bind(this),200);switch(this.$FBRTCCallConnection2.signalingState){case 'stable':this.$FBRTCCallConnectionw(u,'offer');break;case 'have-local-offer':u=j.setDtlsRole(u,this.$FBRTCCallConnectionc);this.$FBRTCCallConnectionw(u,'answer');break;case 'have-remote-offer':setTimeout(function(){this.onReceivedSdpUpdate(u);}.bind(this),1000);break;case 'have-local-pranswer':case 'have-remote-pranswer':break;case 'closed':break;}};t.prototype.$FBRTCCallConnectionw=function(u,v){"use strict";var w=new this.nativeSessionDescription({type:v,sdp:u});this.$FBRTCCallConnectionb=true;this.$FBRTCCallConnection2.setRemoteDescription(w,function(){this.$FBRTCCallConnection0.logToConsole('sdp update '+w.type+' set');if(this.$FBRTCCallConnection2&&w.type==='offer'){this.$FBRTCCallConnection2.createAnswer(this.$FBRTCCallConnections.bind(this,'sdp_update'),this.$FBRTCCallConnectiont.bind(this,'CreateSdpUpdateFailed'));}else this.$FBRTCCallConnectionb=false;}.bind(this),this.$FBRTCCallConnectiont.bind(this,'SetRemoteSdpUpdateFailed'));};t.prototype.onReceivedRemoteIceCandidate=function(u){"use strict";u.sdp=j.fixMobileIceSdp(u.sdp);var v=new this.nativeIceCandidate({sdpMLineIndex:u.label,candidate:u.sdp,sdpMid:u.sdp_mid});this.$FBRTCCallConnection2.addIceCandidate(v);};t.prototype.getStats=function(u){"use strict";k.getStats(this.$FBRTCCallConnection2,u);};t.prototype.getCreatedIceCandidates=function(){"use strict";return this.$FBRTCCallConnectiona;};t.prototype.$FBRTCCallConnections=function(u,v){"use strict";this.$FBRTCCallConnection0.logToConsole('Created '+u+' sdp');if(!this.$FBRTCCallConnection2){this.$FBRTCCallConnection0.logToConsole('_onSDPCreated: pc has been deallocated');return;}if(!this.$FBRTCCallConnectiond&&u==='sdp_update')v.sdp=j.disableVideo(v.sdp);v.sdp=j.addIceOptionToSdp(v.sdp,"fb-force-5245");v.sdp=j.preferIsac(v.sdp);v.sdp=j.removeSdparta(v.sdp);this.$FBRTCCallConnection2.setLocalDescription(v,function(){this.$FBRTCCallConnectionb=false;this.$FBRTCCallConnection0.logToConsole('Local '+u+' set');this.emit('sdpCreated',{type:u,sdp:v.sdp});}.bind(this),this.$FBRTCCallConnectiont.bind(this,("SetLocalDescriptionFailed:"+u)));};t.prototype.$FBRTCCallConnectionv=function(u){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote '+u.type+' set');if(!this.$FBRTCCallConnection2){this.$FBRTCCallConnection0.logToConsole('_onRemoteDescriptionSet: pc has been deallocated');return;}if(u.type==='offer')this.$FBRTCCallConnection2.createAnswer(this.$FBRTCCallConnections.bind(this,'answer'),this.$FBRTCCallConnectiont.bind(this,'CreateAnswerFailed'));this.emit('remoteDescriptionSet');};t.prototype.$FBRTCCallConnectionj=function(event){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote stream added');this.emit('remoteStreamAdded',{stream:event.stream});};t.prototype.$FBRTCCallConnectionk=function(event){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote stream removed');this.emit('remoteStreamRemoved',{stream:event.stream});};t.prototype.$FBRTCCallConnectionl=function(event){"use strict";if(event.candidate){this.$FBRTCCallConnectiona.push(event.candidate);this.emit('localIceCandidateCreated',event.candidate);}};t.prototype.$FBRTCCallConnectionm=function(event){"use strict";var u=event.target.iceConnectionState;this.$FBRTCCallConnection0.logToConsole('Ice candidate state changed from '+this.$FBRTCCallConnection6+' to '+u);if(u===this.$FBRTCCallConnection6)return;this.$FBRTCCallConnectionx();if(this.$FBRTCCallConnectiony(u)){if(!this.$FBRTCCallConnection8){this.emit('connected');this.$FBRTCCallConnection8=true;}}else if(u==='disconnected'){this.$FBRTCCallConnectionz();}else if(u==='failed')this.$FBRTCCallConnectionA();this.$FBRTCCallConnection6=u;};t.prototype.$FBRTCCallConnectiony=function(u){"use strict";return (u==='completed'||u==='connected');};t.prototype.$FBRTCCallConnectionz=function(){"use strict";if(this.$FBRTCCallConnectiony(this.$FBRTCCallConnection6)){var u=Date.now();if(this.$FBRTCCallConnectionB-u>=p)this.$FBRTCCallConnection9=0;this.$FBRTCCallConnection9=this.$FBRTCCallConnection9+1;this.$FBRTCCallConnectionB=u;if(this.$FBRTCCallConnection9>=2)this.emit('connectionUnstable');}var v=this;this.$FBRTCCallConnection7=setTimeout(function(){v.emit('disconnected');},q);};t.prototype.$FBRTCCallConnectionA=function(){"use strict";var u=this;this.$FBRTCCallConnection7=setTimeout(function(){var v={details:'Ice candidate state failed',endCallSubreason:'IceFailed'};u.emit('connectionError',v);},r);};t.prototype.$FBRTCCallConnectionx=function(){"use strict";if(this.$FBRTCCallConnection7)clearTimeout(this.$FBRTCCallConnection7);this.$FBRTCCallConnection7=null;};t.prototype.$FBRTCCallConnectiont=function(u,v){"use strict";var w={details:v,endCallSubreason:u};this.emit('connectionError',w);};t.prototype.$FBRTCCallConnection1=function(){"use strict";if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection0.logToConsole('Using Chrome WebRTC APIs...');this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription;}else{this.$FBRTCCallConnection0.logToConsole('Using Firefox WebRTC APIs...');this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription;}};o(t,{remoteStreamAdded:true,remoteStreamRemoved:true,sdpCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true,data_opened:true,data_closed:true,data_error:true,data_message:true});e.exports=t;},null);
__d("RingBuffer",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){"use strict";this.$RingBuffer0=h;this.$RingBuffer1=-1;this.$RingBuffer2=[];}g.prototype.add=function(h){"use strict";this.$RingBuffer1=(this.$RingBuffer1+1)%this.$RingBuffer0;this.$RingBuffer2[this.$RingBuffer1]=h;};g.prototype.size=function(){"use strict";return this.$RingBuffer2.length;};g.prototype.head=function(){"use strict";if(this.$RingBuffer1===-1)return null;return this.$RingBuffer2[this.$RingBuffer1];};g.prototype.tail=function(){"use strict";if(this.$RingBuffer1===-1)return null;return this.$RingBuffer2[this.$RingBuffer3()];};g.prototype.forEach=function(h){"use strict";for(var i=0;i<this.$RingBuffer2.length;i++){var j=(this.$RingBuffer1+1+i)%this.$RingBuffer2.length;h(this.$RingBuffer2[j]);}};g.prototype.$RingBuffer3=function(){"use strict";return (this.$RingBuffer1+1)%this.$RingBuffer2.length;};e.exports=g;},null);
__d("FBRTCRttAggregator",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){"use strict";this.$FBRTCRttAggregator0=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}];}g.prototype.addRtt=function(h){"use strict";var i=this.$FBRTCRttAggregator0[this.$FBRTCRttAggregator1(h)];i.ave=this.$FBRTCRttAggregator2(i.ave,i.count,h);i.count+=1;};g.prototype.toString=function(){"use strict";return [this.$FBRTCRttAggregator3('50',this.$FBRTCRttAggregator0[0]),this.$FBRTCRttAggregator3('100',this.$FBRTCRttAggregator0[1]),this.$FBRTCRttAggregator3('200',this.$FBRTCRttAggregator0[2]),this.$FBRTCRttAggregator3('0',this.$FBRTCRttAggregator0[3])].join('|');};g.prototype.$FBRTCRttAggregator3=function(h,i){"use strict";return (""+h+"="+i.count+","+Math.round(i.ave));};g.prototype.$FBRTCRttAggregator1=function(h){"use strict";if(h<50)return 0;if(h<100)return 1;if(h<200)return 2;return 3;};g.prototype.$FBRTCRttAggregator2=function(h,i,j){"use strict";return (h*i+j)/(i+1);};e.exports=g;},null);
__d("FBRTCStatsInterpreter",["FBRTCLogger"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1000,bad_score_count:3};function i(j){"use strict";this.$FBRTCStatsInterpreter0=Object.assign({},h,j);this.$FBRTCStatsInterpreter1=g.getInstance();this.$FBRTCStatsInterpreter2=0;}i.prototype.interpretStats=function(j,k){"use strict";var l=j.videoRtt(),m=this.$FBRTCStatsInterpreter3(j),n=this.$FBRTCStatsInterpreter4(j,k),o=this.$FBRTCStatsInterpreter5(l,m,n);if(o>=this.$FBRTCStatsInterpreter0.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter2+=1;if(o<this.$FBRTCStatsInterpreter0.score_threshold&&this.$FBRTCStatsInterpreter2>0)this.$FBRTCStatsInterpreter2-=1;};i.prototype.isNetworkPoor=function(){"use strict";return this.$FBRTCStatsInterpreter2>=this.$FBRTCStatsInterpreter0.bad_score_count;};i.prototype.$FBRTCStatsInterpreter5=function(j,k,l){"use strict";return j*this.$FBRTCStatsInterpreter0.rtt_weight+k*this.$FBRTCStatsInterpreter0.frr_weight+l*this.$FBRTCStatsInterpreter0.plr_weight;};i.prototype.$FBRTCStatsInterpreter4=function(j,k){"use strict";var l,m;if(k){l=j.videoPacketsLost()-k.videoPacketsLost();m=j.videoPacketsSent()-k.videoPacketsSent();}else{l=j.videoPacketsLost();m=j.videoPacketsSent();}if(l<0||m===0)return 0;return (l/m);};i.prototype.$FBRTCStatsInterpreter3=function(j){"use strict";if(j.videoFrameRateCaptured()===0)return 0;return 1-(j.videoFrameRateSent()/j.videoFrameRateCaptured());};e.exports=i;},null);
__d("FBRTCCallConnectionMonitor",["RingBuffer","FBRTCRttAggregator","FBRTCStatsInterpreter","FBRTCConfig","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=3000,m=1,n=0,o=3;function p(q,r){"use strict";this.$FBRTCCallConnectionMonitor0=new i(j.statsInterpreterConfig());this.$FBRTCCallConnectionMonitor1=new h();this.$FBRTCCallConnectionMonitor2=new h();this.$FBRTCCallConnectionMonitor3=q;this.$FBRTCCallConnectionMonitor4=r;this.$FBRTCCallConnectionMonitor5=null;this.$FBRTCCallConnectionMonitor6=[];this.$FBRTCCallConnectionMonitor7=new g(m);this.$FBRTCCallConnectionMonitor8=0;this.$FBRTCCallConnectionMonitor3.addListener('connected',this.$FBRTCCallConnectionMonitor9,this);this.$FBRTCCallConnectionMonitor3.addListener('isEnding',this.$FBRTCCallConnectionMonitora,this);}p.prototype.$FBRTCCallConnectionMonitor9=function(){"use strict";var q=this.$FBRTCCallConnectionMonitorb.bind(this);this.$FBRTCCallConnectionMonitor5=setInterval(q,l);this.$FBRTCCallConnectionMonitorb();};p.prototype.$FBRTCCallConnectionMonitora=function(){"use strict";if(this.$FBRTCCallConnectionMonitor5!==null){this.$FBRTCCallConnectionMonitorb();clearInterval(this.$FBRTCCallConnectionMonitor5);this.$FBRTCCallConnectionMonitor5=null;}};p.prototype.$FBRTCCallConnectionMonitorb=function(){"use strict";this.$FBRTCCallConnectionMonitor3.getStats(function(q){var r;if(this.$FBRTCCallConnectionMonitor7.size()>0){r=this.$FBRTCCallConnectionMonitor7.head();this.$FBRTCCallConnectionMonitorc(q,r);}if(this.$FBRTCCallConnectionMonitor6.length<n)this.$FBRTCCallConnectionMonitor6.push(q);if(r&&r.isConnected()&&!q.isConnected())this.$FBRTCCallConnectionMonitor8+=1;if(this.$FBRTCCallConnectionMonitor8>=o)this.$FBRTCCallConnectionMonitor3.emit('disconnected');if(q.isConnected()){this.$FBRTCCallConnectionMonitor8=0;this.$FBRTCCallConnectionMonitor7.add(q);this.$FBRTCCallConnectionMonitor1.addRtt(q.audioRtt());this.$FBRTCCallConnectionMonitor2.addRtt(q.videoRtt());this.$FBRTCCallConnectionMonitor4.setPcStats(this.$FBRTCCallConnectionMonitord());this.$FBRTCCallConnectionMonitore(q,r);}}.bind(this));};p.prototype.$FBRTCCallConnectionMonitord=function(){"use strict";var q=this.$FBRTCCallConnectionMonitor7.head();return {end:{conn_type:q.connectionType()},sender:{bytes:q.audioBytesSent(),codec:{'0':q.audioCodec()},plost:q.audioPacketsLost(),psent:q.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor1.toString()},video:{sender:{bytes:q.videoBytesSent(),codec:{'0':q.videoCodec()},plost:q.videoPacketsLost(),psent:q.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()}}};};p.prototype.$FBRTCCallConnectionMonitorc=function(q,r){"use strict";if(r.videoPacketsLost()>q.videoPacketsLost())q.setVideoPacketsLost(r.videoPacketsLost());};p.prototype.$FBRTCCallConnectionMonitore=function(q,r){"use strict";this.$FBRTCCallConnectionMonitor0.interpretStats(q,r);if(this.$FBRTCCallConnectionMonitor0.isNetworkPoor())this.emit('connectionPoor');};k(p,{connectionPoor:true});e.exports=p;},null);
__d("FBRTCCallControlActions",["FBRTCDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({ACCEPT_ESCALATION:null,HANG_UP:null,ON_ESCALATION_REQUEST:null,TOGGLE_FULL_SCREEN:null,TOGGLE_MUTE_AUDIO:null,TOGGLE_MUTE_VIDEO:null,TOGGLE_SCREEN_SHARING:null,SHOW_SETTINGS:null,DECLINE_ESCALATION:null}),j={Types:i,hangUp:function(){g.dispatch({type:i.HANG_UP});},toggleMuteAudio:function(){g.dispatch({type:i.TOGGLE_MUTE_AUDIO});},toggleMuteVideo:function(){g.dispatch({type:i.TOGGLE_MUTE_VIDEO});},toggleFullScreen:function(){g.dispatch({type:i.TOGGLE_FULL_SCREEN});},showSettings:function(){g.dispatch({type:i.SHOW_SETTINGS});},toggleScreenSharing:function(){g.dispatch({type:i.TOGGLE_SCREEN_SHARING});},onEscalationRequest:function(k){g.dispatch({type:i.ON_ESCALATION_REQUEST,message:k});},acceptEscalation:function(){g.dispatch({type:i.ACCEPT_ESCALATION});},declineEscalation:function(){g.dispatch({type:i.DECLINE_ESCALATION});}};e.exports=j;},null);
__d("FBRTCStore",["FBRTCDispatcher","FluxStore"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(){h.call(this,g);}k.prototype.__emitChange=function(){this.__emitter.emit(this.__changeEvent);};e.exports=k;},null);
__d("FBRTCFullScreenController",["FBRTCCallControlActions","FBRTCStore"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i,j,k=document.documentElement;if(k.requestFullscreen){i=k.requestFullscreen.bind(k);j='fullscreenchange';}else if(k.msRequestFullscreen){i=k.msRequestFullscreen.bind(k);j='msfullscreenchange';}else if(k.mozRequestFullScreen){i=k.mozRequestFullScreen.bind(k);j='mozfullscreenchange';}else if(k.webkitRequestFullscreen){i=k.webkitRequestFullscreen.bind(k,Element.ALLOW_KEYBOARD_INPUT);j='webkitfullscreenchange';}var l;if(document.exitFullscreen){l=document.exitFullscreen.bind(document);}else if(document.msExitFullscreen){l=document.msExitFullscreen.bind(document);}else if(document.mozCancelFullScreen){l=document.mozCancelFullScreen.bind(document);}else if(document.webkitExitFullscreen)l=document.webkitExitFullscreen.bind(document);for(var m in h)if(h.hasOwnProperty(m))o[m]=h[m];var n=h===null?null:h.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=h;function o(){"use strict";h.call(this);this.$FBRTCFullScreenController0=this.$FBRTCFullScreenController1.bind(this);document.addEventListener(j,this.$FBRTCFullScreenController0);}o.prototype.destroy=function(){"use strict";document.removeEventListener(j,this.$FBRTCFullScreenController0);n.destroy.call(this);};o.prototype.$FBRTCFullScreenController1=function(){"use strict";this.__emitChange();};o.prototype.supportsFullScreen=function(){"use strict";return i&&l;};o.prototype.isFullScreen=function(){"use strict";return !!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);};o.prototype.$FBRTCFullScreenController2=function(){"use strict";if(this.isFullScreen()){l();}else i();};o.prototype.__onDispatch=function(p){"use strict";switch(p.type){case g.Types.TOGGLE_FULL_SCREEN:this.$FBRTCFullScreenController2();break;}};e.exports=new o();},null);
__d("XVideoCallUserInfoController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/userinfo\/",{user_id:{type:"Int",required:true}});},null);
__d("FBRTCPeerInfo",["ix","XVideoCallUserInfoController","FBRTCUtils"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this.peerID=k;this.peerPicUrl=null;this.selfPicUrl=g('/images/chat/webrtc/no_profile_pic.png');this.backgroundUrl=null;this.peerName='';this.peerShortName=null;}j.prototype.fetch=function(k,l){"use strict";var m=(h.getURIBuilder()).setInt('user_id',this.peerID).getURI(),n=this;i.sendServerRequest(m,function(o){n.peerPicUrl=o.payload.profile_pic_url;n.backgroundUrl=o.payload.cover_pic_url;n.peerName=o.payload.name;n.peerShortName=o.payload.peer_short_name;if(o.payload.self_profile_pic_url)n.selfPicUrl=o.payload.self_profile_pic_url;if(k)k();},l);};e.exports=j;},null);
__d("FBRTCStreamWrapper",["mixInEventEmitter","FBRTCUtils"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=100,j=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,k;function l(){"use strict";this.$FBRTCStreamWrapper0=true;this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=null;this.$FBRTCStreamWrapper3=null;this.aspectRatio=l.aspectRatios.other;this.videoWidth=0;this.videoHeight=0;}l.prototype.setStream=function(m,n){"use strict";var o=this.hasStream();this.stopStream();this.$FBRTCStreamWrapper2=m;this.$FBRTCStreamWrapper0=this.hasAudioTracks();this.$FBRTCStreamWrapper4();if(n){this.$FBRTCStreamWrapper2.onaddtrack=this.$FBRTCStreamWrapper5.bind(this);this.$FBRTCStreamWrapper2.onremovetrack=this.$FBRTCStreamWrapper5.bind(this);this.$FBRTCStreamWrapper2.onended=this.$FBRTCStreamWrapper6.bind(this);if(o)this.emit('tracksChanged');}};l.prototype.getStream=function(){"use strict";return this.$FBRTCStreamWrapper2;};l.prototype.hasStream=function(){"use strict";return !!this.$FBRTCStreamWrapper2;};l.isScreenStream=function(m){"use strict";if(m&&m.getAudioTracks().length===0)return true;return false;};l.prototype.stopStream=function(){"use strict";if(this.$FBRTCStreamWrapper2){if(this.$FBRTCStreamWrapper2.stop)this.$FBRTCStreamWrapper2.stop();this.$FBRTCStreamWrapper2=null;}};l.prototype.hasVideoTracks=function(){"use strict";if(this.$FBRTCStreamWrapper2)return this.$FBRTCStreamWrapper2.getVideoTracks().length>0;return true;};l.prototype.hasVideo=function(){"use strict";return this.$FBRTCStreamWrapper1&&this.hasVideoTracks();};l.prototype.hasAudioTracks=function(){"use strict";if(this.$FBRTCStreamWrapper2&&this.$FBRTCStreamWrapper2.getAudioTracks)return this.$FBRTCStreamWrapper2.getAudioTracks().length>0;return true;};l.prototype.hasAudio=function(){"use strict";return this.$FBRTCStreamWrapper0&&this.hasAudioTracks();};l.prototype.attachToVideoTag=function(m){"use strict";if(this.$FBRTCStreamWrapper2){this.$FBRTCStreamWrapper3=m;h.attachMediaStream(m,this.$FBRTCStreamWrapper2);this.$FBRTCStreamWrapper7(m);}};l.prototype.getAudioAnalyser=function(){"use strict";if(this.$FBRTCStreamWrapper2){var m=this.$FBRTCStreamWrapper8(),n=m.createMediaStreamSource(this.$FBRTCStreamWrapper2),o=m.createAnalyser();o.fftSize=2048;n.connect(o);return o;}};l.prototype.$FBRTCStreamWrapper8=function(){"use strict";if(!k)k=new j();return k;};l.prototype.toggleMuteAudio=function(){"use strict";if(!this.hasAudioTracks())return;var m=this.$FBRTCStreamWrapper2.getAudioTracks();this.$FBRTCStreamWrapper0=!this.$FBRTCStreamWrapper0;for(var n=0;n<m.length;n++)m[n].enabled=this.$FBRTCStreamWrapper0;};l.prototype.toggleMuteVideo=function(){"use strict";this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;if(this.$FBRTCStreamWrapper1){this.$FBRTCStreamWrapper4();}else setTimeout(this.$FBRTCStreamWrapper4.bind(this),500);this.$FBRTCStreamWrapper5();};l.prototype.$FBRTCStreamWrapper4=function(){"use strict";if(this.$FBRTCStreamWrapper2){var m=this.$FBRTCStreamWrapper2.getVideoTracks();for(var n=0;n<m.length;n++)m[n].enabled=this.$FBRTCStreamWrapper1;}};l.prototype.setVideoEnabled=function(m){"use strict";this.$FBRTCStreamWrapper1=m;this.$FBRTCStreamWrapper4();this.$FBRTCStreamWrapper5();};l.prototype.$FBRTCStreamWrapper7=function(m){"use strict";if(!this.hasVideo()||m.currentTime>0){this.$FBRTCStreamWrapper9(m);}else setTimeout(this.$FBRTCStreamWrapper7.bind(this,m),i);};l.prototype.$FBRTCStreamWrappera=function(m){"use strict";this.videoWidth=m.videoWidth;this.videoHeight=m.videoHeight;var n=m.videoWidth/m.videoHeight;if(h.aboutEqual(n,(16/9)))return l.aspectRatios['16:9'];if(h.aboutEqual(n,(4/3)))return l.aspectRatios['4:3'];return l.aspectRatios.other;};l.prototype.$FBRTCStreamWrapper9=function(m){"use strict";if(this.hasVideo()){this.aspectRatio=this.$FBRTCStreamWrappera(m);}else this.aspectRatio=l.aspectRatios.other;this.emit('streamStarted');};l.prototype.$FBRTCStreamWrapper6=function(){"use strict";this.emit('streamEnded');};l.prototype.$FBRTCStreamWrapper5=function(event){"use strict";if(this.$FBRTCStreamWrapperb(event))this.attachToVideoTag(this.$FBRTCStreamWrapper3);this.emit('tracksChanged');};l.prototype.$FBRTCStreamWrapperb=function(m){"use strict";return this.$FBRTCStreamWrapper3&&m&&m.type==='addtrack'&&m.track.kind==='video';};l.aspectRatios={'16:9':1,'4:3':2,other:3};g(l,{streamStarted:true,streamEnded:true,tracksChanged:true});e.exports=l;},null);
__d("FBRTCVideoDurationTracker",["performanceNow"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h=0;function i(j){this.$FBRTCVideoDurationTracker0=j;this.$FBRTCVideoDurationTracker1=0;this.$FBRTCVideoDurationTracker2=h;}i.prototype.startTracking=function(){if(this.$FBRTCVideoDurationTracker0.hasVideo())this.$FBRTCVideoDurationTracker2=this.$FBRTCVideoDurationTracker3();this.$FBRTCVideoDurationTracker4=this.$FBRTCVideoDurationTracker0.addListener('tracksChanged',function(){if(this.$FBRTCVideoDurationTracker0.hasVideo()&&!this.$FBRTCVideoDurationTracker2){this.$FBRTCVideoDurationTracker2=this.$FBRTCVideoDurationTracker3();}else if(!this.$FBRTCVideoDurationTracker0.hasVideo()){this.$FBRTCVideoDurationTracker1=this.getDuration();this.$FBRTCVideoDurationTracker2=h;}}.bind(this));};i.prototype.stopTracking=function(){this.$FBRTCVideoDurationTracker1=this.getDuration();this.$FBRTCVideoDurationTracker2=h;if(this.$FBRTCVideoDurationTracker4){this.$FBRTCVideoDurationTracker4.remove();this.$FBRTCVideoDurationTracker4=null;}};i.prototype.getDuration=function(){if(this.$FBRTCVideoDurationTracker2!==h){var j=this.$FBRTCVideoDurationTracker3()-this.$FBRTCVideoDurationTracker2;return this.$FBRTCVideoDurationTracker1+j;}return this.$FBRTCVideoDurationTracker1;};i.prototype.$FBRTCVideoDurationTracker3=function(){return g();};e.exports=i;},null);
__d("FBRTCCallModel",["FBRTCAdminMessage","FBRTCCallConstants","FBRTCCallControlActions","FBRTCConfig","FBRTCFullScreenController","FBRTCLogger","FBRTCPCConfig","FBRTCPeerInfo","FBRTCScreenSharingUtils","FBRTCStore","FBRTCStreamWrapper","FBRTCStruct","FBRTCUtils","FBRTCVideoDurationTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();for(var u in p)if(p.hasOwnProperty(u))w[u]=p[u];var v=p===null?null:p.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=p;function w(x){"use strict";p.call(this);this.$FBRTCCallModel0=l.getInstance();this.isCaller=x.isCaller;this.peerID=x.peerID;this.$FBRTCCallModel1=new n(x.peerID);this.$FBRTCCallModel2=false;this.$FBRTCCallModel3(x.callID);this.$FBRTCCallModel4();this.$FBRTCCallModel5(true);}w.prototype.resetForReconnect=function(x){"use strict";this.isCaller=false;this.$FBRTCCallModel3(x);this.$FBRTCCallModel5(false);};w.prototype.fetchPeerInfo=function(){"use strict";if(s.isCollabCallable(this.peerID))return;var x=this,y=function(){x.__emitChange();},z=function(){x.$FBRTCCallModel0.logError(x.peerID,x.callID,'Failed to get remote photos');};this.$FBRTCCallModel1.fetch(y,z);};w.prototype.setSignalingExperiments=function(x){"use strict";if(x||x===[])this.$FBRTCCallModel6=x;};w.prototype.supportsSdpUpdate=function(){"use strict";return this.$FBRTCCallModel6.indexOf('sdp_update')>-1&&j.supportedSignalingExperiments().indexOf('sdp_update')>-1;};w.prototype.canPeerReceiveScreenSharing=function(){"use strict";return this.$FBRTCCallModel6.indexOf('screen_sharing')>-1;};w.prototype.onSDPMessageFromPeer=function(x){"use strict";this.isRemoteVideoSupported=x.isRemoteVideoSupported();this.isPeerOnMobile=x.isFromMobile();if(!this.isRemoteVideoSupported)this.localStream.setVideoEnabled(false);};w.prototype.$FBRTCCallModel4=function(){"use strict";this.remoteStream=new q();this.localStream=new q();this.localStream.addListener('tracksChanged',function(){if(!this.$FBRTCCallModel7&&this.localStream.hasVideo())this.$FBRTCCallModel8=true;this.__emitChange();}.bind(this));this.$FBRTCCallModel9=new t(this.remoteStream);this.$FBRTCCallModela=new t(this.localStream);};w.prototype.$FBRTCCallModel3=function(x){"use strict";this.callID=x;this.$FBRTCCallModelb=new g(this.peerID,x);this.startTime=new Date();this.endCallReason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.isRemoteVideoSupported=true;this.isPeerOnMobile=false;this.$FBRTCCallModel7=true;this.$FBRTCCallModel8=false;this.$FBRTCCallModel6=[];this.$FBRTCCallModelc=null;};w.prototype.$FBRTCCallModel5=function(x){"use strict";this.selfViewOpen=true;this.uiState=w.UIState.INIT;this.__emitChange();};w.prototype.getLocalVideoDuration=function(){"use strict";return this.$FBRTCCallModela.getDuration();};w.prototype.getRemoteVideoDuration=function(){"use strict";return this.$FBRTCCallModel9.getDuration();};w.prototype.setLocalStream=function(x){"use strict";this.localStream.setStream(x);};w.prototype.setRemoteStream=function(x){"use strict";this.remoteStream.setStream(x);this.remoteStream.once('streamStarted',function(){this.setStateFrom(w.UIState.CALL_CONNECTING,w.UIState.CALL_CONNECTED);}.bind(this));this.remoteStream.addListener('tracksChanged',function(){this.__emitChange();}.bind(this));this.__emitChange();};w.prototype.setRemoteScreenStream=function(x){"use strict";this.$FBRTCCallModelc=x;this.__emitChange();};w.prototype.getRemoteScreenStream=function(){"use strict";return this.$FBRTCCallModelc;};w.prototype.canStartCall=function(){"use strict";return this.localStream.hasStream()&&m.turnIP;};w.prototype.isAwaitingUserStart=function(){"use strict";return this.uiState===w.UIState.AWAITING_USER_START;};w.prototype.isInProgress=function(){"use strict";return this.uiState>=w.UIState.CONTACTING&&this.uiState<w.UIState.CALL_ENDED;};w.prototype.isUserMediaPending=function(){"use strict";return this.uiState===w.UIState.PENDING_LOCAL_MEDIA;};w.prototype.isUserMediaDenied=function(){"use strict";return this.uiState===w.UIState.USER_MEDIA_DENIED;};w.prototype.isRemoteVideoActive=function(){"use strict";return this.uiState===w.UIState.CALL_CONNECTED&&this.remoteStream.hasVideo();};w.prototype.isEnded=function(){"use strict";return this.uiState>=w.UIState.CALL_ENDED;};w.prototype.isAwaitingAnswer=function(){"use strict";return this.uiState==w.UIState.CONTACTING||this.uiState==w.UIState.RINGING;};w.prototype.isFullScreen=function(){"use strict";return k.isFullScreen();};w.prototype.isScreenSharingEnabled=function(){"use strict";return this.$FBRTCCallModel2;};w.prototype.setScreenSharingStatus=function(x){"use strict";this.$FBRTCCallModel2=x;};w.prototype.peerPicUrl=function(){"use strict";return this.$FBRTCCallModel1.peerPicUrl;};w.prototype.selfPicUrl=function(){"use strict";return this.$FBRTCCallModel1.selfPicUrl;};w.prototype.backgroundUrl=function(){"use strict";return this.$FBRTCCallModel1.backgroundUrl;};w.prototype.peerName=function(){"use strict";return this.$FBRTCCallModel1.peerName;};w.prototype.peerShortName=function(){"use strict";if(this.$FBRTCCallModel1.peerShortName)return this.$FBRTCCallModel1.peerShortName;return this.$FBRTCCallModel1.peerName;};w.prototype.autoDisableVideo=function(){"use strict";if(this.$FBRTCCallModel7){this.$FBRTCCallModel7=false;this.$FBRTCCallModel0.logCallAction(this.peerID,this.callID,l.CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false);}};w.prototype.videoIsAutoDisabled=function(){"use strict";return !this.$FBRTCCallModel7&&!this.$FBRTCCallModel8&&!this.localStream.hasVideo();};w.prototype.$FBRTCCallModeld=function(){"use strict";this.localStream.toggleMuteAudio();this.$FBRTCCallModel0.logCallAction(this.peerID,this.callID,l.CallAction.SET_MUTE,!this.localStream.hasAudio()?'true':'false');this.__emitChange();};w.prototype.$FBRTCCallModele=function(x){"use strict";this.localStream.toggleMuteVideo();this.$FBRTCCallModel0.logCallAction(this.peerID,this.callID,l.CallAction.SET_VIDEO_ON,this.localStream.hasVideo());this.__emitChange();};w.prototype.toggleSelfView=function(){"use strict";this.selfViewOpen=!this.selfViewOpen;this.$FBRTCCallModel0.logCallAction(this.peerID,this.callID,l.CallAction.SET_SELF_VIEW_ON,!this.selfViewOpen?'true':'false');this.__emitChange();};w.prototype.setState=function(x){"use strict";if(x===this.uiState)return;var y=this.uiState;this.uiState=x;switch(x){case w.UIState.CALL_CONNECTED:this.wasConnected=true;this.$FBRTCCallModelb.onCallConnected();this.$FBRTCCallModel9.startTracking();this.$FBRTCCallModela.startTracking();break;case w.UIState.CALL_ENDED:this.$FBRTCCallModelb.onCallEnded();this.$FBRTCCallModel9.stopTracking();this.$FBRTCCallModela.stopTracking();if(this.isCaller&&y>w.UIState.MORE_INIT){var z=this.isRemoteVideoSupported?h.FBRTCCallType.VIDEO_CALL:h.FBRTCCallType.VOICE_CALL;this.$FBRTCCallModelb.submit(z);}break;}this.$FBRTCCallModel0.logInfo(this.peerID,this.callID,'UI: state change - "'+w.UIState.strNames[y]+'" to "'+w.UIState.strNames[x]+'"');this.__emitChange();};w.prototype.setStateFrom=function(x,y){"use strict";if(this.uiState===x){this.setState(y);}else this.$FBRTCCallModel0.logInfo(this.peerID,this.callID,'UI: Not at "'+w.UIState.strNames[x]+'", not moving to "'+w.UIState.strNames[y]+'"');};w.prototype.__onDispatch=function(x){"use strict";switch(x.type){case i.Types.TOGGLE_MUTE_AUDIO:this.$FBRTCCallModeld();break;case i.Types.TOGGLE_MUTE_VIDEO:this.$FBRTCCallModele();break;case o.ActionTypes.OPEN_IN_NEW:case o.ActionTypes.WINDOW_CLOSED:this.__emitChange();break;}};w.UIState=new r(['INIT','AWAITING_USER_START','PENDING_LOCAL_MEDIA','USER_MEDIA_DENIED','MORE_INIT','CONTACTING','RINGING','CALL_CONNECTING','CALL_CONNECTED','CALL_ENDED','COLLECT_RATING']);e.exports=w;},null);
__d("FBRTCCallMonitor",["FBRTCCallSummaryStore"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=10000,i=3000;function j(k){"use strict";this.$FBRTCCallMonitor0=k;this.$FBRTCCallMonitor1=null;this.$FBRTCCallMonitor2=g.getInstance();}j.prototype.startHeartbeat=function(k){"use strict";if(this.$FBRTCCallMonitor0.isEnded())return;var l=k();if(l)this.onCallHeartbeat(l);var m=this;setTimeout(function(){m.startHeartbeat(k);},h);};j.prototype.onCallHeartbeat=function(k){"use strict";var l=(new Date()).valueOf();if(!this.$FBRTCCallMonitor1||(l-this.$FBRTCCallMonitor1)>i)k.save(this.$FBRTCCallMonitor2);};e.exports=j;},null);
__d("FBRTCIceCache",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){"use strict";this.$FBRTCIceCache0={};}g.prototype.reset=function(h,i){"use strict";if(!this.$FBRTCIceCache0[h])this.$FBRTCIceCache0[h]={};this.$FBRTCIceCache0[h][i]=[];};g.prototype.cacheCandidate=function(h,i,j){"use strict";if(!this.$FBRTCIceCache0[h])this.$FBRTCIceCache0[h]={};if(!this.$FBRTCIceCache0[h][i])this.$FBRTCIceCache0[h][i]=[];this.$FBRTCIceCache0[h][i].unshift(j);};g.prototype.drainCandidates=function(h,i,j){"use strict";if(this.$FBRTCIceCache0[h]&&this.$FBRTCIceCache0[h][i]){var k;while(this.$FBRTCIceCache0[h][i].length>0){k=this.$FBRTCIceCache0[h][i].pop();j(k);}}};e.exports=g;},null);
__d("FBRTCLocalMessageQueue",["CacheStorage","FBRTCLogger"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i='localstorage',j='RTC_',k='offer',l='offer_msg',m='data_',n=30*1000,o=15*1000,p=500;function q(){"use strict";this.$FBRTCLocalMessageQueue0=h.getInstance();}q.prototype.enqueueOffer=function(r,s){"use strict";var t=this.$FBRTCLocalMessageQueue1(r,l);this.$FBRTCLocalMessageQueue2(t,k,s);};q.prototype.getOffer=function(r){"use strict";var s=this.$FBRTCLocalMessageQueue1(r,l);return this.$FBRTCLocalMessageQueue3(s,k);};q.prototype.removeOffer=function(r){"use strict";var s=this.$FBRTCLocalMessageQueue1(r,l);s.remove(k);};q.prototype.enqueueMessage=function(r,s,t,u){"use strict";var v=this.$FBRTCLocalMessageQueue1(r,s),w=m+t.toString();this.$FBRTCLocalMessageQueue2(v,w,u);this.$FBRTCLocalMessageQueue0.logToConsole('Queued '+w);};q.prototype.enableDequeuing=function(r,s,t,u){"use strict";if(u===(void 0))u=o;this.$FBRTCLocalMessageQueue4(r,s,t,u);};q.prototype.$FBRTCLocalMessageQueue4=function(r,s,t,u){"use strict";var v=this.$FBRTCLocalMessageQueue1(r,s),w=v.keys(),x=w.length;for(var y=0;y<x;y++){var z=this.$FBRTCLocalMessageQueue5(v,w[y]);if(z&&t)t(z);}this.$FBRTCLocalMessageQueue0.logToConsole('Dequeued '+x+' ('+r+') with '+u+' left)');if(u>0){u-=p;setTimeout(function(){this.$FBRTCLocalMessageQueue4(r,s,t,u);}.bind(this),p);}};q.prototype.$FBRTCLocalMessageQueue2=function(r,s,t){"use strict";var u={__t:Date.now(),__d:t};r.set(s,u);};q.prototype.$FBRTCLocalMessageQueue3=function(r,s){"use strict";var t=r.get(s);if(t&&this.$FBRTCLocalMessageQueue6(t)){return t.__d;}else if(t)r.remove(s);return null;};q.prototype.$FBRTCLocalMessageQueue5=function(r,s){"use strict";var t=this.$FBRTCLocalMessageQueue3(r,s);if(t!==null){r.remove(s);return t;}return null;};q.prototype.$FBRTCLocalMessageQueue6=function(r){"use strict";return Date.now()-r.__t<n;};q.prototype.$FBRTCLocalMessageQueue1=function(r,s){"use strict";return new g(i,(""+j+r+"_"+s+"_"));};e.exports=q;},null);
__d("FBRTCMessage",["FBRTCConstants","FBRTCSdpUtils","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j='mobile';k.createFromOffer=function(l,m){"use strict";if(l.type==='webrtc')return new k(l);var n={type:"webrtc",msg_type:"offer",id:l.msg_id.toString(),from:m,call_id:l.call_id.toString(),payload:JSON.stringify(l)};return new k(n);};function k(l){"use strict";if(!this.$FBRTCMessage0(l))throw 'invalid webrtc message';this.originalMessageData=l;this.peerID=l.from;this.callID=parseInt(l.call_id,10);this.msg=JSON.parse(l.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.source=l.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$FBRTCMessage1();this.$FBRTCMessage2();}k.prototype.$FBRTCMessage0=function(l){"use strict";return l.from&&l.call_id&&l.payload;};k.prototype.$FBRTCMessage1=function(){"use strict";if(i.isVideoInteropSupported()&&this.peerSupportsVideoInterop)return;if(this.isFromMobile()){if(this.msg.sdp)this.msg.sdp=h.disableVideo(this.msg.sdp);if(this.msgType===g.PayloadType.SET_VIDEO||this.msgType===g.PayloadType.OFFER||this.msgType===g.PayloadType.ICERESTART_OFFER||this.msgType===g.PayloadType.ANSWER||this.msgType===g.PayloadType.ICERESTART_ANSWER)this.msg.videoon=false;}};k.prototype.$FBRTCMessage2=function(){"use strict";if(this.isFromMobile()&&this.msg.sdp&&this.msgType!==g.PayloadType.ICE_CANDIDATE)this.msg.sdp=h.removeFEC(this.msg.sdp);};k.prototype.isOffer=function(){"use strict";return this.msgType===g.PayloadType.OFFER;};k.prototype.isFromMobile=function(){"use strict";return (this.source===j);};k.prototype.isRemoteVideoSupported=function(){"use strict";if(!this.msg.sdp||this.msgType===g.PayloadType.ICE_CANDIDATE)return true;return h.isVideoSupported(this.msg.sdp);};k.prototype.isRetry=function(){"use strict";return !!this.msg.flag;};k.prototype.isForCall=function(l){"use strict";return !l.callID||l.callID===this.callID||this.msgType===g.PayloadType.OFFER||this.msgType===g.PayloadType.ICERESTART_OFFER||this.msgType===g.PayloadType.PCRESTART_OFFER||this.msgType===g.PayloadType.ICE_CANDIDATE;};k.prototype.getSignalingExperiments=function(){"use strict";if(this.isFromMobile()&&!this.msg.experiments)return ['sdp_update'];return this.msg.experiments;};e.exports=k;},null);
__d("FBRTCMessageDedup",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={},h={check:function(i,j,k){if(!g[i])g[i]={};if(!g[i][j])g[i][j]={};if(g[i][j][k])return false;g[i][j][k]=true;return true;}};e.exports=h;},null);
__d("SamplingPolicyBase",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){"use strict";throw 'Tried to instantiate SamplingPolicyBase';}g.prototype.getName=function(){"use strict";return this.name;};g.prototype.isSampled=function(){"use strict";if(typeof(this.sampled)=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};e.exports=g;},null);
__d("FbtraceForcedByServerPolicy",["FbtraceForcedByServer","SamplingPolicyBase"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i;function j(){this.name='FbtraceForcedByServerPolicy';}j.get=function(){if(typeof(i)=='undefined')i=new j();return i;};function k(){return g.forced;}Object.assign(j.prototype,h.prototype,{decideIfSampled:k});e.exports=j;},null);
__d("guardFunction",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i,j){return function(){if(h.apply(j||this,arguments))i.apply(j||this,arguments);};}e.exports=g;},null);
__d("Fbtrace",["Arbiter","BanzaiScribe","ErrorUtils","FbtraceForcedByServer","FbtraceForcedByServerPolicy","Random","SiteData","guardFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',p='AAAAAAAAAAA';for(var q in Error)if(Error.hasOwnProperty(q))s[q]=Error[q];var r=Error===null?null:Error.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=Error;function s(ha){Error.call(this,ha);}function t(ha){i.reportError(new s(ha));}function u(){var ha=function(){var ka=0,la=0,ma='';for(var na=10;na>=0;na--){if(ka<6){la=l.uint32();ka=32;}if(na===0)la=la&7;ma=o.charAt(la&63)+ma;la>>=6;ka-=6;}return ma;},ia,ja;for(ia=3;ia>0;ia--){ja=ha();if(ja!=p)return ja;}t('failed to generate valid Fbtrace id');return p;}function v(){Object.assign(this,v);}Object.assign(v,{isOn:function(){return false;},replySend:function(ha,ia){},requestSend:function(ha,ia,ja){ba(ha,ia);return {metadata:function(){return (void 0);},replyReceive:function(ka){}};}});var w=new v();function x(ha,ia,ja){if(!ha)throw {name:'ArgumentError',message:'no valid service name specified'};if(!ia)throw {name:'ArgumentError',message:'no valid version specified'};var ka=h,la=0,ma=u(),na=u(),oa=aa(ma),pa={service:ha,version:ia},qa=function(va){if(typeof(va)=='undefined')return 'undefined';if(typeof(va)!='string')va=qa(JSON.stringify(va));return va;},ra=function(va){var wa='';for(var xa in va){if(wa.length>0)wa+='\x02';wa+=qa(xa)+'\x03'+qa(va[xa]);}return wa;},sa=function(va,wa,event,xa,ya){la++;return [ya,la,ma,va,wa,qa(event),ra(xa)].join('\x01');},ta=function(va,wa,event,xa,ya){if(!ya&&typeof(ya)=='undefined')ya=Date.now()*1000;var za=sa(va,wa,event,xa,ya);ka.log('fbtrace',za,oa);},ua=function(){return na;};ta(p,na,'#rqrecv',Object.assign(ja||{},pa));Object.assign(this,x,{replySend:function(va,wa){wa=Object.assign({},wa,pa,{success:va?'true':'false'});ta(p,na,'#rpsend',wa);},requestSend:function(va,wa,xa){ba(va,wa);var ya=ua(),za=u();xa=Object.assign({},xa,pa,{op:va,'remote:service':wa});ta(ya,za,'#rqsend',xa);return {metadata:function(){return ma+za;},replyReceive:function(ab){ta(ya,za,'#rprecv',Object.assign(ab||{},pa));},parentNode:this};}});}Object.assign(x,{isOn:function(){return true;}});function y(){return w;}function z(ha,ia,ja){ja=ja||{};ja.init=true;var ka=k.get();if(ka.isSampled()){return new x(ha,ia,ja);}else return new v();}function aa(ha){var ia=ha.charAt(ha.length-1);return o.indexOf(ia)%32;}function ba(ha,ia){if(!ha)throw {name:'ArgumentError',message:'no valid operation specified'};if(!ia)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function ca(ha,ia){var ja=w,ka;w=ha;try{ka=ia();}finally{w=ja;}return ka;}var da=function(ha,ia){var ja=y(),ka=ia.request,la=false;if(!ja.isOn()&&j.forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(ka.uri.toString())){ja=z('photo_upload_kludge',String(m.revision||'dev'),{policy:'PhotoUpload'});la=true;}if(ja.isOn()){var ma=la?{policy:'PhotoUpload'}:{};if(ka.userActionId)ma.user_action_id=ka.userActionId;var na=ja.requestSend(ka.uri.toString(),'www',ma);ka.fbtraceRemoteNode=na;ka.transport.setRequestHeader('X-Fbtrace-Meta',na.metadata());}},ea=function(ha,ia){ia.request.fbtraceRemoteNode.replyReceive({is_last:ia.response.is_last,success:true});setTimeout(function(){ia.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},fa=function(ha,ia){ia.request.fbtraceRemoteNode.replyReceive({is_last:ia.response.is_last,success:false,error_code:ia.response.error,error_summary:ia.response.errorSummary,error_description:ia.response.errorDescription});setTimeout(function(){ia.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},ga=function(ha,ia){return ia.request.fbtraceRemoteNode;};g.subscribe('AsyncRequest/will_send',da);g.subscribe('AsyncRequest/response',n(ga,ea));g.subscribe('AsyncRequest/error',n(ga,fa));e.exports={defaultNode:y,requestReceive:z,withDefaultNode:ca};},null);
__d("XVideoCallSendMessageController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});},null);
__d("FBRTCMessageSender",["CurrentUser","FBRTCConfig","FBRTCConstants","FBRTCLogger","FBRTCUtils","Fbtrace","Map","SiteData","VideoCallSupport","XVideoCallSendMessageController","XCollabCallSendMessageController","errorCode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=0;function t(){"use strict";this.onSendFailure=null;this.$FBRTCMessageSender0=j.getInstance();}t.prototype.sendOffer=function(u,v,w,x){"use strict";return this.$FBRTCMessageSender1(i.PayloadType.OFFER,u,v,w,x);};t.prototype.sendAnswer=function(u,v,w,x){"use strict";return this.$FBRTCMessageSender1(i.PayloadType.ANSWER,u,v,w,x);};t.prototype.sendPCRestartOffer=function(u,v,w,x){"use strict";return this.$FBRTCMessageSender1(i.PayloadType.PCRESTART_OFFER,u,v,w,x);};t.prototype.sendSdpUpdate=function(u,v,w,x){"use strict";return this.$FBRTCMessageSender1(i.PayloadType.SDP_UPDATE,u,v,w,x);};t.prototype.resendSdpMessage=function(u,v){"use strict";v.flag=1;this.$FBRTCMessageSender2(u,v);};t.prototype.$FBRTCMessageSender1=function(u,v,w,x,y){"use strict";var z=this.$FBRTCMessageSender3(w,u);z.sdp=x;if(u===i.PayloadType.OFFER){z.handlescollision=true;z.pranswer=false;}if(u===i.PayloadType.OFFER||u===i.PayloadType.ANSWER){z.icerestart=false;z.experiments=h.supportedSignalingExperiments();}z.videoon=y;this.$FBRTCMessageSender2(v,z);return z;};t.prototype.sendIceCandidate=function(u,v,w){"use strict";var x=this.$FBRTCMessageSender3(v,i.PayloadType.ICE_CANDIDATE);x.sdp_mid=w.sdpMid;x.label=w.sdpMLineIndex;x.sdp=w.candidate;this.$FBRTCMessageSender4(u,x);};t.prototype.sendHangup=function(u,v,w,x){"use strict";var y=this.$FBRTCMessageSender3(v,i.PayloadType.HANGUP);y.reason=i.callEndReasonString(w);this.$FBRTCMessageSender4(u,y,x);};t.prototype.sendOtherDismiss=function(u){"use strict";var v=this.$FBRTCMessageSender3(u,i.PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(g.getID(),v);};t.prototype.sendOfferAck=function(u,v,w){"use strict";this.$FBRTCMessageSender5(u,v,w,i.PayloadType.OFFER_ACK);};t.prototype.sendOfferNack=function(u,v,w){"use strict";this.$FBRTCMessageSender5(u,v,w,i.PayloadType.OFFER_NACK,new m([['error_code',1356043]]));};t.prototype.sendAnswerAck=function(u,v,w){"use strict";this.$FBRTCMessageSender5(u,v,w,i.PayloadType.ANSWER_ACK);};t.prototype.sendAck=function(u,v,w){"use strict";this.$FBRTCMessageSender5(u,v,w,i.PayloadType.ACK,new m([['ack_type',w.type]]));};t.prototype.sendMuteStateUpdate=function(u,v,w){"use strict";var x=this.$FBRTCMessageSender3(v,i.PayloadType.SET_VIDEO);x.videoon=w;this.$FBRTCMessageSender4(u,x);};t.prototype.sendVideoEscalationRequest=function(u,v,w){"use strict";return this.sendVideoRequestResponse(u,v,0,w);};t.prototype.sendVideoRequestResponse=function(u,v,w,x){"use strict";var y=this.$FBRTCMessageSender3(v,i.PayloadType.VIDEO_REQUEST);y.ack_id=w;y.videoon=x;y.capability=o.getCapabilities();this.$FBRTCMessageSender4(u,y);return y.msg_id;};t.prototype.sendMsgAck=function(){"use strict";};t.prototype.sendOk=function(){"use strict";};t.prototype.sendPranswer=function(){"use strict";};t.prototype.sendIcerestartAnswer=function(){"use strict";};t.prototype.$FBRTCMessageSender3=function(u,v){"use strict";var w=k.generateRandomInt(),x={version:s,type:v,call_id:u,msg_id:w};if(this.$FBRTCMessageSender6(v))x.supports_video_interop=true;return x;};t.prototype.$FBRTCMessageSender6=function(u){"use strict";if(o.isVideoInteropSupported())return (u===i.PayloadType.OFFER||u===i.PayloadType.ANSWER||u===i.PayloadType.PRANSWER||u===i.PayloadType.ICERESTART_OFFER||u===i.PayloadType.ICERESTART_ANSWER||u===i.PayloadType.PCRESTART_OFFER||u===i.PayloadType.PCRESTART_ANSWER||u===i.PayloadType.SDP_UPDATE||u===i.PayloadType.SET_VIDEO||u===i.PayloadType.VIDEO_REQUEST);return false;};t.prototype.$FBRTCMessageSender2=function(u,v){"use strict";this.$FBRTCMessageSender4(u,v,false,true,true);};t.prototype.$FBRTCMessageSender5=function(u,v,w,x){"use strict";for(var y=[],z=4,aa=arguments.length;z<aa;z++)y.push(arguments[z]);var ba=y[0]||new m(),ca=this.$FBRTCMessageSender3(v,x);ca.ack_id=w.msg_id;if(w.flag===1)ca.flag=1;ba.forEach(function(da,ea,fa){ca[ea]=da;});this.$FBRTCMessageSender4(u,ca);};t.prototype.$FBRTCMessageSender4=function(u,v,w,x,y){"use strict";var z=v.msg_id,aa={peer_id:u,call_id:v.call_id,msg_id:z,msg_type:v.type},ba={call_id:v.call_id,msg_id:z,user_id:g.getID(),recipient_id:u,msg_type:v.type,app_id:256281040558,app_version:String(n.revision||'dev'),op:'sendServerRequest:'+v.type,policy:'WebRTC'},ca=l.requestReceive('browser',String(n.revision||'dev'),ba),da=(k.isCollabCallable(u)?q:p).getURIBuilder().setInt('recipient_id',u).setInt('msg_id',z).setString('message_info',JSON.stringify(v)).setInt('webrtc_fbtrace',ca.isOn()?1:0).getURI();if(x)var ea=this.$FBRTCMessageSender4.bind(this,u,v,w,false,y);var fa=this.$FBRTCMessageSender7.bind(this,aa),ga=this.$FBRTCMessageSender8.bind(this,aa,ea,y);l.withDefaultNode(ca,function(){k.sendServerRequest(da,fa,ga,w);});if(this.onMessageSent)this.onMessageSent(u,v);this.$FBRTCMessageSender0.logSentMessage(u,v.call_id,v);};t.prototype.$FBRTCMessageSender7=function(u){"use strict";this.$FBRTCMessageSender0.logSentMessageSuccess(u.peer_id,u.call_id,u.msg_type,u.msg_id);};t.prototype.$FBRTCMessageSender8=function(u,v,w,x){"use strict";if(x)var y=x.getError?x.getError():x;this.$FBRTCMessageSender0.logSentMessageFailure(u.peer_id,u.call_id,u.msg_type,u.msg_id,y);var z=null;if(y===1356001||y===1356049){z=i.CallEndReason.NO_PERMISSION;}else if(y===1356046||y===1356045){z=i.CallEndReason.CALLER_NOT_VISIBLE;}else if(y===1356003||y===1356002||y===1356044)z=i.CallEndReason.OTHER_NOT_CAPABLE;if(!z&&v){v();return;}if(w&&this.onSendFailure){if(!z)z=i.CallEndReason.SIGNALING_MESSAGE_FAILED;this.onSendFailure(z,y,u.msg_type);}};e.exports=t;},null);
__d("XVideoCallTurnDiscoveryController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/turndiscovery\/",{version:{type:"Int",required:true}});},null);
__d("FBRTCTurnDiscovery",["FBRTCLogger","FBRTCUtils","XVideoCallTurnDiscoveryController","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=3,l={requestTurnCreds:function(m,n){if(this._turnCreds)this.emit('receivedTurnCreds',this._turnCreds);if(n===(void 0))n=k;var o=1,p=(i.getURIBuilder()).setInt('version',o).getURI();h.sendServerRequest(p,this._onServerRequestSuccess.bind(this),this._onServerRequestFailure.bind(this,m,n));},_onServerRequestSuccess:function(m){this._turnCreds=m.payload;this.emit('receivedTurnCreds',this._turnCreds);},_onServerRequestFailure:function(m,n,o){if(n>0){g.getInstance().logError(m.peerID,m.callID,'Failed turn; going to retry');this.requestTurnCreds(m,n-1);}else this.emit('failed');}};j(l,{receivedTurnCreds:true,failed:true});e.exports=l;},null);
__d("FBRTCRingback",["RTCConfig","Sound","FBRTCCallModel"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=[g.ringback_mp3_url,g.ringback_ogg_url],k={monitorCallModel:function(l){if(this._subscription)this._subscription.remove();this._callModel=l;this._subscription=l.addListener(this._onChange.bind(this));},_soundIsPlaying:false,_onChange:function(){if(this._callModel.uiState===i.UIState.RINGING){this._startSound();}else this._stopSound();},_startSound:function(){if(!this._soundIsPlaying){h.play(j,this._syncToken(),true);this._soundIsPlaying=true;}},_syncToken:function(){return 'ring_back_'+this._callModel.callID.toString();},_stopSound:function(){if(this._soundIsPlaying){h.stop(j);this._soundIsPlaying=false;}}};e.exports=k;},null);
__d("FBRTCScreenStreamWrapper",["FBRTCStreamWrapper"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(){if(g!==null)g.apply(this,arguments);}j.prototype.toggleMuteAudio=function(){return;};j.prototype.toggleMuteVideo=function(){return;};e.exports=j;},null);
__d("FBRTCVideo.react",["React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g.createClass({displayName:"FBRTCVideo",hideContextMenu:function(k){k.preventDefault();},componentDidMount:function(){this._attachStream();},shouldComponentUpdate:function(k,l){return this._streamDidChange();},componentDidUpdate:function(k,l){this._attachStream();},_attachStream:function(){if(this.props.stream){var k=g.findDOMNode(this);this.props.stream.attachToVideoTag(k);this._currentStream=this.props.stream.getStream();}},_streamDidChange:function(){var k=this.props.stream?this.props.stream.getStream():null;return k!==this._currentStream;},render:function(){return (g.createElement("video",{className:i(this.props.className,"_4bad"),autoPlay:'true',muted:this.props.muted,onContextMenu:this.hideContextMenu}));}});e.exports=j;},null);
__d("FBRTCScreenSharingView.react",["FBRTCConstants","FBRTCScreenStreamWrapper","FBRTCVideo.react","React","cx","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"FBRTCScreenSharingView",propTypes:{isStandalone:n.bool,publishFn:n.func,screenStream:n.instanceOf(h),screenSrc:n.string},getDefaultProps:function(){return {isStandalone:false,publishFn:l};},render:function(){var p=this.props.isStandalone,q=this.props.screenStream,r=this.props.screenSrc;if(q&&q.hasStream()){return (j.createElement("div",{className:this._baseClasses()},this._renderOpenInNewButton(),j.createElement("div",{className:this._wrapperClass()},j.createElement(i,{stream:q}))));}else if(p&&r){return this._renderStandalone(r);}else return j.createElement("div",{className:"_2uql"});},_baseClasses:function(){return (("_2uqm")+(this.props.isStandalone?' '+"_2uqn":''));},_buttonClasses:function(){return (("_2uqo"));},_buttonIconClasses:function(){return (("_2uqp"));},_wrapperClass:function(){return (("_2uqq"));},_renderOpenInNewButton:function(){if(!this.props.isStandalone)return (j.createElement("button",{className:this._buttonClasses(),onClick:this._openInNewWindow},j.createElement("i",{className:this._buttonIconClasses()})));},_openInNewWindow:function(p){if(this.props.publishFn)this.props.publishFn(g.UIEventType.OPEN_SCREEN_IN_NEW);},_renderStandalone:function(p){return (j.createElement("div",{className:this._baseClasses()},j.createElement("div",{className:this._wrapperClass()},j.createElement("video",{className:"_4bad",autoPlay:'true',muted:false,onContextMenu:function(q){q.preventDefault();},src:decodeURIComponent(p)}))));}});e.exports=o;},null);
__d("XScreenSharingController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/screen_sharing\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true}});},null);
__d("FBRTCScreenSharingUI",["FBRTCDispatcher","FBRTCScreenSharingUtils","FBRTCScreenSharingView.react","React","XScreenSharingController"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=null,m=false,n={open:function(o){var p=this._windowPosition(),q=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',p.height,p.width,p.top,p.left].join(','),r=this._getUnsignedUri(o);l=window.open(r,'Screen Sharing',q);if(l){g.dispatch({type:h.ActionTypes.OPEN_IN_NEW});if(window.focus)l.focus();this._renderView(o,5);}},close:function(){if(l){var o=null;if(l.opener&&!l.opener.closed)o=l.opener;l.close();l=null;if(o)o.postMessage({recipient:'SC_CONTENT_SCRIPT',type:'SC_RESET_PORT',text:'reset comm port'},'*');}},isOpen:function(){return l!==null;},_onUnload:function(o){n.close();g.dispatch({type:h.ActionTypes.WINDOW_CLOSED});},_renderView:function(o,p){setTimeout(function(){setTimeout(function(){if(l!==null){var q='FBRTCScreenSharingView/container',r=l.document.getElementById(q);if(r){j.render(j.createElement(i,{isStandalone:true,screenStream:o.getRemoteScreenStream()}),r);m=true;l.onunload=this._onUnload;}}}.bind(this),1);if(p>1&&!m)this._renderView(o,p-1);}.bind(this),500);},_windowPosition:function(){var o=screen.availLeft,p=screen.availTop,q=Math.min(960,screen.width-o),r=Math.min(540,screen.height-p);return {height:'height='+r.toString(),width:'width='+q.toString(),top:'top='+p.toString(),left:'left='+o.toString()};},_getUnsignedUri:function(o){return k.getURIBuilder().setInt('peer_id',o.peerID).setInt('call_id',o.callID).getURI();}};e.exports=n;},null);
__d("FBRTCStarRatingActions",["FBRTCDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({SUBMIT_RATING:null,SUBMIT_FEEDBACK:null,RATING_SHOWN:null,FEEDBACK_SHOWN:null}),j={Types:i,submitRating:function(k){g.dispatch({type:i.SUBMIT_RATING,rating:k});},submitFeedback:function(k){g.dispatch({type:i.SUBMIT_FEEDBACK,feedback:k});},ratingShown:function(){g.dispatch({type:i.RATING_SHOWN});},feedbackShown:function(){g.dispatch({type:i.FEEDBACK_SHOWN});}};e.exports=j;},null);
__d("FBRTCStarRatingStore",["FBRTCLogger","FBRTCStore","FBRTCStarRatingActions"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';for(var j in h)if(h.hasOwnProperty(j))l[j]=h[j];var k=h===null?null:h.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n){h.call(this);this.$FBRTCStarRatingStore0=m;this.$FBRTCStarRatingStore1=n;}l.prototype.setCallSummary=function(m){this.$FBRTCStarRatingStore0=m;};l.prototype.__onDispatch=function(m){switch(m.type){case i.Types.SUBMIT_RATING:this.$FBRTCStarRatingStore2(m.rating);break;case i.Types.SUBMIT_FEEDBACK:this.$FBRTCStarRatingStore3(m.feedback);break;case i.Types.RATING_SHOWN:this.$FBRTCStarRatingStore4();break;}};l.prototype.$FBRTCStarRatingStore2=function(m){this.$FBRTCStarRatingStore0.addExtraInfo(g.Key.RATING,m);this.$FBRTCStarRatingStore0.save(this.$FBRTCStarRatingStore1);};l.prototype.$FBRTCStarRatingStore3=function(m){this.$FBRTCStarRatingStore0.addExtraInfo(g.Key.SURVEY_DETAILS,m);this.$FBRTCStarRatingStore0.save(this.$FBRTCStarRatingStore1);};l.prototype.$FBRTCStarRatingStore4=function(){this.$FBRTCStarRatingStore0.addExtraInfo(g.Key.RATING_SHOWN,'1');this.$FBRTCStarRatingStore0.save(this.$FBRTCStarRatingStore1);};e.exports=l;},null);
__d("FBRTCViewController",["FBRTCCallModel","FBRTCConstants","FBRTCLogger","FBRTCRingback","FBRTCScreenSharingUI","FBRTCStarRatingStore"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=500;function n(o,p,q){"use strict";this.$FBRTCViewController0=o;this.$FBRTCViewController1=new l(p,q);this.$FBRTCViewController2=false;this.$FBRTCViewController3=i.getInstance();}n.prototype.init=function(){"use strict";j.monitorCallModel(this.$FBRTCViewController0);this.$FBRTCViewController0.fetchPeerInfo();};n.prototype.onLocalStreamReady=function(o){"use strict";this.$FBRTCViewController0.setLocalStream(o);if(this.$FBRTCViewController0.uiState>g.UIState.MORE_INIT){this.$FBRTCViewController3.logInfo(this.$FBRTCViewController0.peerID,this.$FBRTCViewController0.callID,'UI: Already @ MORE_INIT, no update');}else if(this.$FBRTCViewController0.canStartCall()&&!this.$FBRTCViewController0.isCaller){this.$FBRTCViewController0.setState(g.UIState.CALL_CONNECTING);}else this.$FBRTCViewController0.setState(g.UIState.MORE_INIT);};n.prototype.waitForUserInput=function(){"use strict";this.$FBRTCViewController0.setStateFrom(g.UIState.INIT,g.UIState.AWAITING_USER_START);};n.prototype.userMediaRequested=function(){"use strict";setTimeout(function(){this.$FBRTCViewController0.setStateFrom(g.UIState.INIT,g.UIState.PENDING_LOCAL_MEDIA);}.bind(this),m);};n.prototype.userMediaGranted=function(){"use strict";this.$FBRTCViewController0.setState(g.UIState.MORE_INIT);};n.prototype.userMediaDenied=function(){"use strict";this.$FBRTCViewController0.setState(g.UIState.USER_MEDIA_DENIED);};n.prototype.onTurnCredentialsReady=function(o){"use strict";if(!this.$FBRTCViewController0.isCaller)this.$FBRTCViewController0.setStateFrom(g.UIState.MORE_INIT,g.UIState.CALL_CONNECTING);};n.prototype.onMessageTypeSent=function(o){"use strict";if(o!==h.PayloadType.OFFER&&o!==h.PayloadType.PCRESTART_OFFER)return;if(o===h.PayloadType.PCRESTART_OFFER)this.$FBRTCViewController2=true;if(o===h.PayloadType.OFFER)this.$FBRTCViewController0.setState(g.UIState.CONTACTING);};n.prototype.onMessageTypeReceived=function(o){"use strict";if(this.$FBRTCViewController2){if(o===h.PayloadType.ANSWER)this.$FBRTCViewController0.setStateFrom(g.UIState.CONTACTING,g.UIState.CALL_CONNECTING);}else if(o===h.PayloadType.OFFER_ACK){this.$FBRTCViewController0.setStateFrom(g.UIState.CONTACTING,g.UIState.RINGING);}else if(o===h.PayloadType.ANSWER)if(this.$FBRTCViewController0.uiState===g.UIState.CONTACTING||this.$FBRTCViewController0.uiState===g.UIState.RINGING)this.$FBRTCViewController0.setState(g.UIState.CALL_CONNECTING);};n.prototype.onRemoteStreamAdded=function(event){"use strict";this.$FBRTCViewController0.setRemoteStream(event.stream);};n.prototype.end=function(o,p){"use strict";this.$FBRTCViewController0.endCallReason=o;this.$FBRTCViewController0.isRemoteEnded=p;this.$FBRTCViewController0.setState(g.UIState.CALL_ENDED);};n.prototype.reset=function(o,p){"use strict";this.$FBRTCViewController0.resetForReconnect(o);this.$FBRTCViewController1.setCallSummary(p);this.$FBRTCViewController0.setState(g.UIState.CALL_CONNECTING);};n.prototype.publish=function(o,p){"use strict";switch(o){case h.UIEventType.TOGGLE_SELF_VIEW:this.$FBRTCViewController4(p);break;case h.UIEventType.START_CALL:if(this.onStartCall)this.onStartCall(i.Trigger.POPUP_CALL_START_BUTTON);break;case h.UIEventType.OPEN_SCREEN_IN_NEW:this.$FBRTCViewController5();break;default:break;}};n.prototype.$FBRTCViewController4=function(o){"use strict";this.$FBRTCViewController0.toggleSelfView();};n.prototype.$FBRTCViewController5=function(){"use strict";k.open(this.$FBRTCViewController0);};n.prototype.$FBRTCViewController6=function(o,p){"use strict";this.$FBRTCViewController3.logCallAction(this.$FBRTCViewController0.peerID,this.$FBRTCViewController0.callID,o,p?'true':'false');};e.exports=n;},null);
__d("FBRTCCallModelStatePusher",["FBRTCCallModel","FBRTCConstants","FBRTCDispatcher","FBRTCStarRatingActions"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=30000,l=10000;function m(n){"use strict";this.$FBRTCCallModelStatePusher0=null;this.$FBRTCCallModelStatePusher1=n;this.$FBRTCCallModelStatePusher1.addListener(this.$FBRTCCallModelStatePusher2.bind(this));i.register(this.$FBRTCCallModelStatePusher3.bind(this));}m.prototype.$FBRTCCallModelStatePusher4=function(){"use strict";return this.$FBRTCCallModelStatePusher1.uiState===g.UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher1.wasConnected&&this.$FBRTCCallModelStatePusher1.endCallReason===h.CallEndReason.HANGUP_CALL;};m.prototype.$FBRTCCallModelStatePusher2=function(){"use strict";if(this.$FBRTCCallModelStatePusher1.uiState===g.UIState.CALL_ENDED){if(this.$FBRTCCallModelStatePusher4()){this.$FBRTCCallModelStatePusher5(3000,g.UIState.CALL_ENDED,g.UIState.COLLECT_RATING);}else this.$FBRTCCallModelStatePusher6(l);}else if(this.$FBRTCCallModelStatePusher1.uiState===g.UIState.COLLECT_RATING)this.$FBRTCCallModelStatePusher6(k);};m.prototype.$FBRTCCallModelStatePusher3=function(n){"use strict";if(n.type===j.Types.FEEDBACK_SHOWN)this.$FBRTCCallModelStatePusher7();};m.prototype.$FBRTCCallModelStatePusher6=function(n){"use strict";this.$FBRTCCallModelStatePusher0=setTimeout(function(){window.close();},n);};m.prototype.$FBRTCCallModelStatePusher7=function(){"use strict";clearTimeout(this.$FBRTCCallModelStatePusher0);this.$FBRTCCallModelStatePusher0=null;};m.prototype.$FBRTCCallModelStatePusher5=function(n,o,p){"use strict";var q=this.$FBRTCCallModelStatePusher1;setTimeout(function(){q.setStateFrom(o,p);},n);};e.exports=m;},null);
__d("FBRTCDialog.react",["MessengerDialog.react","XUIDialog.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();e.exports=i.isMessengerDotCom()?g:h;},null);
__d("FBRTCDialogBody.react",["MessengerDialogBody.react","XUIDialogBody.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();e.exports=i.isMessengerDotCom()?g:h;},null);
__d("FBRTCDialogFooter.react",["MessengerDialogFooter.react","XUIDialogFooter.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();e.exports=i.isMessengerDotCom()?g:h;},null);
__d("FBRTCDialogTitle.react",["FBRTCConfig","MessengerDialogTitle.react","MessengerDialogHeader.react","ReactComponentWithPureRenderMixin","React","XUIDialogTitle.react"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=k,n=m.PropTypes,o=k.createClass({displayName:"FBRTCDialogTitle",mixins:[j],propTypes:{showCloseButton:n.bool.isRequired},render:function(){var p=this.props,q=p.className,r=p.showCloseButton,s=(function(t,u){var v={},w=Object.prototype.hasOwnProperty;if(t==null)throw new TypeError();for(var x in t)if(w.call(t,x)&&!w.call(u,x))v[x]=t[x];return v;})(p,{className:1,showCloseButton:1});if(g.isMessengerDotCom())return (k.createElement(i,null,k.createElement(h,k.__spread({className:q,showCloseButton:r},s),this.props.children)));return (k.createElement(l,k.__spread({className:q,showCloseButton:r},s),this.props.children));}});e.exports=o;},null);
__d("FBRTCAudioSpectrumAnalyser.react",["React","cancelAnimationFrame","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=7,k=3,l=9,m='#3B5998',n='#CCCCCC',o=function(r,s,t,u){var v=u?n:m;s+=k;t-=k;r.beginPath();r.arc(s,t,k,0,2*Math.PI,false);r.fillStyle=v;r.strokeStyle=v;r.fill();},p=function(r,s,t){var u,v,w=s.width/l,x=Math.floor(s.height/j),y=new Uint8Array(2048);r.getByteFrequencyData(y);t.clearRect(0,0,s.width,s.height);var z=Math.floor(y.length/(l*3));for(var aa=0;aa<l;aa+=1){u=0;for(var ba=0;ba<z;ba+=1)u+=y[(aa*z)+ba];v=(u*j)/(z*256);if(v<1)v=.6;for(var ca=0;ca<Math.floor(v);ca++)o(t,aa*w,s.height-ca*x);if(v-Math.floor(v)>=.5)o(t,aa*w,s.height-ca*x,true);}},q=g.createClass({displayName:"FBRTCAudioSpectrumAnalyser",_isAnimating:false,_animationLoop:null,componentDidMount:function(){this._startAnimation();},componentWillUnmount:function(){this._stopAnimation();},shouldComponentUpdate:function(r,s){return this._streamDidChange();},componentDidUpdate:function(r,s){this._stopAnimation();this._startAnimation();},_streamDidChange:function(){var r=this.props.stream?this.props.stream.getStream():null;return r!==this._currentStream;},_stopAnimation:function(){this._isAnimating=false;h(this._animationLoop);},_startAnimation:function(){var r=this.props.stream.getAudioAnalyser();if(!this._isAnimating&&r){this._isAnimating=true;var s=g.findDOMNode(this),t=s.getContext('2d');this._animate(r,s,t);}},render:function(){return g.createElement("canvas",{width:"106",height:"80"});},_animate:function(r,s,t){this._animationLoop=i(function(){if(!this._isAnimating)return;p(r,s,t);this._animate(r,s,t);}.bind(this));}});e.exports=q;},null);
__d("FBRTCUserSettings",["mixInEventEmitter","FBRTCConfig","FBRTCUserMediaRequest","FBRTCStreamWrapper"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=window.MediaStreamTrack,l=null,m={stream:new j(),audioSources:[],videoSources:[],selectedCamera:null,savedCamera:null,selectedMic:null,savedMic:null,isLoading:false,_cameraLabel:null,_micLabel:null,isEnabled:function(){return h.settingsEnabled()&&k&&!!k.getSources;},isDirty:function(){return this.savedCamera!==this.selectedCamera||this.savedMic!==this.selectedMic;},refresh:function(){if(k&&k.getSources){k.getSources(function(n){for(var o=0;o<n.length;o++){var p=n[o];if(p.kind==='audio')this.audioSources.push(p);if(p.kind==='video')this.videoSources.push(p);}this._refreshSelectedOptions();this._getUserMedia();this.isLoading=false;this._scheduleChangeEvent();}.bind(this));this.isLoading=true;this.audioSources=[];this.videoSources=[];}this._scheduleChangeEvent();},cleanUp:function(){this.selectedMic=this.savedMic;this.selectedCamera=this.savedCamera;this.stream.stopStream();},_refreshSelectedOptions:function(){if(this.selectedMic===null)if(this.savedMic){this.selectedMic=this.savedMic;}else if(this.audioSources.length>0){for(var n=0;n<this.audioSources.length;n++)if(this._micLabel&&this._micLabel===this.audioSources[n].label){this.selectedMic=this.audioSources[n].id;break;}if(!this.selectedMic)this.selectedMic=this.audioSources[0].id;this.savedMic=this.selectedMic;}if(this.selectedCamera===null)if(this.savedCamera){this.selectedCamera=this.savedCamera;}else if(this.videoSources.length>0){for(var o=0;o<this.videoSources.length;o++)if(this._cameraLabel&&this._cameraLabel===this.videoSources[o].label){this.selectedCamera=this.videoSources[o].id;break;}if(!this.selectedCamera)this.selectedCamera=this.videoSources[0].id;this.savedCamera=this.selectedCamera;}},save:function(){this.savedMic=this.selectedMic;this.savedCamera=this.selectedCamera;this.emit('saved');this.cleanUp();},selectCameraOption:function(n){this.selectedCamera=n;this._scheduleChangeEvent();this._getUserMedia();},selectMicOption:function(n){this.selectedMic=n;this._scheduleChangeEvent();this._getUserMedia();},updateForLocalStream:function(n){if(n.videoMediaSourceId){this.savedCamera=n.videoMediaSourceId;}else{var o=n.getVideoTracks()[0];if(o)this._cameraLabel=o.label;}if(n.audioMediaSourceId){this.savedMic=n.audioMediaSourceId;}else{var p=n.getAudioTracks()[0];if(p)this._micLabel=p.label;}},_scheduleChangeEvent:function(){if(l!==null)clearTimeout(l);l=setTimeout(function(){this.emit('changed');l=null;}.bind(this),50);},_getUserMedia:function(){var n=new i();n.videoSource=this.selectedCamera;n.audioSource=this.selectedMic;n.addListener('success',this._gumSuccess,this);n.addListener('failed',this._gumFailed,this);n.request();},_gumSuccess:function(n){this.stream.setStream(n);this._scheduleChangeEvent();},_gumFailed:function(n){}};g(m,{changed:true,saved:true});e.exports=m;},null);
__d("FBRTCSettingsDialog.react",["React","cx","fbt","Link.react","FBRTCDialog.react","FBRTCDialogBody.react","FBRTCDialogFooter.react","FBRTCDialogTitle.react","XUIDialogSaveButton.react","XUIDialogCancelButton.react","XUIGrayText.react","XUISelector.react","FBRTCAudioSpectrumAnalyser.react","FBRTCConfig","FBRTCUserSettings","FBRTCVideo.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=r.Option,x=function(z){var aa=[],ba=0;for(var ca=0;ca<z.length;ca++){var da=z[ca],ea=da.label;if(!ea){var fa=(da.kind==='audio'?'Microphone':'Camera');ea=(i._({"Camera":"Camera{number}","Microphone":"Microphone{number}"},[i['enum'](fa,{Camera:"Camera",Microphone:"Microphone"}),i.param("number",++ba)]));}aa.push(g.createElement(w,{value:da.id,key:da.id},ea));}return aa;},y=g.createClass({displayName:"FBRTCSettingsDialog",componentDidMount:function(){this._renderSubscription=u.addListener('changed',function(){this.forceUpdate();}.bind(this));u.refresh();},componentWillUnmount:function(){this._renderSubscription.remove();u.cleanUp();},render:function(){return (g.createElement(k,{width:365,shown:true,onToggle:this.props.onToggle},g.createElement(n,{showCloseButton:true},g.createElement("span",null,i._("Settings"))),g.createElement(l,null,this._dialogBody()),g.createElement(m,{leftContent:this._helpLink()},g.createElement(p,null),g.createElement(o,{use:"confirm",disabled:!u.isDirty(),onClick:this._onConfirmClicked}))));},_dialogBody:function(){if(u.isLoading)return g.createElement("div",{className:"_48fc"});return (g.createElement("div",{className:"_48fc"},this._cameraOptions(),this._microphoneOptions()));},_cameraOptions:function(){if(u.videoSources.length<1)return null;return (g.createElement("div",{className:"_48fd"},g.createElement(q,{display:"block",size:"medium",shade:"medium",className:"_48fe"},i._("Camera")),g.createElement(r,{name:"camera_selection",onChange:this._onCamSelectionChanged,defaultValue:u.selectedCamera,width:"200px"},x(u.videoSources)),g.createElement("div",{className:"_48ff"},g.createElement(v,{stream:u.stream,muted:true,className:"_48fg"}))));},_microphoneOptions:function(){if(u.audioSources.length<1)return null;return (g.createElement("div",{className:"_48fd"},g.createElement(q,{display:"block",size:"medium",shade:"medium",className:"_48fe"},i._("Microphone")),g.createElement(r,{name:"microphone_selection",onChange:this._onMicSelectionChanged,defaultValue:u.selectedMic,width:"200px"},x(u.audioSources)),g.createElement("div",{className:"_48fh"},g.createElement(s,{stream:u.stream}))));},_onCamSelectionChanged:function(z){u.selectCameraOption(z.value);},_onMicSelectionChanged:function(z){u.selectMicOption(z.value);},_onConfirmClicked:function(z){u.save();},_helpLink:function(){return (g.createElement("div",null,g.createElement(q,{shade:"light"},i._("Having Trouble? {troubleShootingGuideLink}",[i.param("troubleShootingGuideLink",g.createElement(j,{href:t.userMediaErrorUrl(),target:"_blank"},i._("Get help")))]))));}});e.exports=y;},null);
__d("FBRTCMediaAccessErrorDialog.react",["React","fbt","Link.react","FBRTCDialog.react","FBRTCDialogBody.react","FBRTCDialogFooter.react","FBRTCDialogTitle.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=g.createClass({displayName:"FBRTCMediaAccessErrorDialog",render:function(){return (g.createElement(j,{shown:true,width:440,layerHideOnBlur:false},g.createElement(m,{showCloseButton:false},g.createElement("span",null,h._("Can't Make Call"))),g.createElement(k,null,this._dialogBody()),g.createElement(l,{leftContent:this._footerContent()})));},_dialogBody:function(){return (g.createElement("p",null,h._("Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone.")));},_footerContent:function(){return (g.createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",g.createElement(i,{href:n.userMediaErrorUrl(),target:"_blank"},h._("Troubleshooting Guide")))])));}});e.exports=o;},null);
__d("FBRTCPeerBrowserUnsupportedDialog.react",["React","fbt","Link.react","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=g.createClass({displayName:"FBRTCPeerBrowserUnsupportedDialog",render:function(){return (g.createElement(j,{shown:true,width:440},g.createElement(m,{showCloseButton:false},g.createElement("span",null,h._("Can't Connect Call"))),g.createElement(k,null,this._dialogBody()),g.createElement(l,{leftContent:this._footerContent()})));},_dialogBody:function(){var p=this.props.peerName;return (g.createElement("p",null,h._("{name} isn't using a browser that supports video calling yet.",[h.param("name",p)])));},_footerContent:function(){return (g.createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",g.createElement(i,{href:n.unsupportedBrowserUrl(),target:"_blank"},h._("Troubleshooting Guide")))])));}});e.exports=o;},null);
__d("FBRTCScreenSharingUnsupportedBrowserDialog.react",["React","Image.react","Link.react","Layout.react","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","XUIText.react","FBRTCConfig","FBRTCVersionDetection","cx","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=j.Column,v=g.createClass({displayName:"FBRTCScreenSharingUnsupportedBrowserDialog",render:function(){return (g.createElement(k,{shown:true,width:440,layerHideOnBlur:false},g.createElement(n,{showCloseButton:true},this._title()),g.createElement(l,null,this._dialogBody(),this._installLinks()),g.createElement(m,{leftContent:this._footerContent()})));},_title:function(){var w=null;if(q.isChrome()){w=s._("Update Browser to Share Your Screen");}else w=s._("Switch Browsers to Share Your Screen");return (g.createElement("span",null,w));},_dialogBody:function(){var w=null;if(q.isChrome()){w=s._("Screen sharing doesn't work in the older version of {current browser name} you're using. To share your screen, please update {browser name} .",[s.param("current browser name",this._browserName()),s.param("browser name",this._browserName())]);}else w=s._("Scren sharing doesn't work in {browser name} yet. To share your screen, please open Facebook in Google Chrome.",[s.param("browser name",this._browserName())]);return (g.createElement("p",null,w,g.createElement(i,{href:p.unsupportedBrowserUrl(),target:"_blank"},s._("Learn More"))));},_footerContent:function(){return (g.createElement("span",null,s._("Still need help? See {troubleShootingGuideLink}",[s.param("troubleShootingGuideLink",g.createElement(i,{href:p.userMediaErrorUrl(),target:"_blank"},s._("Troubleshooting Guide")))])));},_browserName:function(){if(q.isFirefox())return 'Mozilla Firefox';if(q.isChrome())return 'Google Chrome';return (s._("' your browser ',"));},_installLinks:function(){return (g.createElement(j,null,g.createElement(u,{style:{width:'100%',textAlign:'center'}},g.createElement(i,{href:"https://www.google.com/chrome/index.html",target:"_blank"},g.createElement(h,{className:"_4_if",src:t('/images/chat/webrtc/chrome.png'),alt:"Chrome",width:"64"}),g.createElement(o,{display:"block"},"Google Chrome")))));}});e.exports=v;},null);
__d("FBRTCScreenSharingInstallExtensionDialog.react",["React","FBRTCScreenSharingLogger","Link.react","List.react","ScreenSharingWebDriverIDs","XUIDialog.react","XUIDialogBody.react","XUIDialogTitle.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=g,q=p.PropTypes,r='https://chrome.google.com/webstore/detail/degmgkchmbgaognjjlhggmhbcpicdifm',s=g.createClass({displayName:"FBRTCScreenSharingInstallExtensionDialog",propTypes:{onToggle:q.func.isRequired,peerID:q.number.isRequired,sessionID:q.number.isRequired},componentDidMount:function(){h.getInstance().logAction(this.props.peerID,this.props.sessionID,h.Action.SCREEN_SHARING_EXT_DIALOG);},render:function(){return (g.createElement(l,{shown:true,width:440,layerHideOnBlur:false},g.createElement(n,{showCloseButton:true},g.createElement("span",null,o._("Install Screen Sharing Extension"))),g.createElement(m,{"data-testid":k.INSTALL_EXT_DIALOG},this._dialogBody())));},_dialogBody:function(){return (g.createElement("p",null,o._("To share your screen, please install an extension:"),g.createElement(j,{border:"none",spacing:"small"},g.createElement("li",null,o._("1. Install the {Link to the Facebook Screen Sharing extension} from Google Chrome Web Store",[o.param("Link to the Facebook Screen Sharing extension",g.createElement(i,{href:r,target:"_blank",onClick:this._onExtLinkClick},o._("Facebook Screen Sharing Extension")))])),g.createElement("li",null,o._("2. Restart your call and share your screen")))));},_onExtLinkClick:function(){h.getInstance().logAction(this.props.peerID,this.props.sessionID,h.Action.SCREEN_SHARING_EXT_LINK);}});e.exports=s;},null);
__d("FBRTCVideoEscalationDialog.react",["FBRTCCallControlActions","React","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogFooter.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=h,o=n.PropTypes,p=h.createClass({displayName:"FBRTCVideoEscalationDialog",propTypes:{peerName:o.string.isRequired,hideDialog:o.func.isRequired},render:function(){var q=this.props,r=q.peerName;return (h.createElement(i,{layerHideOnBlur:false,shown:true,width:440},h.createElement(j,null,h.createElement("p",null,m._("{name} would like to video chat. Click \"Accept\" to enable your camera.",[m.param("name",r)]))),h.createElement(l,null,h.createElement(k,{action:"cancel",label:m._("Decline"),onClick:this._onDeclineClicked}),h.createElement(k,{action:"confirm",label:m._("Accept"),onClick:this._onAcceptClicked,use:"confirm"}))));},_onDeclineClicked:function(q){g.declineEscalation();},_onAcceptClicked:function(q){this.props.hideDialog();g.acceptEscalation();}});e.exports=p;},null);
__d("FBRTCCallDialogController",["FBRTCSettingsDialog.react","FBRTCStruct","FBRTCMediaAccessErrorDialog.react","FBRTCPeerBrowserUnsupportedDialog.react","FBRTCScreenSharingUnsupportedBrowserDialog.react","FBRTCScreenSharingInstallExtensionDialog.react","FBRTCUserSettings","FBRTCVideoEscalationDialog.react","React","ReactLayeredComponentMixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=new h(['ERROR_ACCESSING_MEDIA','PEER_BROWSER_UNSUPPORTED','SETTINGS','SCREEN_SHARING_UNSUPPORTED','INSTALL_SCREEN_SHARING_EXT','VIDEO_ESCALATION']),r=o.createClass({displayName:"DialogOwner",mixins:[p],renderLayers:function(){if(this.props.dialogType===q.ERROR_ACCESSING_MEDIA)return {dialog:o.createElement(i,null)};if(this.props.dialogType===q.PEER_BROWSER_UNSUPPORTED){var t=this.props.callModel.peerName();return {dialog:o.createElement(j,{peerName:t})};}if(this.props.dialogType===q.SETTINGS)return {dialog:o.createElement(g,{onToggle:this._onToggle})};if(this.props.dialogType===q.SCREEN_SHARING_UNSUPPORTED)return {dialog:o.createElement(k,{onToggle:this._onToggle})};if(this.props.dialogType===q.INSTALL_SCREEN_SHARING_EXT)return {dialog:o.createElement(l,{onToggle:this._onToggle,peerID:this.props.callModel.peerID,sessionID:this.props.callModel.callID})};if(this.props.dialogType===q.VIDEO_ESCALATION)return {dialog:o.createElement(n,{hideDialog:function(){s.hideDialog();},onToggle:this._onToggle,peerName:this.props.callModel.peerName()})};return {};},_onToggle:function(t){setTimeout(function(){if(!t)s.hideDialog();},0);},render:function(){return o.createElement("div",null);}}),s={dialogTypes:q,setDialogContainer:function(t){this.container=t;this.currentDialogType=null;this.callModel=null;this._render();},showDialog:function(t,u){this.currentDialogType=t;this._setCallModel(u);this._render();},hideDialog:function(){this.currentDialogType=null;this._render();},hideDialogType:function(t){if(t===this.currentDialogType)this.hideDialog();},_render:function(){o.render(o.createElement(r,{dialogType:this.currentDialogType,callModel:this.callModel}),this.container);},_setCallModel:function(t){if(t!==this.callModel){this.callModel=t;if(this.callModel)this.callModel.addListener(this._onCallModelChanged.bind(this));}},_onCallModelChanged:function(){var t=[q.SETTINGS,q.SCREEN_SHARING_UNSUPPORTED,q.INSTALL_SCREEN_SHARING_EXT,q.VIDEO_ESCALATION];if(this.callModel.isEnded()&&t.indexOf(this.currentDialogType)>-1)this.hideDialog();}};m.addListener('saved',s.hideDialog,s);e.exports=s;},null);
__d("FBRTCRetriableMessage",["mixInEventEmitter","FBRTCConstants"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=10000,j=7000,k=1;function l(m){"use strict";this.$FBRTCRetriableMessage0=m;this.$FBRTCRetriableMessage1=i;this.$FBRTCRetriableMessage2=k;this.$FBRTCRetriableMessage3=null;this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;}l.prototype.sendMessage=function(m,n,o,p,q){"use strict";this.$FBRTCRetriableMessage3=n;switch(m){case h.PayloadType.PCRESTART_OFFER:this.$FBRTCRetriableMessage4=this.$FBRTCRetriableMessage0.sendPCRestartOffer(n,o,p,q);break;case h.PayloadType.OFFER:this.$FBRTCRetriableMessage4=this.$FBRTCRetriableMessage0.sendOffer(n,o,p,q);break;case h.PayloadType.ANSWER:this.$FBRTCRetriableMessage1=j;this.$FBRTCRetriableMessage4=this.$FBRTCRetriableMessage0.sendAnswer(n,o,p,q);break;}this.$FBRTCRetriableMessage6();};l.prototype.isAckMsg=function(m){"use strict";return (this.$FBRTCRetriableMessage4&&this.$FBRTCRetriableMessage4.msg_id===m.ack_id);};l.prototype.stopRetrying=function(){"use strict";if(this.$FBRTCRetriableMessage5){clearTimeout(this.$FBRTCRetriableMessage5);this.$FBRTCRetriableMessage3=null;this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;}};l.prototype.$FBRTCRetriableMessage6=function(){"use strict";this.$FBRTCRetriableMessage5=setTimeout(this.$FBRTCRetriableMessage7.bind(this),this.$FBRTCRetriableMessage1);};l.prototype.$FBRTCRetriableMessage7=function(){"use strict";if(this.$FBRTCRetriableMessage2<1){this.emit('timeoutFailure');}else{this.emit('sendingRetry');this.$FBRTCRetriableMessage0.resendSdpMessage(this.$FBRTCRetriableMessage3,this.$FBRTCRetriableMessage4);this.$FBRTCRetriableMessage6();this.$FBRTCRetriableMessage2-=1;}};g(l,{sendingRetry:true,timeoutFailure:true});e.exports=l;},null);
__d("FBRTCScreenMedia",["FBRTCDispatcher","FBRTCUserMediaRequest","keyMirror"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=i({STREAM_READY:null,STREAM_FAILED:null}),k={STREAM_TYPE:h.STREAM_TYPE.SCREEN_SHARING,Types:j,requestScreenMedia:function(l){var m=new h(this.STREAM_TYPE);m.videoSource=l;m.addListener('success',this._onRequestSuccess,this);m.addListener('failed',this._onRequestFailure,this);m.request();},_onRequestSuccess:function(l){g.dispatch({type:j.STREAM_READY,stream:l});},_onRequestFailure:function(l){var m=(l.name)?l.name:l;g.dispatch({type:j.STREAM_FAILED,error:m});}};e.exports=k;},null);
__d("FBRTCScreenSharingModel",["FBRTCScreenSharingLogger","FBRTCScreenStreamWrapper","FBRTCStore"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';for(var j in i)if(i.hasOwnProperty(j))l[j]=i[j];var k=i===null?null:i.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=i;function l(){i.call(this);this.$FBRTCScreenSharingModel0=null;this.$FBRTCScreenSharingModel1=new h();this.$FBRTCScreenSharingModel2=g.getInstance();}l.prototype.isEnabled=function(){return !!this.$FBRTCScreenSharingModel0;};l.prototype.setStream=function(m,n){if(m&&!n)m.getVideoTracks()[0].onended=function(){this.__emitChange();}.bind(this);if(this.$FBRTCScreenSharingModel1===null)this.$FBRTCScreenSharingModel1=new h();this.$FBRTCScreenSharingModel1.setStream(m,!n);};l.prototype.getStream=function(){return this.$FBRTCScreenSharingModel1;};l.prototype.onStart=function(m){if(!m){this.$FBRTCScreenSharingModel2.logToConsole(null,null,'Invalid stream id');return;}this.$FBRTCScreenSharingModel2.logToConsole(null,null,'Enabling screen sharing');this.$FBRTCScreenSharingModel0=m;};l.prototype.onStop=function(){this.$FBRTCScreenSharingModel0=null;if(this.$FBRTCScreenSharingModel1)this.$FBRTCScreenSharingModel1.stopStream();};l.prototype.__onDispatch=function(m){};e.exports=l;},null);
__d("FBRTCScreenSharingController",["FBRTCCallDialogController","FBRTCScreenSharingLogger","FBRTCScreenMedia","FBRTCScreenSharingModel","FBRTCScreenSharingUI","FBRTCScreenSharingUtils","FBRTCStore"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r){m.call(this);this.$FBRTCScreenSharingController0=false;this.$FBRTCScreenSharingController1=h.getInstance();this.$FBRTCScreenSharingController2=new j();this.$FBRTCScreenSharingController3=q;this.$FBRTCScreenSharingController4=r;if(l.isScreenSharingSupported()){this.$FBRTCScreenSharingController2.addListener(this.$FBRTCScreenSharingController5.bind(this));l.checkExtensionInstalled();}}p.prototype.isEnabled=function(){return this.$FBRTCScreenSharingController0&&this.$FBRTCScreenSharingController2.isEnabled();};p.prototype.getStream=function(){return this.$FBRTCScreenSharingController2.getStream();};p.prototype.onStop=function(){this.$FBRTCScreenSharingController2.onStop();};p.prototype.onEndCall=function(){k.close();};p.prototype.setRemoteStream=function(q){if(!q){k.close();this.$FBRTCScreenSharingController2.setStream(q,true);}else this.$FBRTCScreenSharingController2.setStream(q,true);};p.prototype.toggleScreenSharing=function(q){if(!l.isSupportedBrowser()){g.showDialog(g.dialogTypes.SCREEN_SHARING_UNSUPPORTED,q);}else if(!l.isExtensionInstalled()){g.showDialog(g.dialogTypes.INSTALL_SCREEN_SHARING_EXT,q);}else{var r=(this.$FBRTCScreenSharingController2.isEnabled())?'SC_CANCEL':'SC_REQUEST';window.postMessage({recipient:l.RECIPIENT,type:r,text:'toggle screen sharing'},'*');window.addEventListener('message',this.$FBRTCScreenSharingController6.bind(this));}this.$FBRTCScreenSharingController1.logAction(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,h.Action.SCREEN_SHARING_TOGGLED,'status: '+(this.isEnabled()?'enabled':'disabled'));};p.prototype.$FBRTCScreenSharingController6=function(event){if(event.origin!=window.location.origin){this.$FBRTCScreenSharingController1.logToConsole(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,'Different origin for this event, do nothing');return;}if(!event.data.recipient||event.data.recipient!='SC_DOM'){this.$FBRTCScreenSharingController1.logToConsole(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,'Wrong recipient, do nothing');return;}if(!event.data.type){this.$FBRTCScreenSharingController1.logToConsole(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,'No event type, exiting');return;}window.removeEventListener('message',this.$FBRTCScreenSharingController6.bind(this));switch(event.data.type){case 'SC_DIALOG_SUCCESS':this.$FBRTCScreenSharingController7(event.data.streamId);break;case 'SC_DIALOG_CANCEL':break;case 'SC_CANCELLED':this.$FBRTCScreenSharingController1.logAction(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,h.Action.SCREEN_SHARING_CANCELLED);this.$FBRTCScreenSharingController5();break;default:this.$FBRTCScreenSharingController1.logToConsole(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,'Unexpected event type');}};p.prototype.$FBRTCScreenSharingController7=function(q){if(this.$FBRTCScreenSharingController0){this.$FBRTCScreenSharingController1.logToConsole(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,'Screen sharing already enabled, do nothing');return;}this.$FBRTCScreenSharingController2.onStart(q);if(this.$FBRTCScreenSharingController2.isEnabled())i.requestScreenMedia(q);};p.prototype.$FBRTCScreenSharingController5=function(){if(!this.$FBRTCScreenSharingController0){this.$FBRTCScreenSharingController1.logToConsole(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,'Screen sharing already disabled, do nothing');return;}this.$FBRTCScreenSharingController1.logAction(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,h.Action.SCREEN_SHARING_DISABLED);this.$FBRTCScreenSharingController0=false;this.__emitChange();};p.prototype.__onDispatch=function(q){switch(q.type){case i.Types.STREAM_READY:this.$FBRTCScreenSharingController0=!!q.stream;this.$FBRTCScreenSharingController2.setStream(q.stream,false);this.$FBRTCScreenSharingController1.logAction(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,h.Action.SCREEN_SHARING_ENABLED);this.__emitChange();break;case i.Types.STREAM_FAILED:this.$FBRTCScreenSharingController1.logError(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,"Failed retrieving the screen stream with error: "+q.error);break;default:break;}};e.exports=p;},null);
__d("FBRTCVideoEscalationStore",["FBRTCStore","FBRTCCallControlActions","keyMirror"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=25000,k=i({direct_video:null,escalated:null,escalation_declined:null,voip:null});for(var l in g)if(g.hasOwnProperty(l))n[l]=g[l];var m=g===null?null:g.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=g;function n(o,p,q){g.call(this);this.$FBRTCVideoEscalationStore0=o;this.$FBRTCVideoEscalationStore1=p;this.$FBRTCVideoEscalationStore2=q;this.$FBRTCVideoEscalationStore3=q;this.$FBRTCVideoEscalationStore4=false;this.$FBRTCVideoEscalationStore5=null;this.$FBRTCVideoEscalationStore6=null;}n.prototype.isPending=function(){return !!this.$FBRTCVideoEscalationStore5;};n.prototype.callHasEscalated=function(){return this.$FBRTCVideoEscalationStore2;};n.prototype.getCallType=function(){if(!this.$FBRTCVideoEscalationStore1.isRemoteVideoSupported){return k.voip;}else if(this.$FBRTCVideoEscalationStore3){return k.direct_video;}else if(this.$FBRTCVideoEscalationStore2){return k.escalated;}else if(this.$FBRTCVideoEscalationStore4)return k.escalation_declined;return k.voip;};n.prototype.__onDispatch=function(o){switch(o.type){case h.Types.ON_ESCALATION_REQUEST:this.$FBRTCVideoEscalationStore4=true;if(this.$FBRTCVideoEscalationStore6){this.$FBRTCVideoEscalationStore7(o.message);}else this.$FBRTCVideoEscalationStore8(o.message);break;case h.Types.ACCEPT_ESCALATION:this.$FBRTCVideoEscalationStore9(true);break;case h.Types.DECLINE_ESCALATION:this.$FBRTCVideoEscalationStore9(false);break;case h.Types.TOGGLE_MUTE_VIDEO:this.$FBRTCVideoEscalationStore4=true;this.getDispatcher().waitFor([this.$FBRTCVideoEscalationStore1.getDispatchToken()]);this.$FBRTCVideoEscalationStorea();break;}};n.prototype.$FBRTCVideoEscalationStore7=function(o){clearTimeout(this.$FBRTCVideoEscalationStoreb);var p=o,q=p.msg,r=p.peerID,s=p.callID,t=this.$FBRTCVideoEscalationStorec(q);this.$FBRTCVideoEscalationStore0.sendAck(r,s,q);this.$FBRTCVideoEscalationStore6=null;this.$FBRTCVideoEscalationStore2=t;this.$FBRTCVideoEscalationStored(t);if(!t&&this.$FBRTCVideoEscalationStore1.localStream.hasVideo())this.$FBRTCVideoEscalationStore1.localStream.toggleMuteVideo();this.__emitChange();};n.prototype.$FBRTCVideoEscalationStore8=function(o){if(this.$FBRTCVideoEscalationStore2){if(this.$FBRTCVideoEscalationStorec(o.msg)){this.$FBRTCVideoEscalationStore5=o;this.$FBRTCVideoEscalationStore9(true);}else this.$FBRTCVideoEscalationStore1.remoteStream.setVideoEnabled(false);return;}var p=o,q=p.msg,r=p.peerID,s=p.callID;this.$FBRTCVideoEscalationStore0.sendAck(r,s,q);if(this.$FBRTCVideoEscalationStorec(q)){this.$FBRTCVideoEscalationStore5=o;this.$FBRTCVideoEscalationStoreb=setTimeout(function(){h.declineEscalation();},j);}else this.$FBRTCVideoEscalationStore5=null;this.__emitChange();};n.prototype.$FBRTCVideoEscalationStore9=function(o){clearTimeout(this.$FBRTCVideoEscalationStoreb);if(this.$FBRTCVideoEscalationStore5){var p=this.$FBRTCVideoEscalationStore5,q=p.peerID,r=p.callID,s=p.msgID;this.$FBRTCVideoEscalationStore0.sendVideoRequestResponse(q,r,s,o);this.$FBRTCVideoEscalationStore2=o;this.$FBRTCVideoEscalationStore5=null;this.__emitChange();}};n.prototype.$FBRTCVideoEscalationStorea=function(){if(!this.$FBRTCVideoEscalationStore1.isPeerOnMobile)return;if(this.$FBRTCVideoEscalationStore2)return;this.$FBRTCVideoEscalationStore6=this.$FBRTCVideoEscalationStore0.sendVideoEscalationRequest(this.$FBRTCVideoEscalationStore1.peerID,this.$FBRTCVideoEscalationStore1.callID,this.$FBRTCVideoEscalationStore1.localStream.hasVideo());if(this.$FBRTCVideoEscalationStore1.localStream.hasVideo()){this.$FBRTCVideoEscalationStoreb=setTimeout(function(){if(this.$FBRTCVideoEscalationStore1.localStream.hasVideo())h.toggleMuteVideo();}.bind(this),j);}else{clearTimeout(this.$FBRTCVideoEscalationStoreb);this.$FBRTCVideoEscalationStore6=null;}this.__emitChange();};n.prototype.$FBRTCVideoEscalationStored=function(o){this.$FBRTCVideoEscalationStore1.remoteStream.setVideoEnabled(o);};n.prototype.$FBRTCVideoEscalationStorec=function(o){return !!(o.reqVideoOn||o.videoon);};e.exports=n;},null);
__d("FBRTCWindowManager",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={height:0,width:0,top:0,left:0},h={height:452,width:534,bottomRightOffset:50},i={init:function(j,k){this._window=j;this._callModel=k;k.addListener(this._setProgressIndicator.bind(this));this._setProgressIndicator();this._monitorOpenerForChanges();this._storePosition();},updatePosition:function(j){if(!this._window)return;if(j&&g.height>0&&g.width>0){this._window.moveTo(g.left,g.top);this._window.resizeTo(g.width,g.height);return;}this._storePosition();this._window.resizeTo(h.width,h.height);var k=screen.width-h.width-h.bottomRightOffset,l=screen.height-h.height-h.bottomRightOffset;this._window.moveTo(k,l);},_setProgressIndicator:function(){if(this._callModel.isEnded()){this._window.rtcCallInProgessWith=null;}else this._window.rtcCallInProgessWith=this._callModel.peerID.toString();},_monitorOpenerForChanges:function(){if(this._window.opener)try{this._window.opener.addEventListener("unload",function(event){this._passWindowToOpener(10);}.bind(this));}catch(j){}},_passWindowToOpener:function(j){setTimeout(function(){setTimeout(function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window;}.bind(this),1);if(j>1)this._passWindowToOpener(j-1);}.bind(this),1000);},_storePosition:function(){if(this._window){if(this._window.innerWidth!==(void 0)){g.height=this._window.outerHeight;g.width=this._window.outerWidth;}else{g.height=this._window.screen.height;g.width=this._window.screen.width;}if(this._window.screenLeft!==(void 0)){g.left=this._window.screenLeft;g.top=this._window.screenTop;}else{g.left=this._window.screenX;g.top=this._window.screenY;}}}};e.exports=i;},null);
__d("FBRTCCallController",["ErrorUtils","Run","FBRTCCallConnection","FBRTCCallConnectionMonitor","FBRTCCallControlActions","FBRTCCallModel","FBRTCCallMonitor","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConstants","FBRTCDispatcher","FBRTCExperiments","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageListener","FBRTCMessageSender","FBRTCPCConfig","FBRTCTurnDiscovery","FBRTCUserMedia","FBRTCViewController","FBRTCCallModelStatePusher","FBRTCCallDialogController","FBRTCRetriableMessage","FBRTCUserMediaRequest","FBRTCUserSettings","FBRTCScreenSharingController","FBRTCScreenSharingUtils","FBRTCSdpUtils","FBRTCStreamWrapper","FBRTCUrlManager","FBRTCVideoEscalationStore","FBRTCWindowManager","fbt","randomInt","AvailableList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra){b.__markCompiled&&b.__markCompiled();b('AvailableList');var sa=60000;function ta(){return ra(0,4294967295);}function ua(va,wa,xa,ya){"use strict";this.$FBRTCCallController0=v.getInstance();this.$FBRTCCallController1=new u();this.$FBRTCCallController2=o.getInstance();this.$FBRTCCallController3=null;this.$FBRTCCallController4=false;if(!xa){var za=this.$FBRTCCallController1.getOffer(va);if(za){za=w.createFromOffer(za,va);this.$FBRTCCallController3=za.msg;x.check(va,this.$FBRTCCallController3.call_id,this.$FBRTCCallController3.msg_id);}else xa=true;}if(!wa)wa=this.$FBRTCCallController3?this.$FBRTCCallController3.call_id:ta();this.$FBRTCCallController0.logCallAction(va,wa,v.CallAction.POPUP_OPENED);this.$FBRTCCallController5=new l({peerID:va,callID:wa,isCaller:xa});if(za)this.$FBRTCCallController5.onSDPMessageFromPeer(za);this.$FBRTCCallController5.localStream.setVideoEnabled(!ya);this.$FBRTCCallController6=new ea(this.$FBRTCCallController5);this.$FBRTCCallController7=n.restoreOrInitialize(this.$FBRTCCallController2,va,wa,xa,this.$FBRTCCallController3);this.$FBRTCCallController7.onPopupOpened();na.init(this.$FBRTCCallController5.peerID);pa.init(window,this.$FBRTCCallController5);this.$FBRTCCallController8=new ja(va,wa);if(ka.isScreenSharingSupported())this.$FBRTCCallController8.addListener(this.$FBRTCCallController9.bind(this));this.$FBRTCCallControllera=new da(this.$FBRTCCallController5,this.$FBRTCCallController7,this.$FBRTCCallController2);this.$FBRTCCallControllera.onStartCall=this.$FBRTCCallControllerb.bind(this);this.$FBRTCCallControllera.init();this.$FBRTCCallControllerc=new i();this.$FBRTCCallControllerc.addListener('remoteStreamAdded',this.$FBRTCCallControllerd,this);this.$FBRTCCallControllerc.addListener('remoteStreamRemoved',this.$FBRTCCallControllere,this);this.$FBRTCCallControllerc.addListener('sdpCreated',this.$FBRTCCallControllerf,this);this.$FBRTCCallControllerc.addListener('localIceCandidateCreated',this.$FBRTCCallControllerg,this);this.$FBRTCCallControllerc.addListener('remoteDescriptionSet',this.$FBRTCCallControllerh,this);this.$FBRTCCallControllerc.addListener('connected',this.$FBRTCCallControlleri,this);this.$FBRTCCallControllerc.addListener('disconnected',this.$FBRTCCallControllerj,this);this.$FBRTCCallControllerc.addListener('connectionUnstable',this.$FBRTCCallControllerk,this);this.$FBRTCCallControllerc.addListener('connectionError',this.$FBRTCCallControllerl,this);this.$FBRTCCallControllerm=false;this.$FBRTCCallControllern=false;this.$FBRTCCallControllero=new j(this.$FBRTCCallControllerc,this.$FBRTCCallController7);this.$FBRTCCallControllero.addListener('connectionPoor',this.$FBRTCCallControllerp,this);this.$FBRTCCallControllerq=new z();this.$FBRTCCallControllerq.onMessageSent=this.$FBRTCCallControllerr.bind(this);this.$FBRTCCallControllerq.onSendFailure=this.$FBRTCCallControllers.bind(this);this.$FBRTCCallControllert=null;this.$FBRTCCallControlleru=null;this.$FBRTCCallControllerv=new oa(this.$FBRTCCallControllerq,this.$FBRTCCallController5,!ya);this.$FBRTCCallController7.setCallType(this.$FBRTCCallControllerv.getCallType());this.$FBRTCCallControllerv.addListener(this.$FBRTCCallControllerw.bind(this));this.$FBRTCCallControllerx=new t();this.$FBRTCCallControllery=false;h.onBeforeUnload(this.$FBRTCCallControllerz.bind(this),false);h.onUnload(this.$FBRTCCallControllerA.bind(this));g.addListener(this.$FBRTCCallControllerB.bind(this),true);y.init();y.setMessageHandler(this.$FBRTCCallControllerC,this);var ab=this;this.$FBRTCCallControllerD=new m(this.$FBRTCCallController5);this.$FBRTCCallControllerD.startHeartbeat(function(){return ab.$FBRTCCallController7;});this.$FBRTCCallControllerE=null;ia.addListener('saved',this.$FBRTCCallControllerF,this);ba.addListener('receivedTurnCreds',this.$FBRTCCallControllerG,this);ba.addListener('failed',this.$FBRTCCallControllerH,this);ba.requestTurnCreds(this.$FBRTCCallController5);r.register(this.__onDispatch.bind(this));}ua.prototype.__onDispatch=function(va){"use strict";switch(va.type){case k.Types.HANG_UP:this.$FBRTCCallControllerI(q.CallEndReason.HANGUP_CALL,false,true,false);break;case k.Types.TOGGLE_SCREEN_SHARING:if(this.$FBRTCCallController8)this.$FBRTCCallController8.toggleScreenSharing(this.$FBRTCCallController5);break;case k.Types.SHOW_SETTINGS:fa.showDialog(fa.dialogTypes.SETTINGS,this.$FBRTCCallController5);break;case k.Types.ACCEPT_ESCALATION:this.$FBRTCCallController5.localStream.setVideoEnabled(true);this.$FBRTCCallControllerJ(true);break;}};ua.prototype.getCallModel=function(){"use strict";return this.$FBRTCCallController5;};ua.prototype.getViewController=function(){"use strict";return this.$FBRTCCallControllera;};ua.prototype.getConnection=function(){"use strict";return this.$FBRTCCallControllerc;};ua.prototype.sendData=function(va,wa){"use strict";this.$FBRTCCallControllerc.sendData({topic:va,data:wa});};ua.prototype.addDataChannelListener=function(va,wa){"use strict";return this.$FBRTCCallControllerc.addListener('data_message',va,wa);};ua.prototype.$FBRTCCallControllerb=function(va){"use strict";this.$FBRTCCallController7.onCallStarted(va);this.startCallProcess();};ua.prototype.startCallProcess=function(){"use strict";this.$FBRTCCallControllerK();this.$FBRTCCallControllera.userMediaRequested();};ua.prototype.waitForUserInput=function(){"use strict";this.$FBRTCCallControllera.waitForUserInput();};ua.prototype.$FBRTCCallControllerK=function(){"use strict";ca.once('streamReady',this.$FBRTCCallControllerL,this);ca.addListener('accessDenied',this.$FBRTCCallControllerM,this);ca.addListener('accessFailed',this.$FBRTCCallControllerN,this);ca.addListener('accessGranted',this.$FBRTCCallControllerO,this);this.$FBRTCCallController5.localStream.addListener('streamStarted',function(){var va=this.$FBRTCCallController5.localStream.videoWidth,wa=this.$FBRTCCallController5.localStream.videoHeight;this.$FBRTCCallController7.setVideoCaptureStats(va,wa);var xa=p.shouldUseHdVideo(),ya=this.$FBRTCCallController5.isRemoteVideoSupported;if((xa&&ya&&wa===ha.HD_HEIGHT)||(!xa&&ya&&wa===ha.SD_HEIGHT))s.logExposure(s.QE.VIDEO_QUALITY);}.bind(this));this.$FBRTCCallControllerP();};ua.prototype.$FBRTCCallControllerP=function(){"use strict";var va;if(!this.$FBRTCCallController5.isRemoteVideoSupported){va=ca.STREAM_TYPE.NO_VIDEO;}else if(this.$FBRTCCallController5.isPeerOnMobile){va=ca.STREAM_TYPE.LQ_VIDEO;}else if(p.shouldUseHdVideo()){va=ca.STREAM_TYPE.HD_VIDEO;}else va=ca.STREAM_TYPE.SD_VIDEO;ca.requestUserMedia(va,ia.savedMic,ia.savedCamera);};ua.prototype.$FBRTCCallControllerF=function(){"use strict";this.$FBRTCCallController0.logCallAction(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,v.CallAction.USER_SETTINGS_CHANGED);ca.once('streamReady',function(va){ia.updateForLocalStream(va);this.$FBRTCCallController5.setLocalStream(va);this.$FBRTCCallControllerQ();}.bind(this));this.$FBRTCCallControllerP();};ua.prototype.$FBRTCCallController9=function(){"use strict";var va=this.$FBRTCCallController8.isEnabled(),wa=this.$FBRTCCallController8.getStream();if(va){this.$FBRTCCallControllerc.addScreenStream(wa);}else{this.$FBRTCCallControllerc.removeScreenStream(wa);this.$FBRTCCallController8.onStop();}this.$FBRTCCallControllerQ();this.$FBRTCCallController5.selfViewOpen=!va;pa.updatePosition(!va);this.$FBRTCCallController5.setScreenSharingStatus(va);};ua.prototype.$FBRTCCallControllerd=function(event){"use strict";if(ma.isScreenStream(event.stream)){this.$FBRTCCallController8.setRemoteStream(event.stream);this.$FBRTCCallController5.setRemoteScreenStream(this.$FBRTCCallController8.getStream());}else this.$FBRTCCallControllera.onRemoteStreamAdded(event);};ua.prototype.$FBRTCCallControllere=function(event){"use strict";if(ma.isScreenStream(event.stream)){this.$FBRTCCallController5.setRemoteScreenStream(null);this.$FBRTCCallController8.setRemoteStream(null);}};ua.prototype.$FBRTCCallControllerk=function(){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Network unstable');};ua.prototype.$FBRTCCallControllerp=function(){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Network poor');s.logExposure(s.QE.AUTO_DISABLE);if(p.shouldAutoDisableVideo())this.$FBRTCCallController5.autoDisableVideo();};ua.prototype.$FBRTCCallControllerB=function(va){"use strict";var wa=va.message+'; '+va.stackFrames[0].identifier;this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'JSError: '+wa);};ua.prototype.$FBRTCCallControllerz=function(){"use strict";if(this.$FBRTCCallController5.isInProgress())return qa._("Leaving this page will end your call.");};ua.prototype.$FBRTCCallControllerA=function(){"use strict";if(this.$FBRTCCallController5.isEnded())return;var va=this.$FBRTCCallController5.isUserMediaPending(),wa=this.$FBRTCCallController5.isUserMediaDenied(),xa=q.CallEndReason.HANGUP_CALL,ya='BrowserClosed';if(va||wa){xa=q.CallEndReason.CLIENT_ERROR;ya=va?'MediaPending':'MediaDenied';}else if(this.$FBRTCCallController5.isAwaitingUserStart())ya='AwaitingUserStart';this.$FBRTCCallControllerI(xa,false,true,true,ya);};ua.prototype.$FBRTCCallControllerG=function(va){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Received Turn Creds');aa.setTurnCredentials(va);this.$FBRTCCallControllera.onTurnCredentialsReady(va);this.$FBRTCCallControllerR();};ua.prototype.$FBRTCCallControllerH=function(){"use strict";this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Failed to get turn creds');this.$FBRTCCallControllerI(q.CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController5.isCaller,false,'NoTurnCreds');};ua.prototype.$FBRTCCallControllerR=function(){"use strict";if(this.$FBRTCCallController5.canStartCall()){na.onCallStarted();this.$FBRTCCallControllerc.init(this.$FBRTCCallController5.localStream);if(!this.$FBRTCCallController3){this.$FBRTCCallControllerc.createOffer();}else{if(this.$FBRTCCallController3.hasOwnProperty('videoon'))this.$FBRTCCallControllerJ(this.$FBRTCCallController3.videoon);if(this.$FBRTCCallController3.hasOwnProperty('experiments'))this.$FBRTCCallController5.setSignalingExperiments(this.$FBRTCCallController3.experiments);this.$FBRTCCallControllerS(this.$FBRTCCallController3.sdp,true);this.$FBRTCCallController1.removeOffer(this.$FBRTCCallController5.peerID);this.$FBRTCCallController3=null;}this.$FBRTCCallController1.enableDequeuing(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,this.$FBRTCCallControllerC.bind(this));}};ua.prototype.$FBRTCCallControllerQ=function(){"use strict";if(this.$FBRTCCallController5.isAwaitingAnswer()){this.$FBRTCCallControllerm=true;}else{this.$FBRTCCallControllerm=false;this.$FBRTCCallControllern=false;if(this.$FBRTCCallController5.supportsSdpUpdate()){this.$FBRTCCallControllerc.createSdpUpdate();}else{this.$FBRTCCallController4=true;this.$FBRTCCallControllerx.reset(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID);this.$FBRTCCallControllery=false;this.$FBRTCCallControllerc.createOffer();}}};ua.prototype.$FBRTCCallControllerL=function(va){"use strict";ia.updateForLocalStream(va);this.$FBRTCCallControllera.onLocalStreamReady(va);this.$FBRTCCallController5.localStream.addListener('tracksChanged',this.$FBRTCCallControllerT.bind(this));this.$FBRTCCallControllerR();};ua.prototype.$FBRTCCallControllerM=function(){"use strict";this.$FBRTCCallController0.logCallAction(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,v.CallAction.DENIED_PERMISSION);this.$FBRTCCallControllera.userMediaDenied();};ua.prototype.$FBRTCCallControllerN=function(va){"use strict";this.$FBRTCCallControllerI(q.CallEndReason.CLIENT_ERROR,false,true,false,va);fa.showDialog(fa.dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController5);};ua.prototype.$FBRTCCallControllerO=function(){"use strict";this.$FBRTCCallControllera.userMediaGranted();};ua.prototype.$FBRTCCallControllerf=function(va){"use strict";switch(va.type){case 'offer':this.$FBRTCCallControllerU(va.sdp);break;case 'answer':this.$FBRTCCallControllerV(va.sdp);break;case 'sdp_update':this.$FBRTCCallControllerW(va.sdp);break;default:break;}};ua.prototype.$FBRTCCallControllerW=function(va){"use strict";this.$FBRTCCallControllerq.sendSdpUpdate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,va,this.$FBRTCCallController5.localStream.hasVideo());};ua.prototype.$FBRTCCallControllerU=function(va){"use strict";var wa;if(!this.$FBRTCCallController4){wa=q.PayloadType.OFFER;}else{wa=q.PayloadType.PCRESTART_OFFER;this.$FBRTCCallController4=false;}this.$FBRTCCallControllert=new ga(this.$FBRTCCallControllerq);this.$FBRTCCallControllert.addListener('sendingRetry',this.$FBRTCCallControllerX.bind(this));this.$FBRTCCallControllert.addListener('timeoutFailure',this.$FBRTCCallControllerY.bind(this));this.$FBRTCCallControllert.sendMessage(wa,this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,va,this.$FBRTCCallController5.localStream.hasVideo());this.$FBRTCCallControllerE=setTimeout(function(){this.$FBRTCCallControllerI(q.CallEndReason.NO_ANSWER_TIMEOUT,false,true,false);}.bind(this),sa);};ua.prototype.$FBRTCCallControllerY=function(){"use strict";var va;if(this.$FBRTCCallController5.receivedNack){va=q.CallEndReason.UNSUPPORTED_VERSION;fa.showDialog(fa.dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController5);}else va=q.CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallControllerI(va,false,true,false,'TimedOut');};ua.prototype.$FBRTCCallControllerT=function(){"use strict";this.$FBRTCCallControllern=this.$FBRTCCallController5.isAwaitingAnswer();if(!this.$FBRTCCallController5.isRemoteVideoSupported)return;this.$FBRTCCallControllerq.sendMuteStateUpdate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,this.$FBRTCCallController5.localStream.hasVideo());};ua.prototype.$FBRTCCallControllerJ=function(va){"use strict";this.$FBRTCCallController5.remoteStream.setVideoEnabled(va);};ua.prototype.$FBRTCCallControllerV=function(va){"use strict";var wa=(this.$FBRTCCallController5.localStream.hasVideo()&&this.$FBRTCCallController5.isRemoteVideoSupported);this.$FBRTCCallControlleru=new ga(this.$FBRTCCallControllerq);this.$FBRTCCallControlleru.addListener('sendingRetry',this.$FBRTCCallControllerX.bind(this));this.$FBRTCCallControlleru.sendMessage(q.PayloadType.ANSWER,this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,va,wa);};ua.prototype.$FBRTCCallControllerX=function(){"use strict";var va=this.$FBRTCCallControllerc.getCreatedIceCandidates();for(var wa=0;wa<va.length;wa++)this.$FBRTCCallControllerZ(va[wa]);};ua.prototype.$FBRTCCallControllerZ=function(va){"use strict";this.$FBRTCCallControllerq.sendIceCandidate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,va);};ua.prototype.$FBRTCCallControllerS=function(va,wa){"use strict";this.$FBRTCCallControllerc.setPeerSupportsVideo(this.$FBRTCCallController5.isRemoteVideoSupported);if(this.$FBRTCCallController5.isPeerOnMobile)va=la.setVideoBitrateConstraint(va);if(wa){this.$FBRTCCallControllerc.onReceivedOfferSDP(va);}else this.$FBRTCCallControllerc.onReceivedAnswerSDP(va);};ua.prototype.$FBRTCCallControllerg=function(va){"use strict";this.$FBRTCCallControllerZ(va);};ua.prototype.$FBRTCCallControllerh=function(){"use strict";this.$FBRTCCallControllery=true;var va=this;this.$FBRTCCallControllerx.drainCandidates(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,function(wa){va.$FBRTCCallControllerc.onReceivedRemoteIceCandidate(wa);});};ua.prototype.$FBRTCCallControlleri=function(){"use strict";this.$FBRTCCallController10();this.$FBRTCCallController7.onCallConnected();this.$FBRTCCallControllerD.onCallHeartbeat(this.$FBRTCCallController7);this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Call Connected');};ua.prototype.$FBRTCCallControllerj=function(){"use strict";this.$FBRTCCallControllerI(q.CallEndReason.CONNECTION_DROPPED,false,true,false);};ua.prototype.$FBRTCCallControllerl=function(va){"use strict";this.$FBRTCCallControllerI(q.CallEndReason.WEBRTC_ERROR,false,true,false,va.endCallSubreason);this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'webrtc error: '+JSON.stringify(va.details));};ua.prototype.$FBRTCCallControllers=function(va,wa){"use strict";this.$FBRTCCallControllerI(va,false,false,false,wa);};ua.prototype.$FBRTCCallControllerr=function(va,wa){"use strict";var xa=wa.call_id,ya=wa.type;if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Message sent after call ended: '+ya);return;}if(this.$FBRTCCallController5.peerID!==va||this.$FBRTCCallController5.callID!==xa)return;this.$FBRTCCallControllera.onMessageTypeSent(ya);this.$FBRTCCallController7.onMessageSent(wa);};ua.prototype.$FBRTCCallControllerC=function(va){"use strict";var wa;try{wa=new w(va);}catch(xa){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Unknown data: '+JSON.stringify(va));return;}this.$FBRTCCallController0.logReceivedMessage(wa.peerID,wa.callID,wa.msg);if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (call ended): '+wa.msgID);return;}if(!x.check(wa.peerID,wa.callID,wa.msgID)){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (duplicate): '+wa.msgID);return;}if(this.$FBRTCCallController5.peerID&&this.$FBRTCCallController5.peerID!==wa.peerID){if(wa.isOffer())this.$FBRTCCallController11(wa);this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (different peer): '+wa.msgID);return;}if(!wa.isForCall(this.$FBRTCCallController5)){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (different call): '+wa.msgID);return;}this.$FBRTCCallControllera.onMessageTypeReceived(wa.msgType);if(this.$FBRTCCallController5.callID&&this.$FBRTCCallController5.callID===wa.callID)this.$FBRTCCallController7.onFullMessageReceived(wa);this.$FBRTCCallController5.setSignalingExperiments(wa.getSignalingExperiments());switch(wa.msgType){case q.PayloadType.OFFER:case q.PayloadType.ICERESTART_OFFER:case q.PayloadType.PCRESTART_OFFER:this.$FBRTCCallController12(wa);break;case q.PayloadType.ANSWER:case q.PayloadType.ICERESTART_ANSWER:case q.PayloadType.PCRESTART_ANSWER:this.$FBRTCCallController13(wa);this.$FBRTCCallControllerD.onCallHeartbeat(this.$FBRTCCallController7);break;case q.PayloadType.SDP_UPDATE:this.$FBRTCCallController14(wa);break;case q.PayloadType.ICE_CANDIDATE:this.$FBRTCCallController15(wa);break;case q.PayloadType.HANGUP:this.$FBRTCCallController16(wa);break;case q.PayloadType.OFFER_ACK:this.$FBRTCCallController17();break;case q.PayloadType.OFFER_NACK:this.$FBRTCCallController5.receivedNack=true;break;case q.PayloadType.ANSWER_ACK:this.$FBRTCCallController18();break;case q.PayloadType.MSG_ACK:this.$FBRTCCallController19(wa);break;case q.PayloadType.SET_VIDEO:if(this.$FBRTCCallController5.isRemoteVideoSupported)this.$FBRTCCallControllerJ(wa.msg.videoon);break;case q.PayloadType.VIDEO_REQUEST:k.onEscalationRequest(wa);break;case q.PayloadType.ACK:case q.PayloadType.OK:case q.PayloadType.PING:case q.PayloadType.OTHER_DISMISS:case q.PayloadType.PRANSWER:break;default:break;}};ua.prototype.$FBRTCCallController11=function(va){"use strict";var wa=va.peerID,xa=va.callID,ya=va.msg,za=new n({peerID:wa,callID:xa,isCaller:false});za.onFullMessageReceived(va);this.$FBRTCCallControllerq.sendOfferAck(wa,xa,ya);za.onOfferAckSent(ya);var ab=q.CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallController1a(wa,xa,ab);za.onCallEnded(ab,false);za.save(this.$FBRTCCallController2);};ua.prototype.$FBRTCCallController12=function(va){"use strict";var wa=va.msg;this.$FBRTCCallControllerq.sendOfferAck(this.$FBRTCCallController5.peerID,wa.call_id,wa);this.$FBRTCCallControllerq.sendOtherDismiss(wa.call_id);if(this.$FBRTCCallController1b(wa)){this.$FBRTCCallController1c(va);}else this.$FBRTCCallController1d();};ua.prototype.$FBRTCCallController14=function(va){"use strict";var wa=va.msg,xa=wa.sdp;if(wa.hasOwnProperty('videoon'))this.$FBRTCCallControllerJ(wa.videoon);if(this.$FBRTCCallController5.isPeerOnMobile)xa=la.setVideoBitrateConstraint(xa);this.$FBRTCCallControllerc.onReceivedSdpUpdate(xa);};ua.prototype.$FBRTCCallController1b=function(va){"use strict";if(va.call_id===this.$FBRTCCallController5.callID)return true;return ((this.$FBRTCCallControllerE||!this.$FBRTCCallController3)&&(!this.$FBRTCCallController5.callID||va.call_id!==this.$FBRTCCallController5.callID)&&this.$FBRTCCallController5.isCaller&&(!va.handlescollision||va.call_id<this.$FBRTCCallController5.callID));};ua.prototype.$FBRTCCallController1c=function(va){"use strict";var wa=va.msg;if(wa.hasOwnProperty('videoon'))this.$FBRTCCallControllerJ(wa.videoon);this.$FBRTCCallController1e();this.$FBRTCCallController1f();this.$FBRTCCallController10();if(this.$FBRTCCallController5.callID!==wa.call_id){var xa=q.CallEndReason.OTHER_INSTANCE_HANDLED;this.$FBRTCCallController1a(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,xa);this.$FBRTCCallController7.onCallEnded(xa,false);this.$FBRTCCallController7.save(this.$FBRTCCallController2);this.$FBRTCCallController7=new n({peerID:this.$FBRTCCallController5.peerID,callID:wa.call_id,isCaller:false});this.$FBRTCCallController7.onFullMessageReceived(va);this.$FBRTCCallController7.onOfferAckSent(wa);this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Handling offer collision');}else this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Handling offer refresh');this.$FBRTCCallControllerc.end();this.$FBRTCCallControllery=false;this.$FBRTCCallControllera.reset(wa.call_id,this.$FBRTCCallController7);this.$FBRTCCallController5.onSDPMessageFromPeer(va);if(this.$FBRTCCallController5.canStartCall()){this.$FBRTCCallControllerS(wa.sdp,true);na.onCallStarted();this.$FBRTCCallControllerT();}else this.$FBRTCCallController3=wa;};ua.prototype.$FBRTCCallController1d=function(){"use strict";this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring offer');};ua.prototype.$FBRTCCallController13=function(va){"use strict";var wa=va.msg;this.$FBRTCCallController1e();this.$FBRTCCallController1f();this.$FBRTCCallControllerq.sendAnswerAck(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,wa);this.$FBRTCCallController5.onSDPMessageFromPeer(va);if(this.$FBRTCCallControllerm){this.$FBRTCCallControllerQ();}else{this.$FBRTCCallControllerS(wa.sdp,false);if(wa.hasOwnProperty('videoon'))this.$FBRTCCallControllerJ(wa.videoon);if(this.$FBRTCCallControllern)this.$FBRTCCallControllerT();}};ua.prototype.$FBRTCCallController19=function(va){"use strict";var wa=va.msg;if(this.$FBRTCCallControllert&&this.$FBRTCCallControllert.isAckMsg(wa)){this.$FBRTCCallController7.onMsgAckReceived(va,true);this.$FBRTCCallControllera.onMessageTypeReceived(q.PayloadType.OFFER_ACK);this.$FBRTCCallController17();}else if(this.$FBRTCCallControlleru&&this.$FBRTCCallControlleru.isAckMsg(wa)){this.$FBRTCCallController7.onMsgAckReceived(va,false);this.$FBRTCCallController18();}};ua.prototype.$FBRTCCallController17=function(){"use strict";this.$FBRTCCallController1e();this.$FBRTCCallControllerD.onCallHeartbeat(this.$FBRTCCallController7);};ua.prototype.$FBRTCCallController18=function(){"use strict";this.$FBRTCCallController10();};ua.prototype.$FBRTCCallController15=function(va){"use strict";var wa=va.msg;if(wa.call_id===this.$FBRTCCallController5.callID&&this.$FBRTCCallControllery){this.$FBRTCCallControllerc.onReceivedRemoteIceCandidate(wa);}else this.$FBRTCCallControllerx.cacheCandidate(this.$FBRTCCallController5.peerID,wa.call_id,wa);};ua.prototype.$FBRTCCallController16=function(va){"use strict";var wa=va.msg;if(wa.call_id===this.$FBRTCCallController5.callID){this.$FBRTCCallControllerI(wa.reason,true,false);}else this.$FBRTCCallController0.logError(this.$FBRTCCallController1g.peerID,this.$FBRTCCallController1g.callID,'Reciving hangup for a different call: '+wa.call_id.toString());};ua.prototype.$FBRTCCallControllerI=function(va,wa,xa,ya,za){"use strict";if(typeof va=='string'||va instanceof String)va=q.endCallReasonFromString(va);var ab=q.fullCallEndReasonString(va,wa);this.$FBRTCCallController0.logCallAction(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,v.CallAction.END_CALL,ab);this.$FBRTCCallController1e();this.$FBRTCCallController1f();this.$FBRTCCallController10();if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ending an already-ended call');return;}if(xa)this.$FBRTCCallController1a(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,va,ya);this.$FBRTCCallController8.onEndCall();this.$FBRTCCallControllerc.end();ca.end();this.$FBRTCCallControllera.end(va,wa);this.$FBRTCCallController7.setCallType(this.$FBRTCCallControllerv.getCallType());this.$FBRTCCallController7.setVideoDurations(this.$FBRTCCallController5.getLocalVideoDuration(),this.$FBRTCCallController5.getRemoteVideoDuration());this.$FBRTCCallController7.onCallEnded(va,wa,null,za);this.$FBRTCCallController7.save(this.$FBRTCCallController2);};ua.prototype.$FBRTCCallController1a=function(va,wa,xa,ya){"use strict";this.$FBRTCCallControllerq.sendHangup(va,wa,xa,ya);this.$FBRTCCallControllerq.sendOtherDismiss(wa);};ua.prototype.$FBRTCCallController1e=function(){"use strict";if(this.$FBRTCCallControllert)this.$FBRTCCallControllert.stopRetrying();};ua.prototype.$FBRTCCallController10=function(){"use strict";if(this.$FBRTCCallControlleru)this.$FBRTCCallControlleru.stopRetrying();};ua.prototype.$FBRTCCallController1f=function(){"use strict";if(this.$FBRTCCallControllerE)clearTimeout(this.$FBRTCCallControllerE);this.$FBRTCCallControllerE=null;};ua.prototype.$FBRTCCallControllerw=function(){"use strict";if(this.$FBRTCCallControllerv.isPending()){fa.showDialog(fa.dialogTypes.VIDEO_ESCALATION,this.$FBRTCCallController5);}else fa.hideDialogType(fa.dialogTypes.VIDEO_ESCALATION);this.$FBRTCCallController7.setCallType(this.$FBRTCCallControllerv.getCallType());this.$FBRTCCallController7.save(this.$FBRTCCallController2);};e.exports=ua;},null);
__d("FBRTCBackground.react",["Image.react","ReactComponentWithPureRenderMixin","React","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=i,l=k.PropTypes,m=i.createClass({displayName:"FBRTCBackground",mixins:[h],propTypes:{messengerUI:l.bool.isRequired,src:l.string},getInitialState:function(){return {showCoverPhoto:true};},render:function(){if(this.props.messengerUI)return null;var n=this.props.src;if(this.state.showCoverPhoto&&n){return (i.createElement("div",{className:"_1_5p"},i.createElement("div",{className:"_1_5q"}),i.createElement(g,{src:n,className:"_1_5r",alt:"",onError:this._imageError})));}else return i.createElement("div",{className:"_1_5p"});},_imageError:function(){this.setState({showCoverPhoto:false});}});e.exports=m;},null);
__d("FBRTCActiveMouseMixin",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';var g=3000,h={_activeTimeout:(null),_mouseIsActive:(false),_callbacks:([]),componentWillMount:function(){window.addEventListener('mousemove',this._onMouseMove);},componentWillUnmount:function(){window.removeEventListener('mousemove',this._onMouseMove);if(this._activeTimeout!==null)clearTimeout(this._activeTimeout);this._callbacks=[];},addActiveMouseListener:function(i){this._callbacks.push(i);},_onMouseMove:function(i){this._setMouseIsActive(true);if(this._activeTimeout!==null)clearTimeout(this._activeTimeout);this._activeTimeout=setTimeout(function(){this._activeTimeout=null;this._setMouseIsActive(false);}.bind(this),g);},_setMouseIsActive:function(i){if(i===this._mouseIsActive)return;this._mouseIsActive=i;this._callbacks.map(function(j){j(this._mouseIsActive);}.bind(this));}};e.exports=h;},null);
__d("FBRTCCallControlButton.react",["ReactComponentWithPureRenderMixin","React","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=h,k=j.PropTypes,l={END:0,FULL_SCREEN:1,MUTE:2,SETTINGS:3,SHARE_SCREEN:4,VIDEO:5},m=h.createClass({displayName:"FBRTCCallControlButton",mixins:[g],propTypes:{active:k.bool,endButton:k.bool,highlighted:k.bool,iconType:k.number.isRequired,onClick:k.func.isRequired,ref:k.string},defaultProps:function(){return {active:false,endButton:false,highlighted:false};},render:function(){var n=(("_5lms")+(this.props.highlighted?' '+"_5lmy":'')+(this.props.endButton?' '+"_5lmz":''));return (h.createElement("button",{onClick:this.props.onClick,className:n,ref:this.props.ref,"data-testid":this.props['data-testid']},this._icon(this.props.iconType,!!this.props.active)));},_icon:function(n,o){if(o)return (h.createElement("i",{className:((("_5ln2")+(n===l.END?' '+"_5ln3":'')+(n===l.FULL_SCREEN?' '+"_5lng":'')+(n===l.MUTE?' '+"_5lnh":'')+(n===l.SETTINGS?' '+"_5lni":'')+(n===l.SHARE_SCREEN?' '+"_5lnj":'')+(n===l.VIDEO?' '+"_5lnk":'')))}));return (h.createElement("i",{className:((("_5ln2")+(n===l.END?' '+"_5ln3":'')+(n===l.FULL_SCREEN?' '+"_5lnl":'')+(n===l.MUTE?' '+"_5lnm":'')+(n===l.SETTINGS?' '+"_5lni":'')+(n===l.SHARE_SCREEN?' '+"_5lnn":'')+(n===l.VIDEO?' '+"_5lnp":'')))}));}});m.IconTypes=l;e.exports=m;},null);
__d("FBRTCCallControlPopover.react",["LayerFadeOnHide","LayerFadeOnShow","React","ReactComponentWithPureRenderMixin","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=i,p=o.PropTypes,q={NONE:0,REMOTE_VIDEO_UNSUPPORTED:1,NO_VIDEO_TRACKS:2,VIDEO_AUTO_DISABLED:3,SCREENSHARING_UNAVAILABLE:4,PEER_IS_SHARING_SCREEN:5},r=i.createClass({displayName:"FBRTCCallControlPopover",mixins:[j],propTypes:{reason:p.number.isRequired,peerName:p.string.isRequired,reference:p.object.isRequired,visible:p.bool.isRequired,width:p.number.isRequired},render:function(){var s=this._getTitle();if(s)return (i.createElement(k,i.__spread({},this._popoverProps()),s,this._getBody()));return (i.createElement(k,i.__spread({},this._popoverProps()),this._getBody()));},_getTitle:function(){if(this.props.reason===q.NO_VIDEO_TRACKS)return (i.createElement(m,null,n._("Can't find camera")));},_getBody:function(){var s=null;switch(this.props.reason){case q.NONE:break;case q.REMOTE_VIDEO_UNSUPPORTED:s=(n._("Video is disabled for this call because {name}'s device does not support video.",[n.param("name",this.props.peerName)]));break;case q.NO_VIDEO_TRACKS:s=(n._("Connect your camera and refresh the page to turn on video. If your camera is already connected, try restarting your browser."));break;case q.VIDEO_AUTO_DISABLED:s=(n._("Video is paused because the connection is slow."));break;case q.SCREENSHARING_UNAVAILABLE:s=(n._("Screen sharing is disabled for this call because {name}'s device does not support receiving screen sharing.",[n.param("name",this.props.peerName)]));break;case q.PEER_IS_SHARING_SCREEN:s=(n._("{name} is already sharing their screen. You can share your screen as soon as they stop sharing.",[n.param("name",this.props.peerName)]));break;}return (i.createElement(l,null,s));},_popoverProps:function(){var s={alignment:'left',behaviors:{LayerFadeOnHide:g,LayerFadeOnShow:h},contextRef:function(){return this.props.reference;}.bind(this),hoverContext:i.findDOMNode(this.props.reference),position:'above',shown:this.props.visible,width:this.props.width};return s;}});r.Types=q;e.exports=r;},null);
__d("FBRTCCallControls.react",["FBRTCActiveMouseMixin","FBRTCCallControlActions","FBRTCCallControlButton.react","FBRTCCallControlPopover.react","FBRTCFullScreenController","FBRTCScreenSharingUtils","FBRTCUserSettings","React","ReactLayeredComponentMixin","ScreenSharingWebDriverIDs","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=10000,s={READY:0,SHOWN:1,COMPLETE:2},t=n.createClass({displayName:"FBRTCCallControls",mixins:[o,g],getInitialState:function(){return {forceVisible:s.READY,showScreenSharingPopover:false};},componentDidMount:function(){this._listener=k.addListener(this._handleFullScreenChange);this.addActiveMouseListener(function(u){this.setState({mouseActive:u});}.bind(this));},componentWillUnmount:function(){if(this._listener){this._listener.remove();this._listener=null;}},_handleFullScreenChange:function(){this.forceUpdate();},_shouldForceVisible:function(u){var v=u.localStream;return u.videoIsAutoDisabled()||(v.hasStream()&&!v.hasVideoTracks());},componentWillReceiveProps:function(u){if(this._shouldForceVisible(u.callModel)){if(this.state.forceVisible===s.READY){this.setState({forceVisible:s.SHOWN});setTimeout(function(){this.setState({forceVisible:s.COMPLETE});}.bind(this),r);}}else if(this.state.forceVisible===s.SHOWN)this.setState({forceVisible:s.COMPLETE});},_getPopoverWidth:function(u){var v=65;return (m.isEnabled()?u:u-v);},renderLayers:function(){var u,v,w=false,x={},y=this.props.callModel.peerShortName();if(!this.props.callModel.isRemoteVideoSupported){u=j.Types.REMOTE_VIDEO_UNSUPPORTED;}else if(!this.props.callModel.localStream.hasVideoTracks()){u=j.Types.NO_VIDEO_TRACKS;}else if(this.props.callModel.videoIsAutoDisabled())u=j.Types.VIDEO_AUTO_DISABLED;if(u){w=(this.state.forceVisible===s.SHOWN);x.videoPopover=n.createElement(j,{reason:u,peerName:y,reference:this.refs.videoButton,width:this._getPopoverWidth(320),visible:w});}if(l.isScreenSharingSupported()){if(this.props.callModel.isInProgress()&&!this.props.callModel.canPeerReceiveScreenSharing()){v=j.Types.SCREENSHARING_UNAVAILABLE;}else if(this.props.callModel.getRemoteScreenStream()!==null)v=j.Types.PEER_IS_SHARING_SCREEN;if(v){w=this.state.showScreenSharingPopover;x.screenSharingPopover=n.createElement(j,{reason:v,peerName:y,reference:this.refs.shareScreenButton,width:this._getPopoverWidth(255),visible:w});}}return x;},toggleMuteAudio:function(u){h.toggleMuteAudio();},toggleMuteVideo:function(u){h.toggleMuteVideo();},toggleFullScreen:function(u){h.toggleFullScreen();},endCall:function(u){h.hangUp();},showSettings:function(u){if(m.isEnabled())h.showSettings();},toggleScreenSharing:function(u){if(l.isScreenSharingSupported())if(this.props.callModel.canPeerReceiveScreenSharing()&&this.props.callModel.getRemoteScreenStream()===null){h.toggleScreenSharing();}else{l.logFailedAttempt(this.props.callModel.peerID,this.props.callModel.callID);if(!this.state.showScreenSharingPopover){this.setState({showScreenSharingPopover:true});setTimeout(function(){this.setState({showScreenSharingPopover:false});}.bind(this),r/4);}}},render:function(){var u=m.isEnabled(),v=!this.props.callModel.localStream.hasVideo()||!this.props.callModel.isRemoteVideoSupported,w=l.isScreenSharingSupported(),x=!this.props.callModel.localStream.hasAudio(),y=this.props.callModel.isFullScreen();return (n.createElement("div",{className:"_4bbt"},n.createElement("div",{className:this._wrapperClasses()},n.createElement(i,{active:v,highlighted:v,iconType:i.IconTypes.VIDEO,onClick:this.toggleMuteVideo,ref:"videoButton"}),n.createElement(i,{active:x,iconType:i.IconTypes.MUTE,highlighted:x,onClick:this.toggleMuteAudio}),this._screenSharingButton(w),n.createElement(i,{endButton:true,iconType:i.IconTypes.END,onClick:this.endCall}),this._settingsButton(u),n.createElement(i,{active:y,iconType:i.IconTypes.FULL_SCREEN,onClick:this.toggleFullScreen}))));},_settingsButton:function(u){if(u)return (n.createElement(i,{iconType:i.IconTypes.SETTINGS,onClick:this.showSettings}));},_screenSharingButton:function(u){if(u){var v=this.props.callModel.isScreenSharingEnabled()&&this.props.callModel.canPeerReceiveScreenSharing();return (n.createElement(i,{active:v,highlighted:v,iconType:i.IconTypes.SHARE_SCREEN,onClick:this.toggleScreenSharing,ref:"shareScreenButton","data-testid":p.SHARE_SCREEN_BUTTON}));}},_wrapperClasses:function(){var u=!this.props.callModel.localStream.hasStream()||this.props.callModel.isEnded(),v=this.state.mouseActive||this.state.forceVisible===s.SHOWN;return (("_4bbx")+(u?' '+"_4bby":'')+(v?' '+"_4bbz":''));}});e.exports=t;},null);
__d("FBRTCButton.react",["MessengerButton.react","ReactComponentWithPureRenderMixin","React","XUIOverlayButton.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=i,n=m.PropTypes,o=i.createClass({displayName:"FBRTCButton",mixins:[h],propTypes:{label:n.string.isRequired,messengerUI:n.bool.isRequired,type:n.string.isRequired},render:function(){var p=this.props,q=p.className,r=p.messengerUI,s=p.type,t=(function(u,v){var w={},x=Object.prototype.hasOwnProperty;if(u==null)throw new TypeError();for(var y in u)if(x.call(u,y)&&!x.call(v,y))w[y]=u[y];return w;})(p,{className:1,messengerUI:1,type:1});if(r)return (i.createElement(g,i.__spread({className:q,type:s},t)));return (i.createElement(j,i.__spread({className:l("_1-7l",q)},t)));}});e.exports=o;},null);
__d("FBRTCCallTimer.react",["React"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=g.createClass({displayName:"FBRTCCallTimer",getInitialState:function(){return {secondsElapsed:0};},tick:function(){this.setState({secondsElapsed:this.state.secondsElapsed+1});},componentDidMount:function(){this.interval=setInterval(this.tick,1000);},componentWillUnmount:function(){clearInterval(this.interval);},render:function(){var i=this.state.secondsElapsed;return (g.createElement("span",null,i>=3600?("0"+Math.floor(i/3600)).slice(-2)+':':'',("0"+Math.floor((i%3600)/60)).slice(-2),":",("0"+i%60).slice(-2)));}});e.exports=h;},null);
__d("FBRTCSpinner.react",["MessengerSpinner.react","ReactComponentWithPureRenderMixin","React","XUISpinner.react"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=i,l=k.PropTypes,m=i.createClass({displayName:"FBRTCSpinner",mixins:[h],propTypes:{messengerUI:l.bool.isRequired},render:function(){if(this.props.messengerUI)return i.createElement(g,{color:"blue"});return i.createElement(j,{background:"dark",size:"large"});}});e.exports=m;},null);
__d("FBRTCCallStateInfo.react",["FBRTCButton.react","FBRTCCallModel","FBRTCCallTimer.react","FBRTCConstants","FBRTCSpinner.react","Image.react","MessengerContactImage.react","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=function(t,u){switch(t){case j.CallEndReason.NO_ANSWER_TIMEOUT:case j.CallEndReason.IGNORE_CALL:return p._("No Answer");case j.CallEndReason.INCOMING_TIMEOUT:case j.CallEndReason.NO_PERMISSION:case j.CallEndReason.OTHER_NOT_CAPABLE:case j.CallEndReason.OTHER_CARRIER_BLOCKED:return p._("Not Reachable");case j.CallEndReason.SIGNALING_MESSAGE_FAILED:case j.CallEndReason.WEBRTC_ERROR:case j.CallEndReason.NO_UI_ERROR:case j.CallEndReason.CALLER_NOT_VISIBLE:case j.CallEndReason.CLIENT_ERROR:return p._("Call Failed");case j.CallEndReason.UNSUPPORTED_VERSION:return p._("Can't Connect Call");case j.CallEndReason.IN_ANOTHER_CALL:return p._("In Another Call");case j.CallEndReason.CARRIER_BLOCKED:return p._("Switch to Wi-Fi to complete your call");case j.CallEndReason.CLIENT_INTERRUPTED:return p._("Call Interrupted");case j.CallEndReason.HANGUP_CALL:case j.CallEndReason.ACCEPT_AFTER_HANGUP:return p._("Call Ended");case j.CallEndReason.CONNECTION_DROPPED:return p._("Connection Lost");case j.CallEndReason.OTHER_INSTANCE_HANDLED:return '';default:return '';}},r=function(t,u){switch(t.uiState){case h.UIState.INIT:case h.UIState.PENDING_LOCAL_MEDIA:case h.UIState.MORE_INIT:case h.UIState.USER_MEDIA_DENIED:return (n.createElement(k,{messengerUI:u}));case h.UIState.CONTACTING:return (n.createElement("p",{className:"_2ze8"},p._("Contacting...")));case h.UIState.RINGING:return (n.createElement("p",{className:"_2ze8"},p._("Ringing...")));case h.UIState.CALL_CONNECTING:return (n.createElement("p",{className:"_2ze8"},p._("Connecting...")));case h.UIState.CALL_CONNECTED:return (n.createElement("p",{className:"_2ze8"},n.createElement(i,null)));case h.UIState.CALL_ENDED:return (n.createElement("p",{className:"_2ze8"},q(t.endCallReason,t.isRemoteEnded)));default:return '';}},s=n.createClass({displayName:"FBRTCCallStateInfo",revealContainer:function(){var t="_4j_h",u=document.getElementsByClassName(t)[0];if(u)u.className=t;},onCloseButtonClicked:function(t){window.close();return;},onStartCallButtonClicked:function(t){this.props.publishFn(j.UIEventType.START_CALL,t);},componentDidMount:function(){setTimeout(function(){this.revealContainer();}.bind(this),2000);},render:function(){var t=this.props.callModel;return (n.createElement("div",{className:"_4j_i"},this.renderPeerImage(t),this.renderMessage(),this.renderSubMessage(),this.renderCloseWindowButton(),this.renderStartCallButton()));},renderMessage:function(){var t=this.props.callModel;if(t.uiState===h.UIState.AWAITING_USER_START)return (n.createElement("p",{className:"_4j_k"},p._("Ready to call {name}?",[p.param("name",t.peerShortName())])));return (n.createElement("p",{className:"_4j_k"},this.props.callModel.peerName()));},renderSubMessage:function(){return r(this.props.callModel,this.props.messengerUI);},renderPeerImage:function(t){if(t.peerPicUrl()){if(this.props.messengerUI)return (n.createElement(m,{className:"_3z3i",isMessengerUser:true,size:75,src:t.peerPicUrl()}));return (n.createElement(l,{className:"_4j_j",src:t.peerPicUrl(),alt:"profile pic",onLoad:this.revealContainer,onError:this.revealContainer}));}return '';},shouldRenderCloseButton:function(){var t=this.props.callModel;return t.uiState===h.UIState.CALL_ENDED&&(!t.wasConnected||t.endCallReason!==j.CallEndReason.HANGUP_CALL);},renderCloseWindowButton:function(){if(this.shouldRenderCloseButton()){return (n.createElement(g,{label:p._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:"primary"}));}else return '';},renderStartCallButton:function(){var t=this.props.callModel;if(t.uiState===h.UIState.AWAITING_USER_START){return (n.createElement(g,{label:p._("Start Call"),messengerUI:this.props.messengerUI,onClick:this.onStartCallButtonClicked,type:"primary"}));}else return '';}});e.exports=s;},null);
__d("FBRTCVideoMuteOverlay.react",["Image.react","ReactComponentWithPureRenderMixin","React","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=i,l=k.PropTypes,m=i.createClass({displayName:"FBRTCVideoMuteOverlay",mixins:[h],propTypes:{videoMuted:l.bool.isRequired,imageSrc:l.string.isRequired},render:function(){var n=(("_30ve")+(this.props.videoMuted?' '+"_30vf":''));return (i.createElement("div",{className:n},i.createElement(g,{src:this.props.imageSrc,alt:"video muted"})));}});e.exports=m;},null);
__d("FBRTCSelfView.react",["FBRTCActiveMouseMixin","FBRTCCallModel","FBRTCConstants","FBRTCUtils","FBRTCVideo.react","FBRTCVideoMuteOverlay.react","React","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=m,p=o.PropTypes,q=m.createClass({displayName:"FBRTCSelfView",mixins:[g],propTypes:{publishFn:p.func.isRequired,callModel:p.instanceOf(h).isRequired},getInitialState:function(){return {};},componentDidMount:function(){this.addActiveMouseListener(function(r){this.setState({mouseActive:r});}.bind(this));},toggleIconClass:function(r,s){return (("_2q_n")+(r?' '+"_2q_o":'')+(!r?' '+"_2q_p":'')+(!s?' '+"_2q_q":''));},wrapperClasses:function(r){return (("_2q_r")+(!r.selfViewOpen?' '+"_2q_s":''));},overlayClasses:function(r){var s=r.localStream.hasAudio();return (("_2q_t")+(s?' '+"_2q_u":''));},buttonClasses:function(){return (("_2q_w")+(this.state.mouseActive?' '+"_sxz":''));},render:function(){var r=this.props.callModel,s=r.selfViewOpen;return (m.createElement("div",{className:"_2q_v"},m.createElement("button",{className:this.buttonClasses(),onClick:this._toggleSelfView},m.createElement("i",{className:this.toggleIconClass(true,!s)}),m.createElement("i",{className:this.toggleIconClass(false,s)})),m.createElement("div",{className:this.wrapperClasses(r)},m.createElement("div",{className:"_5aq5"},m.createElement(l,{videoMuted:!r.localStream.hasVideo(),imageSrc:!j.isCollabCallable(r.peerID)?r.selfPicUrl():""}),m.createElement("div",{className:this.overlayClasses(r)},m.createElement("i",{className:"_2q_x"})),m.createElement(k,{className:"_2q_y",muted:true,stream:r.localStream})))));},_toggleSelfView:function(r){this.props.publishFn(i.UIEventType.TOGGLE_SELF_VIEW);}});e.exports=q;},null);
__d("FBRTCInCallView.react",["FBRTCCallModel","FBRTCScreenSharingUI","FBRTCScreenSharingView.react","FBRTCSelfView.react","FBRTCVideo.react","React","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=l,o=n.PropTypes,p=l.createClass({displayName:"FBRTCInCallView",propTypes:{callModel:o.instanceOf(g).isRequired,publishFn:o.func.isRequired,excludeSelfView:o.bool},_videoIsMuted:function(){var q=this.props.callModel.remoteStream;return q&&!q.hasVideo();},_hasRemoteScreen:function(q){var r=q.getRemoteScreenStream();return (r!==null)&&!h.isOpen();},_containerClasses:function(q){var r=q===g.UIState.CALL_CONNECTED,s=q===g.UIState.CALL_ENDED;return (("_of-")+(r||s?' '+"_of_":'')+(r?' '+"_og0":'')+(s?' '+"_og1":''));},_videoWrapperClasses:function(q){var r=this._videoIsMuted();return (("_og2")+(r?' '+"_og3":'')+(q?' '+"_og4":''));},render:function(){var q=this.props,r=q.callModel,s=q.publishFn,t=r.remoteStream.hasStream(),u=this._hasRemoteScreen(r);if(!t&&!u){return l.createElement("div",{className:"_hgl"});}else{var v=r.uiState;return (l.createElement("div",{className:this._containerClasses(v)},l.createElement("div",{className:this._videoWrapperClasses(u)},l.createElement(k,{stream:r.remoteStream})),this._renderSelfView(r,s),this._renderScreenView(r,s,u)));}},_renderSelfView:function(q,r){if(!this.props.excludeSelfView&&q.isRemoteVideoSupported)return l.createElement(j,{callModel:q,publishFn:r});return null;},_renderScreenView:function(q,r,s){if(s)return (l.createElement(i,{screenStream:q.getRemoteScreenStream(),publishFn:r}));return null;}});e.exports=p;},null);
__d("FBRTCMediaAccessPrompt.react",["React","cx","fbt","UserAgent","Link.react","XUIText.react","FBRTCCallModel","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=g.createClass({displayName:"FBRTCMediaAccessPrompt",isVisible:function(p){return (j.isBrowser('Chrome')||j.isBrowser('Firefox'))&&p===m.UIState.PENDING_LOCAL_MEDIA;},componentWillUpdate:function(p,q){var r=p.callModel.uiState;if(this.isVisible(r)){clearTimeout(this.timeout);g.findDOMNode(this).style.display='block';}},componentDidUpdate:function(p,q){var r=this.props.callModel.uiState;if(!this.isVisible(r))this.timeout=setTimeout(function(){g.findDOMNode(this).style.display='none';}.bind(this),500);},componentWillUnmount:function(){clearTimeout(this.timeout);},dialogTitle:function(){if(j.isBrowser('Chrome')){return i._("Click \"Allow\" to Make a Call");}else return i._("Click the camera and choose \"Share Selected Devices\"");},dialogBody:function(){return i._("To make a video call on Facebook, you need to turn on your camera and microphone. This will let your friend see and hear you during the call.");},dialogLowerBody:function(){return i._("You can always turn these off later.");},learnMoreLink:function(){return (g.createElement(k,{href:n.userMediaPermissionErrorUrl(),target:"_blank"},i._("Learn more")));},render:function(){var p=this.props.callModel.uiState;return (g.createElement("div",{className:(("_3jne")+(!this.isVisible(p)?' '+"_3jnf":''))},g.createElement("div",{className:"_3jnu"},g.createElement("h1",{className:"_3jnv"},this.dialogTitle()),g.createElement(l,{className:"_3jnw",display:"block",size:"small"},this.dialogBody()),g.createElement(l,{className:"_3jnw",display:"block",size:"small"},this.dialogLowerBody()," ",this.learnMoreLink()))));}});e.exports=o;},null);
__d("FBRTCMediaDeniedPrompt.react",["React","cx","fbt","UserAgent","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","ReactLayeredComponentMixin","FBRTCCallModel"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=g.createClass({displayName:"FBRTCMediaDeniedPrompt",mixins:[n],showDialog:function(){var q=this.props.callModel;return q.uiState===o.UIState.USER_MEDIA_DENIED;},arrowAlignment:function(){return j.isBrowser('Chrome')?'right':'left';},dialogTitle:function(){return i._("Click to Turn on Camera\/Microphone");},dialogBody:function(){return i._("To use video calling, you need to turn on your camera and microphone during the call.");},renderLayers:function(){return {popover:(g.createElement(k,{contextRef:function(){return this.refs.mpTarget;}.bind(this),shown:this.showDialog(),position:"below",alignment:this.arrowAlignment(),width:k.WIDTH.NORMAL},g.createElement(m,null,this.dialogTitle()),g.createElement(l,null,this.dialogBody())))};},render:function(){return (g.createElement("div",{className:"_3wrz",ref:"mpTarget"}));}});e.exports=p;},null);
__d("FBRTCFadeInMixin",["React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={componentDidMount:function(){var k=g.findDOMNode(this);k.style.opacity=0;k.className=i(k.className,"_2hy");setTimeout(function(){k.style.opacity=1;},1);}};e.exports=j;},null);
__d("FBRTCFeedbackCompleteView.react",["FBRTCButton.react","FBRTCFadeInMixin","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=i.createClass({displayName:"FBRTCFeedbackCompleteView",mixins:[h],onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},messageString:function(){if(this.props.skipped)return k._("Your call has ended");return k._("Thank you for your feedback!");},render:function(){return (i.createElement("div",{className:"_1-7k"},i.createElement("p",{className:"_4j_k"},this.messageString()),i.createElement("div",null,i.createElement(g,{label:k._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:"primary"}))));}});e.exports=l;},null);
__d("FBRTCFeedbackView.react",["FBRTCButton.react","FBRTCFadeInMixin","FBRTCFeedbackCompleteView.react","FBRTCStarRatingActions","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=k.createClass({displayName:"FBRTCFeedbackView",mixins:[h],getInitialState:function(){return {submitted:false,skipped:false,feedbackText:''};},componentDidMount:function(){j.feedbackShown();},onSubmitButtonClicked:function(){if(this.canSubmitFeedback()){this.setState({submitted:true});j.submitFeedback(this.state.feedbackText);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},canSubmitFeedback:function(){return this.state.feedbackText!=='';},feedbackChanged:function(o){this.setState({feedbackText:o.target.value});o.preventDefault();},render:function(){if(this.state.submitted)return (k.createElement(i,{messengerUI:this.props.messengerUI,skipped:this.state.skipped}));return (k.createElement("div",{className:"_1-7k"},k.createElement("p",{className:"_4j_k"},m._("Give Feedback")),k.createElement("div",{className:"_4ru1"},k.createElement("label",{htmlFor:"fbwebrtcfeedback",className:"_4j_k _4ru2"},m._("What was the worst problem you experienced?")),k.createElement("textarea",{className:"_4ru3",id:"fbwebrtcfeedback",rows:"4",onChange:this.feedbackChanged,placeholder:m._("Enter your feedback")}),k.createElement("div",{className:"_s97"},k.createElement(g,{className:"_g6b",label:m._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:"secondary"}),k.createElement(g,{className:"_g6b",disabled:!this.canSubmitFeedback(),label:m._("Submit"),messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:"primary"})))));}});e.exports=n;},null);
__d("FBRTCStarRatingView.react",["FBRTCButton.react","FBRTCFadeInMixin","FBRTCFeedbackCompleteView.react","FBRTCFeedbackView.react","FBRTCStarRatingActions","React","StarsInput.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=l.createClass({displayName:"FBRTCStarRatingView",mixins:[h],getInitialState:function(){return {rating:0,submitted:false,skipped:false,feedbackText:''};},componentDidMount:function(){k.ratingShown();},onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},onStarClicked:function(q){this.setState({rating:q});},onSubmitButtonClicked:function(){if(this.state.rating>0){this.setState({submitted:true});k.submitRating(this.state.rating);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},getRatingString:function(){switch(this.state.rating){case 1:return o._("Poor");case 2:return o._("Fair");case 3:return o._("Good");case 4:return o._("Very Good");case 5:return o._("Excellent");default:return '---';}},shouldAskForFeedback:function(){return this.state.rating===1&&this.state.submitted&&!this.state.skipped;},render:function(){if(this.shouldAskForFeedback()){return (l.createElement(j,{messengerUI:this.props.messengerUI}));}else if(this.state.submitted)return (l.createElement(i,{skipped:this.state.skipped,messengerUI:this.props.messengerUI}));var q=this.getRatingString();return (l.createElement("div",{className:"_1-7k"},l.createElement("p",{className:"_4j_k"},o._("Please rate the quality of your video call.")),l.createElement("p",{className:"_4j_k _a16"},q),l.createElement(m,{allowMultipleSubmissions:true,onClick:this.onStarClicked}),l.createElement("div",{className:"_s97"},l.createElement(g,{className:"_g6b",label:o._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:"secondary"}),l.createElement(g,{className:"_g6b",label:o._("Submit"),disabled:this.state.rating===0,messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:"primary"}))));}});e.exports=p;},null);
__d("FBRTCView.react",["FBRTCBackground.react","FBRTCCallControls.react","FBRTCCallModel","FBRTCCallStateInfo.react","FBRTCConfig","FBRTCInCallView.react","FBRTCMediaAccessPrompt.react","FBRTCMediaDeniedPrompt.react","FBRTCStarRatingView.react","React","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();'use strict';var r=p,s=r.PropTypes,t=p.createClass({displayName:"FBRTCView",_listener:(null),propTypes:{callModel:s.instanceOf(i).isRequired,messengerUI:s.bool.isRequired,publishFn:s.func.isRequired},componentDidMount:function(){this._listener=this.props.callModel.addListener(this._handleCallModelChanged);},componentWillUnmount:function(){if(this._listener){this._listener.remove();delete this._listener;}},_handleCallModelChanged:function(){this.forceUpdate();},render:function(){var u=this.props,v=u.callModel,w=u.messengerUI,x=u.publishFn,y=v.backgroundUrl();if(v.uiState===i.UIState.COLLECT_RATING){return (p.createElement("div",{className:this._wrapperClass()},p.createElement(g,{src:y,messengerUI:w}),this._renderLogo(),p.createElement(o,{messengerUI:w})));}else return (p.createElement("div",{className:this._wrapperClass()},p.createElement(m,{callModel:v}),p.createElement(n,{callModel:v}),p.createElement(j,{callModel:v,messengerUI:w,publishFn:x}),p.createElement(g,{src:y,messengerUI:w}),this._renderLogo(),p.createElement(l,{callModel:v,publishFn:x}),p.createElement(h,{callModel:v})));},_renderLogo:function(){if(!this.props.messengerUI){var u=(("_263g")+(!k.isMessengerDotCom()?' '+"_56us":'')+(k.isMessengerDotCom()?' '+"_56ut":''));return p.createElement("i",{className:u});}},_wrapperClass:function(){return (("_3ref")+(this.props.messengerUI?' '+"_17cj":''));}});e.exports=t;},null);
__d("FBRTCApplication",["FBRTCLogger","FBRTCCallController","FBRTCConfig","FBRTCView.react","React","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m={init:function(n,o,p,q,r,s){s=s||document.getElementById('fbRTC/container');var t=g.getInstance();t.logInfo(n,o,'Starting Call Controller');document.documentElement.style.overflow='hidden';if(!l.isWebrtcSupported()){t.logError(n,o,'Webrtc not supported');}else{var u=new h(n,o,p,r),v=u.getViewController();k.render(k.createElement(j,{callModel:u.getCallModel(),messengerUI:i.useMessengerCallUI(),publishFn:v.publish.bind(v)}),s);if(q){u.startCallProcess();}else u.waitForUserInput();}}};e.exports=m;},null);